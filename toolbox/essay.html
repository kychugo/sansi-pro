
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»æ°´ï¼è­°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600&family=Zen+Kaku+Gothic+New:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
       :root {
            /* æ–°çš„è­°è«–æ–‡ç‰ˆé…è‰²æ–¹æ¡ˆï¼šå°ˆæ¥­è—ç°è‰²èª¿ */
            --bg-color: #ECEFF1; /* æ·¡é›…çš„å†·ç°è‰²èƒŒæ™¯ */
            --text-color: #263238; /* æ·±è—ç°è‰²æ–‡å­—ï¼Œæ¸…æ™°æ˜“è®€ */
            --primary-color: #37474F; /* ä¸»è‰²èª¿ï¼šæ²‰ç©©çš„æ·±è—ç° */
            --secondary-color: #546E7A; /* æ¬¡è‰²èª¿ï¼šè¼ƒæŸ”å’Œçš„è—ç° */
            --border-color: #B0BEC5; /* é‚Šæ¡†é¡è‰² */
            --accent-color: #0288D1; /* å¼·èª¿è‰²ï¼šæ˜äº®çš„å°ˆæ¥­è— */
            --font-serif: 'Noto Serif JP', serif;
            --font-sans: 'Zen Kaku Gothic New', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            font-weight: 300;
            overflow-x: hidden;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23CFD8DC" fill-opacity="0.2"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 3rem;
        }

        header {
            text-align: center;
            padding: 2rem 0 3rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 3rem;
        }

        header h1 {
            font-family: var(--font-serif);
            font-size: 2.8rem;
            font-weight: 400;
            color: var(--primary-color);
            letter-spacing: 0.2em;
        }

        header p {
            font-size: 1rem;
            color: var(--secondary-color);
            margin-top: 0.5rem;
            letter-spacing: 0.1em;
        }

        main {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 4rem;
            flex-grow: 1;
        }

        .controls {
            padding-right: 2rem;
            border-right: 1px solid var(--border-color);
        }

        .control-group {
            margin-bottom: 2.5rem;
        }

        .control-group label {
            display: block;
            margin-bottom: 1rem;
            font-family: var(--font-serif);
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--primary-color);
        }

        .control-group input[type="text"],
        .control-group textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            background-color: transparent;
            border-radius: 4px;
            font-family: var(--font-sans);
            font-size: 1rem;
            color: var(--text-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .control-group input[type="text"]:focus,
        .control-group textarea:focus {
          outline: none;
          border-color: var(--accent-color);
          box-shadow: 0 0 5px rgba(2, 136, 209, 0.25);
        }

        .control-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .word-count-control {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .word-count-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--primary-color);
            width: 30px;
            height: 30px;
            font-size: 1.5rem;
            line-height: 26px;
            text-align: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.3s, color 0.3s;
        }

        .word-count-btn:hover {
            background-color: var(--primary-color);
            color: var(--bg-color);
        }

        #word-count-display {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
            background-color: #FFFFFF;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-width: 80px;
            text-align: center;
        }

        .style-selector {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .style-selector label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .style-selector input[type="radio"] {
            display: none;
        }

        .style-selector input[type="radio"]:checked + span {
            font-weight: 500;
        }

        .style-selector label:has(input:checked) {
             background-color: var(--accent-color);
             border-color: var(--accent-color);
             color: #FFFFFF;
        }

        .generate-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1.5rem;
            font-family: var(--font-serif);
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            background-color: var(--primary-color);
            color: var(--bg-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .generate-btn:hover {
            background-color: #263238;
        }
        
        .generate-btn:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
        }

        .output {
            position: relative;
        }
        
        .output-toolbar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        #output-word-count {
            font-size: 0.9rem;
            color: var(--secondary-color);
            font-family: var(--font-sans);
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }

        .icon-btn:hover {
            background-color: #CFD8DC;
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--primary-color);
        }

        .icon-btn .copy-feedback {
            font-size: 0.9rem;
            font-family: var(--font-sans);
        }

        #essay-placeholder, #generated-essay {
            padding: 2rem;
            background-color: #FFFFFF;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-height: 60vh;
            white-space: pre-wrap;
            font-family: var(--font-serif);
            font-size: 1.1rem;
            line-height: 2.2;
            letter-spacing: 0.05em;
        }
        
        #essay-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary-color);
            font-size: 1.5rem;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 5px solid var(--bg-color);
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @media (max-width: 900px) {
            main {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            .controls {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding-right: 0;
                padding-bottom: 2rem;
            }
            .container {
                padding: 1.5rem;
            }
        }

    </style>
</head>
<body>

    <!-- è­°è«–æ–‡å¯«ä½œæŒ‡ä»¤ (å°ç”¨å®¶éš±è—) -->
    <div id="argumentative-prompt" style="display: none;"><pre>
ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„DSEä¸­æ–‡è­°è«–æ–‡ä½œå®¶ã€‚è«‹æ ¹æ“šä»¥ä¸‹å®Œæ•´æŒ‡ä»¤ç”Ÿæˆé«˜è³ªé‡çš„è­°è«–æ–‡ï¼š
[ç›®æ¨™] è«‹æ ¹æ“šä»¥ä¸‹æ‰€æœ‰è©³ç´°è¦æ±‚ï¼Œæ ¹æ“šã€Šè«–å¾—å¤±ã€‹çš„ç¯„æ–‡ç²¾é«“ï¼Œç”Ÿæˆä¸€ç¯‡å®Œæ•´çš„ã€å…·æœ‰æ·±åº¦å’ŒèªªæœåŠ›ã€ç´„1300å€‹ä¸­æ–‡å­—ç¬¦çš„DSEè­°è«–æ–‡ã€‚æ–‡ç« é ˆç·Šæ‰£çµ¦å®šé¡Œç›®ï¼Œå…§å®¹æ·±åˆ»ã€è«–è­‰åš´è¬¹ï¼Œä¸¦åš´æ ¼éµå®ˆæ‰€æœ‰è­°è«–æ–‡å¯«ä½œè¦ç¯„ã€‚ 

[æ–‡ç« é¡å‹] è­°è«–æ–‡

[æ ¸å¿ƒçµæ§‹ï¼šå‰ä¸­å¾Œä¸‰æ®µå¼çµæ§‹] ä½ çš„æ–‡ç« å¿…é ˆæ¸…æ™°åœ°å‘ˆç¾ã€Œå‰ã€ä¸­ã€å¾Œã€ä¸‰å¤§çµæ§‹éƒ¨åˆ†ï¼Œä¸¦ç¢ºä¿æ¯å€‹éƒ¨åˆ†éƒ½èˆ‡æ–‡ç« ä¸»é¡Œç·Šå¯†æ‰£è¯ã€‚

ä¸»é¡Œï¼š [è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨å¸Œæœ›æ¢è¨çš„è­°è«–æ–‡ä¸»é¡Œï¼Œä¾‹å¦‚ã€Œè«‡è«–å¾—å¤±ã€ã€ã€Œé¢å°ä¸åŒæ„è¦‹ï¼Œå“ªç¨®æ…‹åº¦è¼ƒç‚ºç†æƒ³ï¼Ÿã€ã€ã€Œè«‡è™›å½ã€ã€ã€Œè«‡æ†¤æ€’ã€ç­‰]

è­°è«–æ–‡çµæ§‹èˆ‡å…§å®¹è¦æ±‚ï¼š
1.
é–‹ç«¯ (ã€Œå‰ã€)ï¼š1
â—¦
æ¦‚å¿µå¼•å…¥åŠèƒŒæ™¯ï¼š å¾æ™®éç¾è±¡ã€äººé¡æœ¬è³ªã€æˆ–ç›¸é—œæ¦‚å¿µçš„èƒŒæ™¯å‡ºç™¼ï¼Œç‚ºä¸»é¡Œå¥ å®šåŸºç¤ã€‚é€™éƒ¨åˆ†æ‡‰èƒ½å¼•èµ·è®€è€…æ€è€ƒï¼Œä¸¦é»å‡ºä¸»é¡Œçš„é‡è¦æ€§æˆ–çˆ­è­°æ€§1ã€‚
â—¦
ç¾å¯¦è§€å¯Ÿ/ä¾‹å­ï¼š çµåˆç•¶ä»£ç¤¾æœƒç¾è±¡ã€æ­·å²äº‹ä¾‹ã€æˆ–ç”Ÿæ´»ä¸­çš„å…·é«”ä¾‹å­ï¼Œå…·é«”åŒ–ä¸»é¡Œåœ¨ç¾å¯¦ä¸­çš„è¡¨ç¾1ã€‚
â—¦
è§€é»è¡çª/é§è«–é‹ªå¢Šï¼š é»å‡ºé‡å°ä¸»é¡Œçš„å¸¸è¦‹è§€é»ã€èª¤è§£ï¼Œæˆ–æ˜¯ä¸åŒç«‹å ´çš„è¡çªï¼Œç‚ºå¾Œæ–‡çš„æ·±å…¥è«–è¿°å’Œåé§ä½œé‹ªå¢Š1ã€‚
â—¦
åƒè€ƒã€Šè«–å¾—å¤±ã€‹çš„é–‹é ­å¯«æ³•ï¼š è©²ç¯„æ–‡å¾ã€Œæ¯å€‹äººå‘±å‘±å¢®åœ°æ™‚ï¼Œéƒ½æ˜¯æ‰‹ç©ºç©ºï¼Œç„¡ä¸€ç‰©ã€çš„æ™®éäººæ€§å¼•å…¥ï¼Œéš¨å¾Œå¸¶å‡ºç¾å¯¦ä¸­è¿½åé€åˆ©çš„ç¾è±¡ï¼Œä¸¦éš±å«å°äººé¡æœªæ±²å–æ­·å²æ•™è¨“çš„æ‰¹åˆ¤ï¼Œç‚ºå…¨æ–‡çš„è¾¯è­‰æ€è€ƒåŸ‹ä¸‹ä¼ç­†ã€‚
2.
ä¸»é«” (ã€Œä¸­ã€)ï¼š
â—¦
åˆ†å±¤è«–è¿°ï¼š æ¡ç”¨ã€Œåˆ†é¡è«–è¿°ã€æˆ–ã€Œåˆ†æ‹†è«–è¿°ã€çš„æ–¹å¼ï¼Œå¤šè§’åº¦ã€æœ‰å±¤æ¬¡åœ°æ·±å…¥å‰–æä¸»é¡Œã€‚è«‹è‡³å°‘åŒ…å«å…©å€‹ä¸»è¦è«–é»ï¼Œæ¯å€‹è«–é»ç¨ç«‹æˆæ®µï¼Œé—¡è¿°ä¸€å€‹æ ¸å¿ƒå­è§€é»ã€‚
â—¦
ä¸‰ä½•è«–è¿° (WHAT, WHY, HOW)ï¼š æ¯å€‹è«–é»éƒ½æ‡‰æ¸…æ™°é—¡æ˜ã€Œæ˜¯ä»€éº¼ã€ï¼ˆWHATï¼Œè©²è§€é»çš„å…§å®¹ï¼‰ã€æ¢è¨ã€Œç‚ºä»€éº¼ã€ï¼ˆWHYï¼Œè©²è§€é»æˆç«‹çš„åŸå› æˆ–å…¶å½±éŸ¿ï¼‰ä»¥åŠæä¾›ç›¸é—œçš„ã€Œå¦‚ä½•é«”ç¾/å½±éŸ¿ã€ï¼ˆHOWï¼Œå…·é«”ä¾‹å­æˆ–è©³ç´°èªªæ˜ï¼‰çš„ä¾‹è­‰æˆ–åˆ†æï¼Œä»¥å¢å¼·è«–è­‰çš„èªªæœåŠ›ã€‚
â—¦
èˆ‰ä¾‹è«–è­‰ï¼š é‹ç”¨æ­·å²äººç‰©ã€æ–‡å­¸å…¸æ•…ã€å“²å­¸æ€æƒ³ã€åè¨€è­¦å¥æˆ–å…·é«”äº‹ä»¶ä½œç‚ºä¾‹å­ï¼Œæœ‰æ•ˆæ”¯æ’è«–é»ã€‚è«–è­‰æ‡‰å…·é«”ã€è©³ç›¡ï¼Œä¸¦èˆ‡è«–é»ç·Šå¯†çµåˆã€‚ä¾‹å­æ•¸é‡ä¸å®œå¤ªå¤šï¼Œè«–è­‰å¿…é ˆæ·±å…¥ã€‚
â—¦
åƒè€ƒã€Šè«–å¾—å¤±ã€‹çš„ä¸»é«”å¯«æ³•ï¼š
â–ª
è«–é»ä¸€ (åŸ·è‘—æ–¼å¾—å¤±çš„æ„šæ˜§)ï¼š ä»¥ã€Œå¡µå¯°çš„ä¸€åˆ‡ååˆ©éƒ½ä¸éæ˜¯è™›ç„¡çš„é¡èŠ±æ°´æœˆã€ç‚ºæ ¸å¿ƒï¼Œé‹ç”¨ç§¦ç‹ã€æ›¹å­Ÿå¾·ç­‰æ­·å²äººç‰©çš„åŠŸç¸¾æœ€çµ‚æ­¸æ–¼è™›ç„¡çš„ä¾‹å­ï¼Œæœ‰åŠ›è«–è­‰äº†åŸ·è‘—æ–¼ä¸€æ™‚å¾—å¤±çš„ç„¡ç›Šèˆ‡æ„šæ˜§ã€‚æ­¤è™•é«”ç¾äº†å°ã€Œå¾—ã€çš„ã€Œåˆ†æ‹†è«–è¿°ã€ã€‚
â–ª
è«–é»äºŒ (å¾—å¤±çš„ç›¸å°æ€§èˆ‡è¾¯è­‰)ï¼š ä»¥ã€Œå¾—èˆ‡å¤±åªæ˜¯ç›¸å°çš„æ¦‚å¿µï¼Œä»»ä½•åŸ·è‘—éƒ½æ˜¯ç‹­éš˜çš„åè¦‹ã€ç‚ºæ ¸å¿ƒï¼Œé‹ç”¨å¡ç¿å¤±é¦¬ã€æ¨—æ¨¹ï¼ˆç„¡ç”¨ä¹‹ç”¨ï¼‰ã€æœç”«ï¼ˆã€Œè©©çª®è€Œå¾Œå·¥ã€ï¼‰ç­‰æ­£é¢ä¾‹å­ï¼Œé—¡è¿°è¡¨é¢ä¹‹ã€Œå¤±ã€å¦‚ä½•æˆå°±æ·±å±¤ä¹‹ã€Œå¾—ã€ã€‚åŒæ™‚ï¼Œä¹Ÿé‹ç”¨æ¥Šä¿®ï¼ˆæƒæ‰æ”¾æ› ï¼‰å’Œè€å­ï¼ˆã€Œå…µå¼·å‰‡æ»…ã€ï¼‰çš„åé¢ä¾‹å­ï¼Œèªªæ˜è¡¨é¢ä¹‹ã€Œå¾—ã€äº¦å¯èƒ½å°è‡´ã€Œå¤±ã€ã€‚æ­¤è™•å±•ç¾äº†ç²¾å¦™çš„ã€Œåˆ†é¡è«–è¿°ã€èˆ‡ã€Œä¸‰ä½•è«–è¿°ã€ã€‚
3.
çµå°¾ (ã€Œå¾Œã€)ï¼š1
â—¦
ä¾‹å¤–æƒ…æ³/å…¶ä»–è¦–è§’ï¼š æ¢è¨ä¸»é¡Œå¯èƒ½å­˜åœ¨çš„ä¾‹å¤–æƒ…æ³ï¼Œæˆ–å¾ä¸åŒçš„ç¶­åº¦æä¾›è£œå……æ€§çš„çœ‹æ³•ï¼Œä½¿è«–è­‰æ›´å…¨é¢ã€åš´è¬¹ï¼Œé¿å…çµ•å°åŒ–1ã€‚
â—¦
æ–¹æ³•/ç­–ç•¥ï¼š é‡å°ä¸»é¡Œæå‡ºå¯¦éš›çš„è¡Œå‹•å»ºè­°ã€è½‰è®Šè§€å¿µçš„æ–¹æ³•ã€æˆ–å•Ÿç¤ºï¼Œç‚ºè®€è€…æä¾›è§£æ±ºå•é¡Œçš„æ€è·¯æˆ–äººç”Ÿæ™ºæ…§1ã€‚
â—¦
æ˜‡è¯ä¸»æ—¨ï¼š ç¸½çµå…¨æ–‡ï¼Œä¸¦å°‡ä¸»é¡Œæ˜‡è¯åˆ°æ›´æ·±å±¤æ¬¡çš„å“²å­¸ã€æ–‡åŒ–æˆ–äººç”Ÿæ€è€ƒï¼Œå¼•ç™¼è®€è€…å…±é³´ï¼Œä½¿æ–‡ç« é¤˜å‘³æ‚ é•·ã€‚å¯ä»¥æ¡ç”¨å¯Œæœ‰æ„è±¡çš„æ¯”å–»æˆ–ç™¼äººæ·±çœçš„æå•1ã€‚
â—¦
åƒè€ƒã€Šè«–å¾—å¤±ã€‹çš„çµå°¾å¯«æ³•ï¼š
â–ª
æ–¹æ³•/å“²å­¸æ€è€ƒï¼š ä»¥è˜‡è»¾ç‚ºä¾‹ï¼Œé—¡è¿°ã€Œåƒæ‚Ÿè®Šå¹»åŸæ˜¯æ°¸æ†ã€æ˜¯çœ‹é€å¾—å¤±çš„é—œéµï¼Œä¸¦é»å‡ºã€Œèˆ‡è®Šå¹»å¸¸åœ¨ã€çš„è±é”å¢ƒç•Œã€‚
â–ª
å…¶ä»–è¦–è§’/æ–¹æ³•ï¼š è€ƒæ…®åˆ°ä¸¦éäººäººçš†æœ‰è¶…ç„¶æ‚Ÿæ€§ï¼Œç¯„æ–‡æä¾›äº†ã€Œç›¸ä¿¡å‘½é‹ã€å’Œã€ŒåŠªåŠ›å¥®é¬¥ã€é€™å…©ç¨®ç¾å¯¦å¯è¡Œçš„æ–¹æ³•ï¼Œä¸¦å¼•ç”¨å¾å¿—æ‘©ã€æ³°æˆˆçˆ¾ã€æ‘ä¸Šæ˜¥æ¨¹çš„èªéŒ„åŠ ä»¥ä½è­‰ã€‚
â–ª
å‘¼æ‡‰åŠæ˜‡è¯ï¼š æœ€å¾Œä»¥ã€ŒèŠ±å¿…ç„¶é›¶è½ï¼Œä½†åŒ–ä½œæ˜¥æ³¥æ›´è­·èŠ±ã€çš„è©©æ„æ¯”å–»ï¼Œå°‡ã€Œä»Šæ—¥ä¹‹å¤±ï¼Œä¾¿æ˜¯æ˜æ—¥ä¹‹å¾—ã€çš„è¾¯è­‰é—œä¿‚æ¨å‘é«˜æ½®ï¼Œä¸¦ä»¥æå•ã€Œä½ ï¼Œè¦ºæ‚Ÿäº†å—ï¼Ÿã€ä½œçµï¼Œå¼•äººæ·±æ€ã€‚
å¯«ä½œé¢¨æ ¼è¦æ±‚ï¼š
â€¢
èªè¨€ï¼š ç¹é«”ä¸­æ–‡ï¼Œä»¥ç™½è©±ç‚ºä¸»ï¼Œä¸è¦å¯«å¾—åƒæ–‡è¨€æ–‡ä¸€æ¨£ï¼Œç”¨è©ç²¾ç…‰ï¼Œå¯Œæœ‰æ–‡å­¸æ€§å’Œå“²ç†æ€§ï¼Œå¯é©ç•¶åŠ å…¥æ¯”å–»ã€‚
â€¢
è«–è­‰ï¼š é‚è¼¯æ¸…æ™°ï¼Œå±¤æ¬¡åˆ†æ˜ï¼Œèªªç†é€å¾¹ï¼Œå…·æœ‰å¼·çƒˆèªªæœåŠ›ã€‚
â€¢
æ·±åº¦ï¼š ä¸åƒ…åœç•™åœ¨è¡¨é¢ç¾è±¡ï¼Œèƒ½æ·±å…¥æŒ–æ˜ä¸»é¡ŒèƒŒå¾Œçš„æ–‡åŒ–ã€æ­·å²ã€å“²å­¸å…§æ¶µï¼Œå±•ç¾æ‰¹åˆ¤æ€§æ€ç¶­ã€‚

[è­°è«–æ–‡ç¯„ä¾‹åƒè€ƒ] è«‹åƒè€ƒä»¥ä¸‹å„ªç§€è­°è«–æ–‡çš„é¢¨æ ¼å’ŒæŠ€å·§ï¼š

ã€Šè«–å¾—å¤±ã€‹
æ¯å€‹äººå‘±å‘±å¢®åœ°æ™‚ï¼Œéƒ½æ˜¯æ‰‹ç©ºç©ºï¼Œç„¡ä¸€ç‰©ã€‚ç„¶è€Œï¼Œéš¨è‘—äººçš„å¹´ç´€æ¼¸é•·ï¼Œä¾¿é–‹å§‹è¿½åé€åˆ©ï¼Œè¬›ç©¶ã€Œç¾é…’è·‘è»Šç›¸æ©Ÿé‡‘éŒ¶ã€ï¼Œåˆ°äº†ã€Œç§’é€Ÿæ‰å¾—ç·Šäº†ï¼Œè€Œçš®è†šç«Ÿå·å·é¬†äº†ã€çš„æ™‚å€™ï¼Œäººæ‰ä¸ç¦å¹¡ç„¶å¤§æ‚Ÿï¼šåŸä¾†å•Šï¼Œäººé¡å¾ä¾†æ²’æœ‰æ±²å–æ­·å²çš„æ•™è¨“ï¼Œä»ç„¶ç„¡æ³•å¾ååˆ©çš„æ¨Šç± é€ƒè„«å‡ºå»ã€‚
å…¶å¯¦ï¼Œå¡µå¯°çš„ä¸€åˆ‡ååˆ©éƒ½ä¸éæ˜¯è™›ç„¡çš„é¡èŠ±æ°´æœˆï¼Œçª®å…¶ä¸€ç”Ÿæ±²æ±²ç‡Ÿç‡Ÿåªæœƒå¾’å‹ç„¡åŠŸã€‚è©¦æ†¶æƒ³ï¼Œå¤šå°‘é¢¨æµäººç‰©çš„åŠŸç¸¾éƒ½åœ¨æ­·å²æ´ªæµçš„æ²–åˆ·ä¸‹è•©ç„¶ç„¡å­˜ï¼Ÿç§¦ç‹æƒå…­åˆï¼Œè™è¦–ä½•é›„å“‰ï¼Œå¦‚ä»Šå»åªè³¸å¾—é‡‘æ£ºå¯’ç°ï¼Œä»¥åŠé•·åŸ‹åœ¨é©ªå±±çš„æ·±åœŸè£é»˜ç„¶æ‡ºæ‚”çš„éˆé­‚ï¼›æ›¹å­Ÿå¾·äº¦é›„éœ¸ä¸€æ™‚ï¼Œæ©«æ§Šè³¦è©©ï¼Œå»åªæ›ä¾†äº†æ±—é’ä¸Šä¸€ç­†ã€Œå¥¸é›„ã€ã€‚å³ä½¿åŠŸæ¥­å¤šéº¼èµ«ç„¶ï¼Œå¤šéº¼è¼ç…Œï¼Œå»ä¾ç„¶æ•µä¸éæ™‚é–“çš„æ·˜æ´—ï¼Œæ‰€æœ‰æˆå°±éƒ½çµ‚å°‡ææƒšå¦‚è™›å¹»çš„é¡èŠ±æ°´æœˆï¼Œå¯è¦‹åŸ·è‘—æ–¼å¾—å¤±æ˜¯ä½•å…¶æ„šæ˜§ï¼Œä½•å…¶ä¸æ™ºã€‚
æ³ä¸”ï¼Œå¾—èˆ‡å¤±åªæ˜¯ç›¸å°çš„æ¦‚å¿µï¼Œä»»ä½•åŸ·è‘—éƒ½æ˜¯ç‹¹éš˜çš„åè¦‹ã€‚æ‰€è¬‚ã€Œç¦å…®ç¦ä¹‹æ‰€è—ï¼Œç¦å…®ç¦ä¹‹æ‰€å€šã€ï¼Œä¸€å¦‚å¡ç¿å¤±é¦¬ï¼Œç„‰çŸ¥éç¦ï¼Ÿã€Šé€é™éŠã€‹ä¸­è‡ƒè…«å½æ›²çš„æ¨—æ¨¹ï¼Œç«‹æ–¼å¡—è€ŒåŒ è€…ä¸é¡§ï¼Œä½†æ­£å› ç‚ºå…¶ã€Œç„¡ç”¨ã€ï¼Œæ‰èƒ½æˆå°±å…¶ã€Œç”¨ã€ï¼Œå¾—ä»¥å…¨é¤Šå¤©å¹´ã€‚è¡¨é¢æ˜¯ã€Œå¤±ã€ï¼Œä½†æ–¼æ¨—æ¨¹è€Œè¨€ï¼Œå»å¯ç¨±å¾—ä¸Šã€Œå¾—ã€ã€‚åˆå¦‚æœç”«ï¼Œä¸€ç”Ÿæ‡·æ‰ä¸é‡ï¼Œé¡›æ²›æµé›¢ï¼Œä»¿ä½›æ˜¯ä¸€æ²™é·—æ†å¹´é£„æ³Šæ–¼å¤©åœ°é–“ï¼Œä½†å®‹ä»£æ­é™½ä¿®æ›¾è¬‚ã€Œè©©çª®è€Œå¾Œå·¥ã€ï¼ŒæŒ‡æ–‡äººçª®å›°ä¸å¾—å¿—ï¼Œæ‰èƒ½å¯«å‡ºå‹•äººè‚ºè…‘ä¹‹ä½œã€‚å¾Œäººå°Šæœç”«ç‚ºã€Œè©©å²ã€å’Œã€Œè©©è–ã€ï¼Œç„¶è€Œè‹¥å¤©ä¸æŒ«å…¶éŠ³å¿—ï¼Œä¸æ•™ä»–å‹ç­‹éª¨ã€é¤“é«”è†šï¼Œå³ä½¿æœç”«èƒ½å¦™ç­†ç”ŸèŠ±ï¼Œæœ‰ç¿»æ°´æˆè©©ä¹‹æ‰ï¼Œäº¦ä¸å…æ·ªç‚ºç„¡ç—…å‘»åŸï¼Œæ—¥æ—¥æš¢è© é¢¨èŠ±é›ªæœˆçš„å°è©©äººï¼Œåˆå¦‚ä½•å¯«å¾—å‡ºã€ŠåŒ—å¾ã€‹ç­‰æ‚²å¤©æ†«äººã€éœ‡å¤çˆä»Šä¹‹ä½œï¼Ÿåä¹‹ï¼Œä¸–äººçœ¼ä¸­çš„ã€Œå¾—ã€å…¨ç„¶æ˜¯ã€Œå¾—ã€å—ï¼Ÿä¸ç„¶ã€‚æ¥Šä¿®æ‰è¯æ©«æº¢ï¼Œå»å› æ­¤æƒæ‰æ”¾æ› ï¼Œä¸å¾—å–„çµ‚ã€‚è€å­åˆæ›°ï¼šã€Œå…µå¼·å‰‡æ»…ã€‚ã€è»éšŠå¼·å¤§ï¼Œå»æœƒæˆç‚ºçœ¾çŸ¢ä¹‹çš„ï¼Œé­åˆ°åœæ®²ã€‚å¯è¦‹ï¼Œå¾—èˆ‡å¤±æ˜¯ä¸€é«”å…©é¢ï¼ŒåŸ·è‘—æ–¼å…¶ä¸­ä¸€è€…ï¼Œéƒ½ç„¡ç•°æ–¼ç®¡ä¸­çªºè±¹ï¼Œçå­æ‘¸è±¡ï¼Œå¿…ä¸å¾—è¦‹äº‹ç‰©çš„çœŸè±¡å’Œå…¨è²Œã€‚
è“‹å°‡è‡ªå…¶è®Šè€…è€Œè§€ä¹‹ï¼Œå‰‡å¤©åœ°æ›¾ä¸èƒ½ä»¥ä¸€ç¬ï¼›è‡ªå…¶ä¸è®Šè€…è€Œè§€ä¹‹ï¼Œå‰‡ç‰©èˆ‡æˆ‘çš†ç„¡ç›¡ä¹Ÿï¼Œè€Œåˆä½•ç¾¨ä¹ï¼Ÿ
è˜‡è»¾çš„ã€Šå‰èµ¤å£è³¦ã€‹æˆ–å¯ç‚ºæœ¬æ–‡è½ä¸‹æ–‡å­¸æ€§å’Œå“²å­¸æ€§çš„è¨»è…³ã€‚è¦çœŸæ­£çœ‹é€å¾—å¤±ï¼Œä¾¿é ˆåƒæ‚Ÿè®Šå¹»åŸæ˜¯æ°¸æ†ã€‚æœˆæœ‰é™°æ™´åœ“ç¼ºï¼Œäººæœ‰æ‚²æ­¡é›¢åˆã€‚æ—¢ç„¶ä¸–ç•Œæ°¸é éƒ½è®Šå¹»ç„¡å®šï¼Œæˆ‘å€‘ä½•ä¸ä»¿å‚šæ±å¡è±é”è‡ªé©ï¼Ÿè¢«è²¶å¶ºå—ï¼Œæ˜¯çœ¾äººçœ¼ä¸­çš„ã€Œå¤±ã€ï¼Œä½†è˜‡è»¾å»èƒ½è‡ªã€Œå¾—ã€å…¶æ¨‚ï¼Œæ—¥å•–è”æä¸‰ç™¾é¡†ï¼Œä¸è¾­é•·ä½œå¶ºå—äººï¼›è¬«å®¦å„‹æ´²ï¼Œæ›´æ˜¯ä¹æ­»ä¸€ç”Ÿï¼Œç„¶è€Œè˜‡è»¾åˆå¾å®é£Ÿæª³æ¦”æ„Ÿå—åˆ°æ–°é®®å’Œåªšå«µçš„æ»‹å‘³ã€‚è˜‡è»¾èƒ½ä¸€æ¬¡åˆä¸€æ¬¡åœ¨çµ•å¢ƒä¸­å®‰è²§æ¨‚å‘½ï¼Œæ­£ç”±æ–¼ä»–èˆ‡è®Šå¹»å¸¸åœ¨ã€‚è‹¥èªªä¸–äº‹æ˜¯å½¢æ…‹ä¸å®šçš„å®¹å™¨ï¼Œé‚£éº¼è˜‡è»¾å°±æ˜¯ä¸Šå–„çš„æ°´ï¼Œèƒ½éš¨å½¢è€Œæ–¹åœ“ï¼Œéš¨å‹¢è€Œè®Šé€šã€‚è‹¥èƒ½è‡»æ­¤è‡³å¢ƒï¼Œä¾¿èƒ½çœ‹é€å¾—å¤±ï¼Œå¯µè¾±ä¸é©šï¼Œå¦è•©é€é™ã€‚ç•¶å¿ƒä¸­æ²’æœ‰æ†‚æˆšï¼Œä¾¿æ˜¯æœ€å¤§çš„å¹¸ç¦ï¼Œä¾¿æ˜¯çœŸæ­£çš„ã€æ°¸æ†çš„ã€Œå¾—ã€ã€‚
é›–ç„¶ï¼Œä¸æ˜¯æ¯å€‹äººéƒ½åƒè˜‡è»¾ä¸€æ¨£æœ‰è¶…ç„¶ç‰©å¤–çš„æ‚Ÿæ€§ï¼Œä½†èµ·ç¢¼æˆ‘å€‘é‚„èƒ½ç›¸ä¿¡å‘½é‹å’ŒåŠªåŠ›ã€‚å¾å¿—æ‘©åœ¨ã€Šè‡´æ¢å•Ÿè¶…ã€‹ä¸€è©©ä¸­å¯«é“ï¼šã€Œå¾—ä¹‹æˆ‘å¹¸ï¼Œå¤±ä¹‹æˆ‘å‘½ã€‚ã€åœ¨èŒ«èŒ«çš„äººæµ·ï¼Œè‹¥èƒ½å¾—åˆ°éˆé­‚ä¼´ä¾¶ï¼Œæ˜¯æˆ‘çš„æ¦®å¹¸ï¼›è‹¥å¤±å»äº†ï¼Œä¹Ÿä¸éæ˜¯æˆ‘çš„å‘½é‹ã€‚å‘½é‹ï¼Œä¹Ÿè¨±æ˜¯æˆ‘å€‘èƒ½å¤ é‡‹ç„¶çš„æœ€å¤§ç†ç”±ã€‚æ—¢ç„¶å‘½å®šå¦‚æ­¤ï¼Œæˆ‘å€‘åˆä½•ç”¨åŸ·è‘—ï¼Ÿæˆ–è¨±ä½ åˆæœƒèªªï¼šã€Œæˆ‘å¾ä¸ç›¸ä¿¡å‘½é‹ã€‚ã€é‚£éº¼ä½ ä¹Ÿèƒ½å¾å°åº¦è©©äººæ³°æˆˆçˆ¾ã€Šé£›é³¥é›†ã€‹å¾—åˆ°ä¸€äº›å•Ÿç™¼ï¼šã€Œè‹¥ä½ å› ç‚ºéŒ¯éå¤ªé™½è€Œæµæ·šï¼Œé‚£éº¼ä½ ä¹Ÿå¿…å°‡éŒ¯éç¾¤æ˜Ÿã€‚ã€è‹¥ä½ å› ç‚ºå¤±è€Œæ‚±æƒ»é¬±æ‚¶ï¼Œé‚£éº¼çµ‚å°‡æœƒå¤±å»æ›´å¤šã€‚æˆ‘å€‘è¦ç›¸ä¿¡ï¼Œæ†‘è—‰åŠªåŠ›çµ‚èƒ½æŒ½å›å¤±åœ°ã€‚ã€Œé€™å€‹ä¸–ç•Œä¸Šæ ¹æœ¬å°±æ²’æœ‰æ­£ç¢ºçš„é¸æ“‡ï¼Œæˆ‘å€‘åªä¸éæ˜¯è¦é€šéåŠªåŠ›å¥®é¬¥ï¼Œä½¿ç•¶åˆçš„é¸æ“‡è®Šå¾—æ­£ç¢ºã€‚ã€é›–ç„¶æ‘ä¸Šæ˜¥æ¨¹è«‡çš„æ˜¯é¸æ“‡ï¼Œè€Œæˆ‘è«–çš„æ˜¯å¾—å¤±ï¼Œä½†å…¶å¯¦å¤§åŒå°ç•°ã€‚æˆ‘æƒ³å€Ÿæ­¤ä½œç‚ºæœ¬æ–‡çš„ç¸½çµï¼šå…¶å¯¦ä¸–ç•Œä¸Šæ ¹æœ¬æ²’æœ‰çœŸæ­£çš„å¾—èˆ‡å¤±ï¼Œæˆ‘å€‘åªä¸éæ˜¯é€šéåŠªåŠ›å¥®é¬¥ï¼Œä½¿ç•¶åˆçš„å¤±è½‰åŒ–ç‚ºå¾—ï¼Œäº¦ä½¿ç•¶åˆçš„å¾—å¤±å»äº†æ¼”åŒ–æˆå¤±çš„æ¢ä»¶ã€‚
èŠ±å¿…ç„¶é›¶è½ï¼Œä½†åŒ–ä½œæ˜¥æ³¥æ›´è­·èŠ±ã€‚ä»Šæ—¥ä¹‹å‡‹è•ªï¼Œä¾¿æ˜¯æ˜æ—¥ä¹‹è‘³è•¤ï¼›ä»Šæ—¥ä¹‹å¤±ï¼Œä¾¿æ˜¯æ˜æ—¥ä¹‹å¾—ã€‚ä½ ï¼Œè¦ºæ‚Ÿäº†å—ï¼Ÿ

[é‡è¦æé†’]
1. æ°¸é ä¸è¦å±•ç¤ºæ€è€ƒéç¨‹ï¼Œä¸è¦æœ‰ä»»ä½•å°æ¨™é¡Œæˆ–éä¸­æ–‡çš„ç¬¦è™Ÿï¼Œç”Ÿæˆçµæœåªæ‡‰æœ‰æ–‡ç« ï¼›
2. è«–æ“šå’Œäº‹ä¾‹çš„æ•¸é‡éçŒ¶ä¸åŠï¼Œä¸€æ®µçš„è«–æ“šä¸è¦è¶…éå…©å€‹ï¼Œè¦é‡è¦–è³ªé‡ï¼Œå³å¼•ä¾‹å¾Œçš„è«–è­‰éç¨‹è¦åš´è¬¹ã€‚å…¨æ–‡è«–æ“šå®œå…¼åŠå¤ä»Šä¸­å¤–ï¼›
3. å®œé‹ç”¨å…ˆç ´å¾Œç«‹æˆ–å…ˆç«‹å¾Œç ´çš„æ–¹æ³•åšé§è«–ã€‚
4. ä¸è¦ç”¨ã€Œ""ã€ï¼Œè¦ç”¨ä¸­æ–‡çš„é–‹é—œå¼•è™Ÿã€‚
5. ç«‹å ´å¿…é ˆé®®æ˜ï¼Œä¸è¦ä¿æŒä¸­ç«‹ã€‚ä¾‹å¦‚ã€Œç¨è™•æ¯”ç¤¾äº¤æ›´èƒ½ä»¤äººæˆé•·ã€‚ä½ åŒæ„å—ï¼Ÿã€ï¼Œä¸€å®šè¦æ˜ç¢ºä»¥ã€Œç¨è™•ã€æˆ–è€…ã€Œç¤¾äº¤ã€ç‚ºç«‹å ´ä½œè«–è¿°ï¼Œæ¯”è¼ƒå…©è€…ä¸­ä½•è€…æ›´èƒ½ä»¤äººæˆé•·ï¼Œä¸å¯ä»¥ä¿æŒä¸­ç«‹ï¼Œå³æŒ‡å‡ºå…©è€…å„æœ‰å¥½è™•ã€‚

[æœ€çµ‚æŒ‡ä»¤] è«‹ç›´æ¥è¼¸å‡ºé«˜è³ªé‡DSEè­°è«–æ–‡ï¼Œå­—æ•¸å¿…é ˆå¼·åˆ¶æ§åˆ¶åœ¨1200è‡³1300å­—å…§ã€‚ä¸è¦æ·»åŠ ä»»ä½•è§£é‡‹ã€æ¨™é¡Œæˆ–æ€è€ƒéç¨‹ï¼Œç”Ÿæˆçµæœåªæœ‰æ–‡ç« åŠä¸­æ–‡æ¨™é»ç¬¦è™Ÿï¼Œä¸è¦è¶…å‡ºå­—æ•¸ã€‚ä¸»é¡Œå¥å¿…é ˆæ¸…æ™°ï¼Œè«–æ“šå’Œä¾‹å­æ•¸é‡é©å¯è€Œæ­¢ï¼Œå¦å‰‡ä¾¿éçŒ¶ä¸åŠï¼Œå¼•ä¾‹å¾Œè«–è­‰å¿…é ˆæ·±å…¥åš´è¬¹ã€‚ä»¥ç´”ç™½è©±å¯«æˆï¼Œä¸è¦ç©¿æ’æ–‡è¨€çš„å¥å¼ã€‚ä¸€æ®µçš„è«–æ“šçµ•å°ä¸å¯è¶…éå…©å€‹ï¼Œè€Œä¸”è¦æ³¨æ„å…¨æ–‡å¹³è¡¡ï¼Œè‹¥ä¸Šæ®µå·²å¼•äº†ä¸å°‘ä¾‹å­ï¼Œä¸‹æ–‡å‰‡è¦éæ¸¡èˆ’ç·©å…¶ç¯€å¥ï¼Œä»¤ä¿¡æ¯é‡ä¸è¦éé«˜ï¼Œä½¿è®€è€…é–±è®€æ™‚æœ‰å–˜æ¯çš„ç©ºé–“ã€‚
    </pre></div>
    
    <div class="container">
        <header>
            <h1>ç¿»æ°´ï¼è­°</h1>
            <p>æˆ‘çš„éˆé­‚è—åœ¨æ–‡å­—çš„èƒŒå¾Œ</p>
        </header>
        <main>
            <div class="controls">
                <div class="control-group">
                    <label for="topic-input">æ–‡ç« é¡Œç›®</label>
                    <input type="text" id="topic-input" placeholder="ä¾‹å¦‚ï¼šã€Šè«–å¾—å¤±ã€‹">
                </div>
                <div class="control-group">
                    <label for="guidelines-input">å‰µä½œæŒ‡å¼•</label>
                    <textarea id="guidelines-input" placeholder="è«‹è¼¸å…¥æ–‡ç« çš„é¢¨æ ¼ã€è«–é»å¤§ç¶±æˆ–é—œéµè©..."></textarea>
                </div>
                <div class="control-group">
                    <label>é è¨­å­—æ•¸</label>
                    <div class="word-count-control">
                        <button class="word-count-btn" id="decrease-words">-</button>
                        <span id="word-count-display">1500</span>
                        <button class="word-count-btn" id="increase-words">+</button>
                    </div>
                </div>
               <!-- â˜…â˜…â˜… è«‹ä¿®æ”¹ç‚ºä»¥ä¸‹å…§å®¹ â˜…â˜…â˜… -->
<div class="control-group">
    <label>é¸æ“‡æ¨¡å‹</label>
    <div class="style-selector">
        <label>
            <!-- é­šæœ¨è¨­å®šç‚º deepseek -->
            <input type="radio" name="model" value="gemini" checked>
            <span>é­šæœ¨</span>
        </label>
        <label>
            <!-- æ°´å¿ƒè¨­å®šç‚º gemini -->
            <input type="radio" name="model" value="gemini">
            <span>æ°´å¿ƒ</span>
        </label>
    </div>
</div>
                <button class="generate-btn" id="generate-btn">ç”Ÿæˆæ–‡ç« </button>
            </div>
            <div class="output">
                <div id="essay-placeholder">éœå¾…éˆæ„Ÿ ...</div>
                <div id="output-toolbar" class="output-toolbar" style="display:none;">
                    <span id="output-word-count"></span>
                    <button id="copy-btn" class="icon-btn" title="è¤‡è£½å…¨æ–‡"></button>
                </div>
                <div id="generated-essay" style="display:none;"></div>
                <div id="loader" class="loader" style="display:none;"></div>
            </div>
        </main>
    </div>


    <script>

        // ===============================================================
// === [ç¥æ€é€šç”¨çµ„ä»¶] æ¬Šé™æ””æˆªå™¨ & è«è˜­è¿ªæç¤ºçª— (å«ç™»å…¥é€£çµ) ===
// ===============================================================
(function() {
    // é˜²æ­¢é‡è¤‡æ³¨å…¥
    if (window.SansiInterceptorLoaded) return;
    window.SansiInterceptorLoaded = true;

    // --- 1. è‡ªå‹•æ³¨å…¥è«è˜­è¿ª CSS ---
    const style = document.createElement('style');
    style.textContent = `
        /* è«è˜­è¿ªé®ç½© */
        .sansi-limit-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(253, 252, 248, 0.88); /* ç±³ç™½é«˜æ¨¡ç³Š */
            backdrop-filter: blur(6px);
            z-index: 9999999; /* æœ€é«˜å±¤ç´š */
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .sansi-limit-show { opacity: 1; }

        /* è¦–çª—å¡ç‰‡ */
        .sansi-limit-card {
            background: #fdfcf8;
            border: 1px solid #e0ddd7;
            border-radius: 16px;
            padding: 30px 25px;
            width: 90%; max-width: 380px;
            box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15);
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            font-family: 'Noto Serif TC', serif;
        }
        .sansi-limit-show .sansi-limit-card { transform: translateY(0); }

        /* åœ–ç¤ºèˆ‡æ–‡å­— */
        .sansi-limit-icon { font-size: 3rem; color: #d69a92; margin-bottom: 15px; } /* è±†æ²™ç´… */
        .sansi-limit-title { color: #5d4037; font-size: 1.4rem; font-weight: bold; margin: 0 0 10px 0; }
        .sansi-limit-desc { color: #888; font-size: 1rem; line-height: 1.6; margin-bottom: 25px; text-align: justify; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .sansi-btn-group { display: flex; gap: 12px; margin-top: 20px; }

        .sansi-limit-btn {
            border: none; padding: 10px 0; border-radius: 50px;
            font-size: 0.95rem; font-weight: bold; cursor: pointer;
            transition: all 0.2s; font-family: 'Noto Serif TC', serif;
            flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px;
            text-decoration: none;
        }

        /* ä¸»æŒ‰éˆ• (å‰å¾€ç™»å…¥) - è«è˜­è¿ªç¶  */
        .btn-primary { 
            background: #8fa398; color: white; 
            box-shadow: 0 4px 12px rgba(143, 163, 152, 0.4);
        }
        .btn-primary:hover { background-color: #7d9186; transform: translateY(-2px); }

        /* æ¬¡æŒ‰éˆ• (é—œé–‰) - æ·ºç° */
        .btn-secondary { 
            background: #f0f0f0; color: #777; 
        }
        .btn-secondary:hover { background-color: #e5e5e5; }
    `;
    document.head.appendChild(style);

    // --- 2. è‡ªå‹•æ³¨å…¥ HTML (å½ˆå‡ºè¦–çª—) ---
    const modalHTML = `
        <div id="sansiLimitModal" class="sansi-limit-overlay">
            <div class="sansi-limit-card">
                <div class="sansi-limit-icon">
                    <i class="fas fa-user-lock"></i>
                </div>
                <div class="sansi-limit-title">éœ€è¦ç™»å…¥</div>
                <div class="sansi-limit-desc">
                    è¨ªå®¢æ¯æ—¥é«”é©—é¡åº¦å·²è€—ç›¡ã€‚<br>
                    è«‹å‰å¾€ã€Œç¥æ€ã€ä¸»é ç™»å…¥å­¸æ ¡å¸³è™Ÿï¼Œå³å¯è§£é–ç„¡é™ä½¿ç”¨æ¬Šé™ã€‚
                </div>
                <div class="sansi-btn-group">
                    <button class="sansi-limit-btn btn-secondary" onclick="closeSansiLimitModal()">
                        ç¨å¾Œ
                    </button>
                    <!-- é»æ“Šç›´æ¥è·³è½‰è‡³ç¥æ€ä¸»é  -->
                    <button class="sansi-limit-btn btn-primary" onclick="window.location.href='https://kenchan20141.github.io/AIChinese/'">
                        <i class="fas fa-sign-in-alt"></i> å‰å¾€ç™»å…¥
                    </button>
                </div>
            </div>
        </div>
    `;
    const div = document.createElement('div');
    div.innerHTML = modalHTML;
    document.body.appendChild(div);

    // --- 3. å®šç¾©é—œé–‰è¦–çª—èˆ‡æ¸…ç†å‡½å¼ ---
    window.closeSansiLimitModal = function() {
        const modal = document.getElementById('sansiLimitModal');
        if (modal) {
            modal.classList.remove('sansi-limit-show');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
            
            // è‡ªå‹•å˜—è©¦é—œé–‰å„ç¨®å·¥å…·çš„ Loading ç‹€æ…‹ï¼Œé˜²æ­¢ç•«é¢å¡æ­»
            if (typeof hideProgress === 'function') hideProgress(); // é¡Œå­³
            if (typeof hideLoading === 'function') hideLoading();   // ç¿»æ°´/å¯«ä½œ
            
            // å¦‚æœæŒ‰éˆ•è¢«ç¦ç”¨ï¼Œå˜—è©¦è§£é– (é‡å°é€šç”¨æŒ‰éˆ• class)
            const disabledBtns = document.querySelectorAll('button:disabled');
            disabledBtns.forEach(btn => btn.disabled = false);
        }
    };

    // --- 4. æ””æˆªå™¨æ ¸å¿ƒé‚è¼¯ ---
    const originalFetch = window.fetch;
    
    window.fetch = async function(url, options) {
        // åƒ…æ””æˆª AI è«‹æ±‚
        if (typeof url === 'string' && url.includes('pollinations.ai')) {
            
            // A. å³æ™‚æª¢æŸ¥ç™»å…¥ç‹€æ…‹ (æ¯æ¬¡è«‹æ±‚éƒ½æœƒé‡æ–°è®€å–ï¼Œé˜²æ­¢ç™»å‡ºå¾Œä»èƒ½ä½¿ç”¨)
            const s = localStorage.getItem('studentProfile');
            
            if (s) {
                // å·²ç™»å…¥ï¼šæ”¾è¡Œ
                return originalFetch(url, options);
            }

            // B. æœªç™»å…¥ï¼šæª¢æŸ¥é¡åº¦
            const today = new Date().toLocaleDateString('zh-HK');
            const toolName = document.title || "UnknownTool"; 
            const storageKey = `sansi_guest_usage_${toolName}_${today}`;
            
            let currentCount = parseInt(localStorage.getItem(storageKey) || "0");

            // C. è¶…éé¡åº¦ -> é˜»æ“‹ä¸¦å½ˆçª—
            if (currentCount >= 1) {
                // é¡¯ç¤ºè¦–çª—
                const modal = document.getElementById('sansiLimitModal');
                modal.style.display = 'flex';
                // å¼·åˆ¶é‡ç¹ªä»¥è§¸ç™¼éæ¸¡å‹•ç•«
                void modal.offsetWidth; 
                modal.classList.add('sansi-limit-show');

                // å›å‚³éŒ¯èª¤ä»¥ä¸­æ–·åŸæœ¬ç¨‹å¼çš„åŸ·è¡Œ
                return Promise.reject(new Error("Guest Limit Exceeded"));
            }

            // D. æœªè¶…é -> è¨˜éŒ„ä¸¦æ”¾è¡Œ
            localStorage.setItem(storageKey, currentCount + 1);
            console.log(`[è¨ªå®¢] ${toolName} ä½¿ç”¨ç¬¬ ${currentCount + 1} æ¬¡`);
        }

        return originalFetch(url, options);
    };
    
    console.log("âœ… ç¥æ€é€šç”¨æ¬Šé™é– (å«ç™»å…¥é€£çµ) å·²å•Ÿå‹•");
})();
</script>




    
   <script>
        // ä¾†è‡ªæ‚¨çš„è©•åˆ†ç³»çµ±ç¨‹å¼ç¢¼ (å®Œå…¨ä¿ç•™)
        // æ³¨æ„ï¼šé€™äº›å‡½æ•¸ä¸»è¦ç”¨æ–¼æ§‹å»ºç™¼é€çµ¦AIçš„æŒ‡ä»¤ï¼Œå‰ç«¯ä¸æœƒç›´æ¥èª¿ç”¨å®ƒå€‘ä¾†é¡¯ç¤ºè©•åˆ†ã€‚
        function displayFullCommentWithGrading(containerId, apiResponse, uniqueIdPrefix, fullTextContent) {

            // åœ¨æ›´æ–°innerHTMLä¹‹å‰ï¼Œå…ˆéŠ·æ¯€èˆŠçš„åœ–è¡¨å¯¦ä¾‹
            const instanceName = `${uniqueIdPrefix}_radarChartInstance`;
            if (window[instanceName]) {
                window[instanceName].destroy();
                window[instanceName] = null; // æ¸…é™¤è®Šæ•¸å¼•ç”¨
            }

            const resultContainer = document.getElementById(containerId);

            const gradingMatch = apiResponse.match(/<grading_json>([\s\S]*?)<\/grading_json>/);
            const critiqueMatch = apiResponse.match(/<critique>([\s\S]*?)<\/critique>/);
            const suggestionsMatch = apiResponse.match(/<suggestions>([\s\S]*?)<\/suggestions>/);
            const rewriteMatch = apiResponse.match(/<rewrite_example>([\s\S]*?)<\/rewrite_example>/);

            let finalHTML = "<h3>é™³SIRé»è©•ï¼š</h3>";
            let initialScores = {};

            if (gradingMatch && gradingMatch[1]) {
                const gradingJSON = gradingMatch[1].trim();
                try {
                    const scores = JSON.parse(gradingJSON);

                    // === ã€æ ¸å¿ƒä¿®è¨‚ï¼šV8 ç‰ˆè©•åˆ†è¯å‹•é‚è¼¯ã€‘ ===
                    if (scores.radar && scores.radar.æ‰£é¡Œ !== undefined) {

                        // æ­¥é©Ÿä¸€ï¼šç²å–æ‰€æœ‰å¾ AI å›å‚³çš„åŸå§‹åˆ†æ•¸
                        let final = {
                            kouTi: scores.radar.æ‰£é¡Œ,
                            xiangLue: scores.radar.è©³ç•¥,
                            structure: scores.structure,
                            liYi: scores.radar.ç«‹æ„,
                            quCai: scores.radar.å–æ,

                            ciHui: scores.radar.è©å½™, 
                            wenXueXing: scores.radar.æ–‡å­¸æ€§, 
                            expression: scores.expression,
                            content: scores.content
                        };

                        // --- æ­¥é©ŸäºŒï¼šæŒ‰åš´æ ¼é †åºæ‡‰ç”¨æ‰€æœ‰ç´°é …åˆ†æ•¸çš„èª¿æ•´è¦å‰‡ ---

                        if (final.kouTi >= 5) {
                            final.liYi = Math.max(final.liYi, 5);
                            final.quCai = Math.max(final.quCai, 5);
                        }

                        if (final.kouTi <= 6) {
                            final.liYi = Math.min(final.liYi, 5);
                            final.quCai = Math.min(final.quCai, 5);
                        }

                        if (final.kouTi <= 5) {
                            final.xiangLue = Math.min(final.xiangLue, 4);
                            final.structure = Math.min(final.structure, 4);
                        }

                        if (final.ciHui <= 6 && final.wenXueXing <= 6) { 
                            final.liYi = Math.min(final.liYi, 6);
                            final.quCai = Math.min(final.quCai, 6);
                        }

                        if (!(final.liYi >= 7 && final.quCai >= 7)) {
                            final.ciHui = Math.min(final.ciHui, 8); 
                            final.wenXueXing = Math.min(final.wenXueXing, 8); 
                        }

                        final.quCai = Math.min(final.quCai, final.liYi);

                        // --- æ­¥é©Ÿä¸‰ï¼šæ ¹æ“šèª¿æ•´å¾Œçš„ç´°é …åˆ†æ•¸ï¼Œé‡æ–°è¨ˆç®—ä¸‰å¤§ä¸»é …çš„æœ€çµ‚åˆ†æ•¸ ---

                        if (final.kouTi <= 4) {
                            let tempContentScore = final.kouTi; 
                            tempContentScore = Math.min(tempContentScore, 4); 
                            tempContentScore = Math.max(tempContentScore, 2); 
                            final.content = tempContentScore; 
                        } else {
                            if (final.liYi === 10 && final.quCai === 10) {
                                final.content = 9;
                            } else if (final.liYi === 9 && final.quCai === 9) {
                                final.content = 8;
                            } else if (final.liYi === 8 && final.quCai === 8) {
                                final.content = 7;
                            } else {
                                final.content = Math.round((final.liYi + final.quCai) / 2);
                            }
                        }

                        if (final.ciHui < 8 || final.wenXueXing < 8) {
                            final.content = Math.min(final.content, 7);
                        }

                        if (final.ciHui === final.wenXueXing) {
                            final.expression = final.ciHui - 1;
                        } else {
                            final.expression = Math.min(final.ciHui, final.wenXueXing);
                        }

                        const structureLowerBound = final.content - 1; 
                        final.structure = Math.min(final.structure, final.content);
                        final.structure = Math.max(final.structure, structureLowerBound);

                        scores.content = final.content;
                        scores.expression = final.expression;
                        scores.structure = final.structure;
                        scores.radar.ç«‹æ„ = final.liYi;
                        scores.radar.å–æ = final.quCai;
                        scores.radar.è©³ç•¥ = final.xiangLue;
                        scores.radar.è©å½™ = final.ciHui;
                        scores.radar.æ–‡å­¸æ€§ = final.wenXueXing;
                        scores.radar.æ‰£é¡Œ = final.kouTi;
                    }

                    const isFullTextWriting = (uniqueIdPrefix === 'narrative' || uniqueIdPrefix === 'argument');

                    if (isFullTextWriting) {
                        const wordCount = fullTextContent.length;

                        if (wordCount < 900) {
                            scores.content = Math.min(scores.content, 5);
                            scores.structure = Math.min(scores.structure, 5);

                            if (scores.radar) {
                                scores.radar.ç«‹æ„ = Math.min(scores.radar.ç«‹æ„, 5);
                                scores.radar.å–æ = Math.min(scores.radar.å–æ, 5);
                                scores.radar.è©³ç•¥ = Math.min(scores.radar.è©³ç•¥, 5);
                            }
                        }
                    }

                    initialScores = scores;
                } catch (e) {
                    console.error("è§£æè©•ç­‰ JSON å¤±æ•—:", e, "æ”¶åˆ°çš„å…§å®¹:", gradingJSON);
                }
            }
        }

        // å‰ç«¯äº’å‹•èˆ‡ API ä¸²æ¥é‚è¼¯
        document.addEventListener('DOMContentLoaded', () => {
            const topicInput = document.getElementById('topic-input');
            const guidelinesInput = document.getElementById('guidelines-input');
            const decreaseBtn = document.getElementById('decrease-words');
            const increaseBtn = document.getElementById('increase-words');
            const wordCountDisplay = document.getElementById('word-count-display');
            const generateBtn = document.getElementById('generate-btn');
            const essayPlaceholder = document.getElementById('essay-placeholder');
            const generatedEssay = document.getElementById('generated-essay');
            const loader = document.getElementById('loader');
            const outputToolbar = document.getElementById('output-toolbar');
            const outputWordCount = document.getElementById('output-word-count');
            const copyBtn = document.getElementById('copy-btn');
            
// --- 1. å®šç¾©æ–°çš„ GAS å¾Œç«¯ç¶²å€ ---
            const CLOUDFLARE_WORKER_URL = "https://script.google.com/macros/s/AKfycbzaAnSXaaCohL8b92B7bRzhMk3cMr7hhoQc1icKSr_Oy1JLFUPV32jbouJIKfEIgUepeA/exec";

            // ç´¢å¼•ï¼Œç”¨ä¾†è¨˜éŒ„æˆ‘å€‘ç¾åœ¨è©²ç”¨ç¬¬å¹¾å€‹ KEYã€‚
            // ç¨‹å¼ä¸­ï¼Œåˆ—è¡¨çš„ç¬¬ä¸€å€‹é …ç›®æ˜¯å¾ 0 é–‹å§‹ç®—ï¼Œæ‰€ä»¥ 0 ä»£è¡¨ç¬¬ä¸€å€‹ KEYã€‚
            let currentKeyIndex = 0;
            
            const originalCopyIcon = `<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-5zm0 16H8V7h11v14z"/></svg>`;
            copyBtn.innerHTML = originalCopyIcon;

            let wordCount = 1500;

            const updateWordCountDisplay = () => {
                wordCountDisplay.textContent = wordCount;
            };

            decreaseBtn.addEventListener('click', () => {
                if (wordCount > 100) {
                    wordCount -= 100;
                    updateWordCountDisplay();
                }
            });

            increaseBtn.addEventListener('click', () => {
                wordCount += 100;
                updateWordCountDisplay();
            });
            
            copyBtn.addEventListener('click', () => {
                if (!generatedEssay.textContent) return;
                
                navigator.clipboard.writeText(generatedEssay.textContent).then(() => {
                    copyBtn.innerHTML = `<span class="copy-feedback">å·²è¤‡è£½ï¼</span>`;
                    setTimeout(() => {
                        copyBtn.innerHTML = originalCopyIcon;
                    }, 2000);
                }).catch(err => {
                    console.error('è¤‡è£½å¤±æ•—:', err);
                    alert('è¤‡è£½å¤±æ•—ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚');
                });
            });

            // =================================================================
            // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ 1. å»ºç«‹ä¸€å€‹åŒ…å«é‡è©¦é‚è¼¯çš„æ–°å‡½å¼
            // =================================================================
            async function generateWithRetry(payload) {
                // æˆ‘å€‘å°‡æœƒå˜—è©¦ API_KEYS.length æ¬¡ï¼Œä¹Ÿå°±æ˜¯æ¯å€‹ key éƒ½è©¦ä¸€æ¬¡
                for (let i = 0; i < API_KEYS.length; i++) {
                    const apiKeyToUse = API_KEYS[currentKeyIndex];
                    console.log(`æ­£åœ¨å˜—è©¦ä½¿ç”¨ç¬¬ ${currentKeyIndex + 1} å€‹ API Key...`);

                    try {
                        // ä½¿ç”¨ç•¶å‰çš„ key é€²è¡Œ API è«‹æ±‚
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKeyToUse}` 
                            },
                            body: JSON.stringify(payload)
                        });
                        
                        // å¦‚æœ response çš„ç‹€æ…‹ä¸æ˜¯ ok (ä¾‹å¦‚ 401, 429, 500 ç­‰éŒ¯èª¤)
                        // æˆ‘å€‘å°±æ‰‹å‹•æ‹‹å‡ºä¸€å€‹éŒ¯èª¤ï¼Œè®“å®ƒè¢«ä¸‹é¢çš„ catch å€å¡Šæ•æ‰
                        if (!response.ok) {
                            throw new Error(`API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${response.status}`);
                        }

                        // å¦‚æœç¨‹å¼èƒ½åŸ·è¡Œåˆ°é€™è£¡ï¼Œä»£è¡¨è«‹æ±‚æˆåŠŸï¼
                        console.log(`ç¬¬ ${currentKeyIndex + 1} å€‹ API Key è«‹æ±‚æˆåŠŸï¼`);
                        const data = await response.json();
                        return data; // å°‡æˆåŠŸçš„çµæœè¿”å›ï¼Œä¸¦çµæŸå‡½å¼

                    } catch (error) {
                        // å¦‚æœè«‹æ±‚å¤±æ•—ï¼ˆç„¡è«–æ˜¯ç¶²è·¯å•é¡Œé‚„æ˜¯ä¸Šé¢æ‹‹å‡ºçš„ç‹€æ…‹ç¢¼éŒ¯èª¤ï¼‰
                        console.error(`ç¬¬ ${currentKeyIndex + 1} å€‹ API Key å¤±æ•—:`, error.message);
                        
                        // å°‡ç´¢å¼•æŒ‡å‘ä¸‹ä¸€å€‹ keyï¼Œæº–å‚™ä¸‹ä¸€æ¬¡è¿´åœˆçš„å˜—è©¦
                        // (currentKeyIndex + 1) % API_KEYS.length ç¢ºä¿ç´¢å¼•åˆ°åº•å¾Œæœƒç¹å› 0
                        currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length;
                    }
                }
                
                // å¦‚æœ for è¿´åœˆè·‘å®Œäº†ï¼Œä½†å‡½å¼é‚„æ²’è¿”å›ï¼Œ
                // é€™å°±æ„å‘³è‘—æ‰€æœ‰çš„ Key éƒ½å˜—è©¦å¤±æ•—äº†ã€‚
                // æ­¤æ™‚ï¼Œæˆ‘å€‘æ‹‹å‡ºä¸€å€‹æœ€çµ‚çš„éŒ¯èª¤ã€‚
                throw new Error("æ‰€æœ‰å‚™ç”¨çš„ API Key å‡å˜—è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Key æˆ–ç¶²è·¯é€£ç·šã€‚");
            }


           generateBtn.addEventListener('click', async () => {
                const topic = topicInput.value.trim();
                const userGuidelines = guidelinesInput.value.trim();
                const hiddenInstruction = "å¼•ç”¨å¤ä»Šä¸­å¤–è«–æ“šï¼Œå¶ç„¶è¦ç”¨æ¯”å–»ä½œè«–è­‰ï¼Œä¸è¦æŠ„è¥²ã€Šè«–å¾—å¤±ã€‹çš„è«–æ“šã€‚æ­¤å¤–ï¼Œè¦æ ¹æ“šé¡Œç›®éˆæ´»åˆ†æ®µï¼Œä¸è¦æŠ„è¥²ã€Šè«–å¾—å¤±ã€‹çš„çš„åˆ†æ®µï¼Œåªè¦è¶…éä¸€åƒå­—ï¼Œä¾¿å¿…é ˆåˆ†ç‚º6æ®µæˆ–ä»¥ä¸Šã€‚";

                const finalGuidelines = userGuidelines 
                    ? `${userGuidelines}\n${hiddenInstruction}` 
                    : hiddenInstruction;
                
                // é€™è£¡æœƒè®€å–ä½ åœ¨ç¬¬ä¸€æ­¥ä¿®æ”¹çš„ value (deepseek æˆ– gemini)
                const selectedModel = document.querySelector('input[name="model"]:checked').value;
                
                if (!topic) {
                    alert('è«‹è¼¸å…¥æ–‡ç« é¡Œç›®ã€‚');
                    return;
                }

                generateBtn.disabled = true;
                generateBtn.textContent = 'ç”Ÿæˆä¸­...';
                loader.style.display = 'block';
                essayPlaceholder.style.display = 'none';
                generatedEssay.style.display = 'none';
                outputToolbar.style.display = 'none';
                
                try {
                    let systemPrompt = document.getElementById('argumentative-prompt').textContent;
                    systemPrompt = systemPrompt.replace(/\[è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨å¸Œæœ›æ¢è¨çš„è­°è«–æ–‡ä¸»é¡Œï¼Œä¾‹å¦‚.+\]/, `ä¸»é¡Œï¼š ${topic}`);
                    systemPrompt = systemPrompt.replace(/ç´„1300å€‹ä¸­æ–‡å­—ç¬¦/g, `ç´„${wordCount}å€‹ä¸­æ–‡å­—ç¬¦`);
                    systemPrompt = systemPrompt.replace(/å­—æ•¸å¿…é ˆå¼·åˆ¶æ§åˆ¶åœ¨1200è‡³1300å­—å…§/g, `å­—æ•¸è«‹ç›¡é‡è²¼è¿‘ç”¨å®¶è¨­å®šçš„ ${wordCount} å­—`);

                    if (finalGuidelines) {
                        systemPrompt += `\n\n[é¡å¤–å‰µä½œæŒ‡å¼•]\n${finalGuidelines}`;
                    }

                    // --- 2. ç™¼é€è«‹æ±‚è‡³ GAS å¾Œç«¯ (ä¿®æ”¹éƒ¨åˆ†) ---
                    // æ³¨æ„ï¼šé€™è£¡ç§»é™¤äº† headers ä¸­çš„ Authorizationï¼Œå› ç‚º Token Injector æœƒè‡ªå‹•è™•ç†
                    // ä¹Ÿä¸å†ä½¿ç”¨ generateWithRetryï¼Œç›´æ¥ fetch
                    const response = await fetch(CLOUDFLARE_WORKER_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            model: selectedModel, // å‚³é€ "deepseek" æˆ– "gemini"
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: `è«‹æ ¹æ“šä»¥ä¸Šæ‰€æœ‰æŒ‡ç¤ºï¼Œç‚ºé¡Œç›®ã€Š${topic}ã€‹ç”Ÿæˆä¸€ç¯‡è­°è«–æ–‡ã€‚` }
                            ],
                            stream: false
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${response.status}`);
                    }

                    const data = await response.json();

                    // === [Log Provider Info] é¡¯ç¤ºå¾Œç«¯èª¿åº¦è³‡è¨Š (å«é¡è‰²) ===
                    if (data._provider_log) {
                        console.log(
                            `%c[Backend] Provider: ${data._provider_log}`, 
                            'background: #2b2d42; color: #8d99ae; padding: 4px 8px; border-radius: 4px; font-weight: bold; border: 1px solid #edf2f4;'
                        );
                    }
                    
                    // æª¢æŸ¥å¾Œç«¯éŒ¯èª¤
                    if (data.error) {
                        throw new Error(`Backend Error: ${data.error}`);
                    }

                    const resultText = data.choices[0].message.content;

                    generatedEssay.textContent = resultText;
                    outputWordCount.textContent = `å­—æ•¸ï¼š${resultText.length}`;
                    generatedEssay.style.display = 'block';
                    outputToolbar.style.display = 'flex';

                } catch (error) {
                    console.error('ç”Ÿæˆå¤±æ•—:', error);
                    essayPlaceholder.textContent = 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                    essayPlaceholder.style.display = 'flex';
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'ç”Ÿæˆæ–‡ç« ';
                    loader.style.display = 'none';
                }
            });

            updateWordCountDisplay();
        });
    </script>


<!-- === 1. Firebase SDK å¼•å…¥ === -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<!-- === 2. Firebase åˆå§‹åŒ–ã€æŒä¹…åŒ–èˆ‡ Token æ³¨å…¥å™¨ === -->
<script>
    // 1. å®šç¾© Firebase è¨­å®š
    const firebaseConfig = {
        apiKey: "AIzaSyBgwrgn2m343mRJb0WjzUhteiospegXhvI",
        authDomain: "sansidata.firebaseapp.com",
        projectId: "sansidata",
        storageBucket: "sansidata.firebasestorage.app",
        messagingSenderId: "580288358575",
        appId: "1:580288358575:web:35dcf4e79bcef530de4c5a",
        databaseURL: "https://sansidata-default-rtdb.firebaseio.com"
    };

    // 2. åˆå§‹åŒ– Firebase
    if (typeof firebase !== 'undefined' && !firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    
    var database = firebase.database();
    var auth = firebase.auth();

    // 3. å•Ÿå‹•ç›£è½èˆ‡åŒæ­¥é‚è¼¯ (æŒä¹…åŒ–)
    document.addEventListener('DOMContentLoaded', function() {
        if (auth) {
            auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(() => {
                auth.onAuthStateChanged(async (user) => {
                    const s = JSON.parse(localStorage.getItem('studentProfile'));

                    if (user) {
                        console.log("[ZiZhen] ğŸŸ¢ åµæ¸¬åˆ°æœ‰æ•ˆç™»å…¥:", user.email);
                        if (!s) {
                            console.log("[ZiZhen] æ­£åœ¨åŒæ­¥é›²ç«¯èº«ä»½...");
                            try {
                                const emailKey = btoa(user.email);
                                const snapshot = await database.ref('email_mapping/' + emailKey).once('value');
                                const profile = snapshot.val();
                                if (profile) {
                                    localStorage.setItem('studentProfile', JSON.stringify(profile));
                                    // window.location.reload(); // å¯é¸ï¼šåˆ·æ–°ä»¥æ›´æ–° UI
                                }
                            } catch (e) { console.error("åŒæ­¥å¤±æ•—:", e); }
                        }
                    } else {
                        console.log("[ZiZhen] âšª æœªåµæ¸¬åˆ°ç™»å…¥");
                        if (s) {
                            console.warn("[ZiZhen] âš ï¸ ç™¼ç¾å¤±æ•ˆçš„èº«ä»½è³‡æ–™ï¼ŒåŸ·è¡Œå®‰å…¨æ¸…é™¤...");
                            localStorage.removeItem('studentProfile');
                        }
                    }
                });
            })
            .catch((error) => console.error("[ZiZhen] æŒä¹…åŒ–è¨­å®šå¤±æ•—:", error));
        }
    });

    // 4. [æ ¸å¿ƒ] å…¨åŸŸè«‹æ±‚æ””æˆªå™¨ (Auto Token Injector)
    (function() {
        // é˜²æ­¢èˆ‡åš´æ ¼é–è¡çªï¼Œé€™è£¡é‡å°å¾Œç«¯ API é€²è¡ŒäºŒæ¬¡æ””æˆª
        const originalFetch = window.fetch; 
        const TARGET_URL_PART = "script.google.com"; // æ””æˆªç™¼å¾€ GAS çš„è«‹æ±‚

        window.fetch = async function(url, options) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºç™¼å¾€å¾Œç«¯çš„ POST è«‹æ±‚
            if (typeof url === 'string' && url.includes(TARGET_URL_PART) && options && options.method === 'POST') {
                
                console.log("[TokenInjector] åµæ¸¬åˆ°å¾Œç«¯è«‹æ±‚ï¼Œæº–å‚™æ³¨å…¥ Token...");

                const user = await new Promise((resolve) => {
                    if (firebase.auth().currentUser) {
                        resolve(firebase.auth().currentUser);
                    } else {
                        const unsubscribe = firebase.auth().onAuthStateChanged(u => {
                            unsubscribe();
                            resolve(u);
                        });
                        setTimeout(() => resolve(null), 2000);
                    }
                });

                if (user) {
                    try {
                        const token = await user.getIdToken(true);
                        // GAS æ¥æ”¶çš„ body å¿…é ˆæ˜¯ JSON æ ¼å¼
                        let bodyData = {};
                        try {
                             bodyData = JSON.parse(options.body);
                        } catch(e) {
                            console.warn("[TokenInjector] Body é JSONï¼Œå˜—è©¦å¼·åˆ¶å°è£");
                            bodyData = { originalBody: options.body };
                        }
                        
                        bodyData.token = token; // â˜… å¼·åˆ¶æ³¨å…¥ Token
                        options.body = JSON.stringify(bodyData);
                        console.log("[TokenInjector] Token æ³¨å…¥æˆåŠŸï¼");
                    } catch (e) {
                        console.error("[TokenInjector] Token ç²å–å¤±æ•—:", e);
                    }
                } else {
                    console.warn("[TokenInjector] ç”¨æˆ¶æœªç™»å…¥ï¼Œç„¡æ³•æ³¨å…¥ Token");
                    // é€™è£¡ä¸éœ€é˜»æ“‹ï¼Œå› ç‚ºã€Œåš´æ ¼æ¬Šé™é–ã€å·²ç¶“åœ¨å‰é¢æ“‹éäº†
                }
            }
            return originalFetch(url, options);
        };
    })();
</script>


<!-- === [é‚„åŸç‰ˆ] ç¥æ€å¤§æ•¸æ“šæ”¶é›†æ¨¡çµ„ (30ç§’=1åˆ†é˜é‚è¼¯) === -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    let totalSeconds = 0;
    let timerInterval = null;

    // 1. ç²å–æ—¥æœŸè·¯å¾‘
    function getDateParts() {
        const now = new Date();
        const y = String(now.getFullYear());
        const m = String(now.getMonth() + 1).padStart(2, '0');
        const d = String(now.getDate()).padStart(2, '0');
        return { y, m, d };
    }

    // 2. ç²å–èº«ä»½
    function getIdentity() {
        const rawProfile = localStorage.getItem('studentProfile');
        let s = null;
        try { if(rawProfile) s = JSON.parse(rawProfile); } catch (e) {}

        if (s && s.grade && s.class) {
            const safeName = s.name.replace(/[.#$/[\]]/g, '_'); 
            return { type: 'student', id: s.uid || `stu_${s.grade}${s.class}_${safeName}`, grade: s.grade, class: s.class };
        } else {
            let guestID = localStorage.getItem('sansi_guest_uuid');
            if (!guestID) {
                guestID = 'guest_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('sansi_guest_uuid', guestID);
            }
            return { type: 'guest', id: guestID, grade: 'Guest', class: 'Visitor' };
        }
    }

// === 3. è¨˜éŒ„è¨ªå• (Log Visit) - é«˜æ•ˆåˆ†æµç‰ˆ ===
// === 3. è¨˜éŒ„è¨ªå• (Log Visit) - é«˜æ•ˆåˆ†æµç‰ˆ (å« stats_school é‚è¼¯) ===
async function logVisitOnce() {
    if (typeof firebase === 'undefined' || !database) return;
    
    const { y, m, d } = getDateParts();
    const identity = getIdentity();
    const uid = identity.id;

    // Session é–
    const sessionKey = `sansi_visit_logged_${y}${m}${d}_${uid}`;
    if (sessionStorage.getItem(sessionKey)) return; 

    // æª¢æŸ¥ Tracking (åˆ¤æ–·æ˜¯å¦ç‚ºä»Šæ—¥é¦–æ¬¡)
    const trackingRef = database.ref(`stats_tracking/${y}/${m}/${d}/unique_users/${uid}`);
    
    try {
        const snap = await trackingRef.once('value');
        const isFirstTimeToday = !snap.exists();

        const updates = {};
        const increment1 = firebase.database.ServerValue.increment(1);
        
        // 1. å…¨æ ¡ç¸½è¦½è·¯å¾‘ (å«è¨ªå®¢) - stats_global
        const globalPath = `stats_global/${y}/${m}/${d}`;
        updates[`${globalPath}/visits`] = increment1;

        // â˜…â˜…â˜… æ–°å¢ï¼šç´”å­¸æ ¡è·¯å¾‘ (åƒ…å­¸ç”Ÿ) - stats_school â˜…â˜…â˜…
        const schoolPath = `stats_school/${y}/${m}/${d}`;

        if (identity.type === 'student') {
            const classKey = `${identity.grade}${identity.class}`;
            const studentKey = identity.id.split('_').pop(); // åå­—

            // å­¸ç”ŸåŒæ™‚å¯«å…¥ stats_school
            updates[`${schoolPath}/visits`] = increment1;

            // 2. ç­ç´šè·¯å¾‘ (stats_classes/6A/YYYY/MM/DD)
            const classPath = `stats_classes/${classKey}/${y}/${m}/${d}`;
            updates[`${classPath}/visits`] = increment1;

            // 3. å­¸ç”Ÿè·¯å¾‘ (stats_students/6A/é™³å¤§æ–‡/YYYY/MM/DD)
            const studentPath = `stats_students/${classKey}/${studentKey}/${y}/${m}/${d}`;
            updates[`${studentPath}/visits`] = increment1;

            if (isFirstTimeToday) {
                updates[`stats_tracking/${y}/${m}/${d}/unique_users/${uid}`] = true;
                
                // æ›´æ–° global unique
                updates[`${globalPath}/unique`] = increment1;
                
                // â˜… æ›´æ–° school unique (åƒ…å­¸ç”Ÿ)
                updates[`${schoolPath}/unique`] = increment1;
                
                // æ›´æ–° class unique
                updates[`${classPath}/unique`] = increment1;
            }
        } else {
            // è¨ªå®¢ (åªå¯«å…¥ globalï¼Œä¸å¯«å…¥ school)
            if (isFirstTimeToday) {
                updates[`stats_tracking/${y}/${m}/${d}/unique_users/${uid}`] = true;
                updates[`${globalPath}/unique`] = increment1;
            }
        }

        await database.ref().update(updates);
        sessionStorage.setItem(sessionKey, 'true');
        console.log("ğŸ“ [Stats] è¨ªå•è¨ˆæ•¸å·²åˆ†æµä¸Šå‚³ (å« stats_school)");

    } catch (e) {
        console.error("Stats Error:", e);
    }
}

// 4. ä¸Šå‚³ 1 åˆ†é˜ (åˆ†æµç‰ˆ - é™¤éŒ¯æ¨¡å¼)
function uploadOneMinute() {
    if (typeof firebase === 'undefined' || !database) return;
    
    logVisitOnce(); 

    const { y, m, d } = getDateParts();
    const identity = getIdentity();
    
    // ç²å–å­¸ç”Ÿåç¨± Key (é˜²å‘†)
    const studentKey = identity.id.includes('_') ? identity.id.split('_').pop() : identity.name; 
    
    const updates = {};
    const increment60 = firebase.database.ServerValue.increment(60);

    // 1. å…¨åŸŸ (Global)
    updates[`stats_global/${y}/${m}/${d}/duration`] = increment60;

    // â˜…â˜…â˜… 2. å­¸ç”Ÿèº«ä»½åˆ¤æ–· â˜…â˜…â˜…
    if (identity.type === 'student') {
        const classKey = `${identity.grade}${identity.class}`;

        // Path A: å…¨æ ¡ (é€™æ˜¯æ‚¨ç¼ºå°‘çš„)
        const pathSchool = `stats_school/${y}/${m}/${d}/duration`;
        updates[pathSchool] = increment60;

        // Path B: ç­ç´š
        const pathClass = `stats_classes/${classKey}/${y}/${m}/${d}/duration`;
        updates[pathClass] = increment60;
        
        // Path C: å€‹äºº
        const pathStudent = `stats_students/${classKey}/${studentKey}/${y}/${m}/${d}/duration`;
        updates[pathStudent] = increment60;

        // â˜… é™¤éŒ¯è¨Šæ¯ï¼šè«‹åœ¨ F12 Console æŸ¥çœ‹æ˜¯å¦å‡ºç¾æ­¤è¡Œ â˜…
        console.log(`[Stats] æ­£åœ¨ä¸Šå‚³æ™‚é•·... ç›®æ¨™åŒ…å«: ${pathSchool}`);
    } else {
        console.log("[Stats] ç•¶å‰ç‚ºè¨ªå®¢èº«ä»½ï¼Œä¸å¯«å…¥ stats_school");
    }

    database.ref().update(updates)
        .then(() => console.log("âœ… [Stats] æ™‚é•·ä¸Šå‚³æˆåŠŸ"))
        .catch(e => console.error("âŒ [Stats] ä¸Šå‚³å¤±æ•— (è«‹æª¢æŸ¥ Rules):", e));
}

    // 5. è¨ˆæ™‚å™¨å•Ÿå‹• (é‚„åŸä½ çš„é‚è¼¯)
    function startTimer() {
        if (timerInterval) return;
        console.log("â–¶ï¸ [Stats] è¨ˆæ™‚å™¨å•Ÿå‹•");
        
        timerInterval = setInterval(() => {
            totalSeconds++;
            
            // â˜…â˜…â˜… ä½ çš„åŸå§‹é‚è¼¯ â˜…â˜…â˜…
            // 30ç§’ -> å‚³é€ (ç®—1åˆ†é˜)
            // 90ç§’ (1åˆ†30ç§’) -> å‚³é€ (ç®—2åˆ†é˜)
            // 150ç§’ (2åˆ†30ç§’) -> å‚³é€ (ç®—3åˆ†é˜)
            if (totalSeconds === 30 || (totalSeconds > 30 && (totalSeconds - 30) % 60 === 0)) {
                uploadOneMinute();
            }
        }, 1000);
    }

    function pauseTimer() {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
            console.log("â¸ï¸ [Stats] æš«åœè¨ˆæ™‚ (ç•¶å‰ç´¯è¨ˆ: " + totalSeconds + "s)");
            // æ³¨æ„ï¼šé€™è£¡ä¸å†æœ‰ uploadDuration(unsaved)ï¼Œæœªæ»¿çš„éƒ¨åˆ†ç›´æ¥æ¨æ£„
        }
    }

    // å»¶é²å•Ÿå‹•
    setTimeout(() => {
        logVisitOnce();
        startTimer();
    }, 3000);

    // åµæ¸¬é é¢ç‹€æ…‹
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'hidden') pauseTimer();
        else startTimer();
    });
    
    window.forceLogVisit = logVisitOnce;
});
</script>


    <script>



// â˜…â˜…â˜…â˜…â˜… è«‹å°‡ä»£ç¢¼è²¼åœ¨é€™è£¡ (åŸæœ¬çš„å…§å®¹ä¹‹ä¸‹ï¼Œscript çµæŸæ¨™ç±¤ä¹‹ä¸Š) â˜…â˜…â˜…â˜…â˜…

    // =======================================================
    // === [æ–°å¢] åœ¨ç·šç‹€æ…‹è‡ªå‹•å ±åˆ°ç³»çµ± (Presence System) ===
    // =======================================================
    function initPresenceSystem() {
        // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿ Firebase å·²åˆå§‹åŒ–ä¸”æœ¬åœ°å­˜å„²å·²è®€å–
        setTimeout(() => {
            if (typeof database === 'undefined') return;

            // 1. ç›£è½é€£ç·šç‹€æ…‹
            const connectedRef = database.ref('.info/connected');

            connectedRef.on('value', (snap) => {
                if (snap.val() === true) {
                    // === é€£ç·šæˆåŠŸï¼Œæº–å‚™è³‡æ–™ ===
                    
                    // ç²å–ç”¨æˆ¶è³‡æ–™
                    const s = JSON.parse(localStorage.getItem('studentProfile'));
                    let myUid = "";
                    let userData = {};

                    // A. åˆ¤æ–·èº«åˆ†
                    if (s && s.name) {
                        // --- å·²ç™»å…¥ç”¨æˆ¶ (å­¸ç”Ÿ/è€å¸«/ç‰¹è¨±) ---
                        const user = firebase.auth().currentUser;
                        myUid = user ? user.uid : `stu_${s.grade}${s.class}_${s.name}`;
                        
                        // æº–å‚™å¯«å…¥çš„è³‡æ–™
                        userData = {
                            name: s.name,
                            grade: s.grade,
                            class: s.class,
                            timestamp: firebase.database.ServerValue.TIMESTAMP,
                            device: /Mobile|Android/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop'
                        };
                    } else {
                        // --- è¨ªå®¢ ---
                        let guestId = localStorage.getItem('sansi_guest_uuid');
                        if (!guestId) {
                            guestId = 'guest_' + Math.random().toString(36).substr(2, 9);
                            localStorage.setItem('sansi_guest_uuid', guestId);
                        }
                        myUid = guestId;

                        userData = {
                            name: "è¨ªå®¢",
                            grade: "Guest",
                            class: "Visitor",
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        };
                    }

                    // B. åŸ·è¡Œ Firebase å‹•ä½œ
                    const myPresenceRef = database.ref(`online_users/${myUid}`);

                    // é—œéµæŒ‡ä»¤ï¼šç•¶å®¢æˆ¶ç«¯æ–·ç·šæ™‚ï¼Œè‡ªå‹•åˆªé™¤é€™ç­†è³‡æ–™
                    myPresenceRef.onDisconnect().remove().then(() => {
                        // æ–·ç·šæŒ‡ä»¤è¨­å®šæˆåŠŸå¾Œï¼Œå¯«å…¥ç•¶å‰ç‹€æ…‹
                        myPresenceRef.set(userData);
                    });
                }
            });
        }, 2000); // å»¶é² 2 ç§’å•Ÿå‹•
    }

    // å•Ÿå‹•å ±åˆ°ç³»çµ±
    document.addEventListener('DOMContentLoaded', initPresenceSystem);



	
</script>
    

</body>
</html>
