<!DOCTYPE html>
<html lang="zh">
<head>

<meta http-equiv="Content-Security-Policy" content="
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cubism.live2d.com https://*.streamable.com https://cdn.heapanalytics.com https://www.gstatic.com https://apis.google.com https://cdn.onesignal.com https://onesignal.com https://api.onesignal.com https://*.firebaseio.com;
style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://onesignal.com;
font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com;
img-src 'self' https: data: blob: https://*.streamable.com https://heapanalytics.com https://*.googleusercontent.com;
media-src 'self' https://youfulca.com https://*.streamable.com https://assets.mixkit.co https://taira-komori.net;
connect-src 'self' https://script.google.com https://script.googleusercontent.com https://sansi.vercel.app https://sansi.kenchan20151.workers.dev https://corsproxy.io https://docs.google.com https://*.googleusercontent.com https://v1.hitokoto.cn https://chatapi.akash.network https://text.pollinations.ai https://gen.pollinations.ai https://router.huggingface.co https://api.llm7.io https://*.streamable.com https://cdn.jsdelivr.net https://api-fawn-chi.vercel.app https://heapanalytics.com https://*.firebaseio.com wss://*.firebaseio.com https://www.gstatic.com https://www.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://cdn.onesignal.com https://onesignal.com https://api.onesignal.com https://cdnjs.cloudflare.com data: blob: https://huggingface.co https://*.huggingface.co https://*.supabase.co https://cdn-lfs.huggingface.co https://*.hf.co;
worker-src 'self' blob:;
frame-src 'self' https://streamable.com https://kenchan20141.pyscriptapps.com https://kenchan20141.github.io https://sansi.vercel.app https://lyricschi.vercel.app https://penpalchi.vercel.app https://litstudy.vercel.app https://621d05f47d591.site123.me https://script.google.com https://www.i2ocr.com https://*.firebaseapp.com https://onesignal.com;
object-src 'none'; base-uri 'self'; form-action 'self';">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>神思</title>

<meta name="application-name" content="神思">
<meta name="apple-mobile-web-app-title" content="神思">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.json">

<link rel="apple-touch-icon" href="神思圖標.png">
<link rel="apple-touch-icon" sizes="180x180" href="神思圖標.png">
<link rel="apple-touch-icon" sizes="152x152" href="神思圖標.png">
<link rel="apple-touch-icon" sizes="120x120" href="神思圖標.png">
<link rel="icon" sizes="192x192" href="神思圖標.png">
<link rel="icon" sizes="144x144" href="神思圖標.png">
<link rel="icon" sizes="96x96" href="神思圖標.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

<!-- Modularized CSS Files -->
<link rel="stylesheet" href="platform/css/main.css">
<link rel="stylesheet" href="platform/css/components.css">
<link rel="stylesheet" href="platform/css/animations.css">
<link rel="stylesheet" href="platform/css/embedded-main.css">
<link rel="stylesheet" href="platform/css/embedded-secondary.css">
<link rel="stylesheet" href="platform/css/embedded-tertiary.css">

<!-- External CDN Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/6.5.8/browser/pixi.min.js"></script>
<script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script type="module">
    import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0";
    window.pipeline = pipeline;
</script>

<!-- Core JavaScript Modules -->
<script src="platform/js/error-handler.js"></script>
<script src="platform/js/firebase-config.js"></script>
<script src="platform/js/rag-service.js"></script>

</head>
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  window.addEventListener("load", async function() {
    OneSignalDeferred.push(async function(OneSignal) {
      try {
        await OneSignal.init({
          appId: "f85da4b8-abae-4c5e-8db9-c9f463fc9815",
          serviceWorkerPath: "OneSignalSDKWorker.js",
          serviceWorkerParam: { scope: "/AIChinese/" },
          allowLocalhostAsSecureOrigin: true,
          notifyButton: { enable: false }
        });
        console.log("OneSignal initialized");
        const s = JSON.parse(localStorage.getItem("studentProfile"));
        if (s) {
          setTimeout(() => {
            OneSignal.User.addTags({ grade: String(s.grade), class: String(s.class), userType: "student" });
            console.log("Tags updated");
          }, 1000);
        }
      } catch (err) {
        console.error("OneSignal init error:", err);
      }
    });
  });
</script>

<body>

<!-- === 新增：頁面右緣卡扣按鈕 === -->
<button id="sideMenuToggle" title="展開選單">
    <i class="fas fa-bars"></i>
</button>

<div id="sideMenu" class="side-menu-overlay">
    <div class="side-menu-content">
        <button class="side-menu-close" id="sideMenuClose">&times;</button>
        
      <div class="side-menu-items">
    <!-- 1. 雲端同步 -->
    <button class="side-menu-item" id="sideMenuCloudBtn" onclick="openStudentLoginModal()">
        <i class="fas fa-cloud-upload-alt"></i>
        <span>雲端同步</span>
        <div id="notifBadge" class="notification-badge"></div>
    </button>
		   
    <!-- 2. 歷史紀錄 -->
    <button class="side-menu-item" onclick="openHistoryContainer()">
        <i class="fas fa-history"></i>
        <span>歷史紀錄</span>
    </button>

    <!-- 3. 工具一覽 (已移至歷史紀錄下方) -->
    <button class="side-menu-item" id="sideMenuToolsBtn" onclick="openToolsFromSideMenu()">
        <i class="fas fa-toolbox"></i>
        <span>工具一覽</span>
    </button>

    <!-- 4. 返回主頁 -->
    <button class="side-menu-item" id="sideMenuHomeBtn" onclick="returnToHome()" style="display: none;">
        <i class="fas fa-home"></i>
        <span>返回主頁</span>
    </button>

<!-- 精選文章按鈕 -->
<!-- 修改原本的文萃按鈕 -->
<button class="side-menu-item" onclick="openBookResourceMenu()">
    <i class="fas fa-book"></i> <!-- 圖示改為通用書籍 -->
    <span>閱讀資源</span>      <!-- 文字改為統稱 -->
</button>

		  
    <!-- 5. 音樂播放器 -->
    <button class="side-menu-item" onclick="toggleMusicPlayer()">
        <i class="fas fa-music"></i>
        <span>音樂播放器</span>
    </button>


<!-- 側邊選單底部：貓咪按鈕 -->
<div style="height: 1px; background: rgba(255,255,255,0.1); margin: 5px 10px;"></div>
<button class="side-menu-item" onclick="openCatMenu()" title="呼喚貓咪">
    <i class="fas fa-cat" style="font-size: 24px;"></i>
    <span>Live2D</span>
</button>


		  
</div>
    </div>
</div>



<!-- === 新增：返回主頁按鈕 === -->
<button id="homeBtn" onclick="returnToHome()" title="返回主頁">
    <i class="fas fa-home"></i>
</button>

<body>


<div class="title-container">
<h1>
<span class="title-text">神思</span>
</h1>
</div>



<!-- 文萃容器 (原：精選文章容器) -->
<div id="featuredContainer" class="box" style="display: none;">
    
    
    <!-- 列表視圖 -->
    <div id="featuredListView">
        <!-- 搜尋列 -->
<div class="search-bar-wrapper" style="display: flex; align-items: center; gap: 12px; max-width: 450px;">
    <!-- 搜尋框 -->
    <input type="text" id="articleSearchInput" class="no-modal-editor" placeholder="搜尋標題或作者..." oninput="searchArticles()" style="flex-grow: 1; border-radius: 50px; padding-left: 20px;">
    
    <!-- 書籤過濾按鈕 -->
    <button id="bookmarkFilterBtn" class="bookmark-list-btn" onclick="toggleBookmarkMode()" title="只顯示我的書籤">
        <i class="fas fa-bookmark"></i>
    </button>
</div>
        <!-- 文章列表 -->
        <div id="articleListContainer" class="article-list">
            <!-- JS 將自動生成列表 -->
            <div style="text-align:center; color:#999; padding:20px;">載入中...</div>
        </div>

       <!-- 分頁控制 (修訂版) -->
<div class="pagination-controls" style="gap: 15px;"> <!-- 稍微縮小間距 -->
    <!-- [新增] 一鍵回首頁按鈕 (雙箭頭圖示) -->
    <button id="firstPageBtn" onclick="goToFirstPage()" title="回到第 1 頁" style="display: none; margin-right: -10px;">
        <i class="fas fa-angle-double-left"></i>
    </button>

    <button id="prevPageBtn" onclick="changeArticlePage(-1)" disabled>
        <i class="fas fa-chevron-left"></i>
    </button>
    
    <!-- [修改] 頁碼指示器：加入 onclick 事件與 title 提示 -->
    <!-- 樣式設定 cursor: pointer 提示可點擊 -->
    <span id="pageIndicator" onclick="triggerPageJump()" title="點擊輸入頁碼" 
          style="cursor: pointer; user-select: none; transition: opacity 0.2s;">
        1 / 1
    </span>
    
    <button id="nextPageBtn" onclick="changeArticlePage(1)" disabled>
        <i class="fas fa-chevron-right"></i>
    </button>
</div>
    </div>

    <!-- 詳情視圖 (預設隱藏) -->
    <div id="featuredDetailView" style="display: none;">
        <div class="article-actions">
            <button class="back-icon-btn" onclick="backToArticleList()" title="返回列表">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="article-content-paper">
            <h3 id="detailTitle" class="article-title"></h3>
            <div id="detailDate" class="article-date"></div>
            <div class="article-separator"></div>
            <div id="detailBody" class="article-body"></div>
        </div>
    </div>
</div>




	
<div id="hitokoto-container" class="box">
<div id="hitokoto"></div>
<div id="hitokoto-footer">
<span id="hitokoto-from"></span>
<button id="refresh-btn"><i class="fas fa-sync-alt"></i></button>
</div>
</div>

	<!-- DSE 倒數日曆容器 -->
<div class="box" id="dse-countdown-box">
    <!-- 標題部分 (移除下拉選單，回歸純文字) -->
    <div class="dse-header">距離與DSE中文科分手尚餘</div>

    <!-- 主要顯示區域：左邊選單 + 右邊倒數 -->
    <div class="dse-main-wrapper">
        
        <!-- 左側：年級選擇器 (直排) -->
        <div class="grade-sidebar">
            <div class="grade-label">年級</div>
            <button class="grade-btn" data-val="s6">6</button>
            <button class="grade-btn" data-val="s5">5</button>
            <button class="grade-btn" data-val="s4">4</button>
            <button class="grade-btn" data-val="s3">3</button>
            <button class="grade-btn" data-val="s2">2</button>
            <button class="grade-btn" data-val="s1">1</button>
        </div>

        <!-- 右側：倒數卡片區 -->
        <div class="countdown-section">
            <div class="countdown-container">
                <!-- 「約」字標籤 -->
                <div id="approx-label" class="approx-label hidden">約</div>

                <!-- 千位 -->
                <div class="flip-unit hidden" id="unit-0">
                    <div class="card-part top" id="t0-next">0</div>
                    <div class="card-part bottom" id="b0-old">0</div>
                    <div class="flap" id="f0" data-old="0" data-new="0"></div>
                </div>
                
                <!-- 百位 -->
                <div class="flip-unit" id="unit-1">
                    <div class="card-part top" id="t1-next">0</div>
                    <div class="card-part bottom" id="b1-old">0</div>
                    <div class="flap" id="f1" data-old="0" data-new="0"></div>
                </div>
                <!-- 十位 -->
                <div class="flip-unit" id="unit-2">
                    <div class="card-part top" id="t2-next">0</div>
                    <div class="card-part bottom" id="b2-old">0</div>
                    <div class="flap" id="f2" data-old="0" data-new="0"></div>
                </div>
                <!-- 個位 -->
                <div class="flip-unit" id="unit-3">
                    <div class="card-part top" id="t3-next">0</div>
                    <div class="card-part bottom" id="b3-old">0</div>
                    <div class="flap" id="f3" data-old="0" data-new="0"></div>
                </div>

 <!-- ★★★ 新增這行：日字標籤 ★★★ -->
    <div class="days-label">日</div>
				
            </div>
            
            <div class="dse-footer">DAYS TO BREAKUP</div>
        </div>
    </div>
    
    <audio id="flip-sound" src="切換年級.mp3" preload="auto"></audio>
</div>




<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>











<!-- 內置的 DSE 評分原則 (隱藏) -->
<div id="dse-grading-principles" style="display: none;">
<h3>【擬卷理念】</h3>
<p>1. 考核能力：考核考生構思、表達、創作等能力。</p>
<p>2. 設題方式：或命題，或指定情境，並提供選擇。</p>
<p>3. 設題方向：主要環繞考生生活經驗及日常思考、關注的情或事；並盡量給予寫作空間，讓考生發揮創意。</p>
<p>4. 寫作要求：考生宜透過審題，思考寫作立意，選取材料，書寫文章。</p>
<p>5. 文體要求：以某類文體為主，或文體不限。</p>

<h3>【一般評分原則：審題、入品】</h3>
<p>1. 準確理解關鍵概念。</p>
<p>2. 明白寫作要求。</p>
<p>3. 把握不同品位的入品要求。</p>

<h3>【評分項目詳解】</h3>
<p><strong>內容 (40分):</strong></p>
<ul>
<li>立意、內容是否合乎寫作要求；是否豐富、深刻。</li>
<li>取材是否恰當；能否彰顯立意。</li>
<li>闡述是否合理、飽滿。</li>
</ul>
<p><strong>表達 (30分):</strong></p>
<ul>
<li>用詞是否精確、豐富。(主)</li>
<li>文句是否流暢、通順。(主)</li>
<li>表達手法是否純熟靈活。(輔)</li>
</ul>
<p><strong>結構 (20分):</strong></p>
<ul>
<li>段落區分是否明晰。</li>
<li>起承轉合是否自然。</li>
<li>輕重詳略是否恰當。</li>
</ul>
<p><strong>標點字體 (10分):</strong></p>
<ul>
<li>字體為主，標點為輔。</li>
<li>標點使用在於準確和靈活，不在於數量多少。</li>
</ul>
<p><strong>錯別字 (3分):</strong></p>
<ul>
<li>0-1個給3分；2-4個給2分；5-7個給1分；8個或以上不給分。</li>
<li>重錯不計。</li>
</ul>

<h3>【離題卷評分】</h3>
<p>「內容」最高給「下上」；「表達」及「結構」最高給「中上」；「標點字體」最高仍可給「上上」。</p>

<h3>【字數不足650字】</h3>
<p>「內容」最高給分：550-649字：「上上」；450-549字：「中上」；300-449字：「中中(下)」；300字以下：「下上」。</p>

<h3>【一般評論摘要】</h3>
<p><strong>優勝之處:</strong></p>
<ul>
<li><strong>審題:</strong> 能正確理解題目。</li>
<li><strong>立意:</strong> 偶有佳作，能由日常生活引申至人生意義、生活哲理，呈現對生活有敏銳的觀察和思考。</li>
<li><strong>取材:</strong> 圍繞日常生活經歷或見聞取材。</li>
<li><strong>表達:</strong> 用詞大致恰當，文句大致通順；能恰當地敘事抒情、描繪人物或闡述看法；嘗試運用不同寫作手法。</li>
<li><strong>結構:</strong> 分段大致清晰，尚見脈絡；過渡合理，結構完整。</li>
</ul>
<p><strong>不足之處:</strong></p>
<ul>
<li><strong>審題:</strong> 流於表面，未抓緊題眼發揮。</li>
<li><strong>立意:</strong> 立意平常，層次不高。</li>
<li><strong>取材:</strong> 敘事忽略細節，描寫流於表面，論述粗疏簡略；未能翻出新意，提出精闢見解。</li>
<li><strong>表達:</strong> 文句不通，詞不達意。</li>
<li><strong>結構:</strong> 鮮能做到層層深化，前後呼應者；少數文章篇幅較長，惜時間所限，結果虎頭蛇尾；有詳略稍有失衡的情況。</li>
</ul>
</div>


<!-- 工具選擇 -->
<div class="box" id="toolsBox" style="display: none;">
    <h2>工具一覽：</h2>
    <button id="expandToolsBtn2">點擊展開</button>
<div id="effectContainer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1001; pointer-events: none;"></div>
</div>



<!-- 範疇選擇：動漫卡片風格 (已修訂：放入一致的 Container) -->
<div class="box" id="mainMenuBox"> <!-- 這裡加上了 ID -->
    <h2>選擇範疇：</h2>
    
   <!-- 音效檔：拔劍出鞘 (Metal Sword Sheath) -->
    <audio id="ui-click-sound" preload="auto">
        <source src="點擊.mp3" type="audio/mpeg">
    </audio>

    <div class="category-cards-wrapper">
        <div class="category-cards-container">
            <!-- 閱讀卡片 -->
            <div id="readingBtn" class="anime-card" style="--bg-img: url('郵筒.png');">
                <div class="card-overlay"></div>
                <div class="card-border-effect"></div>
                <div class="card-content">
                 
                    <div class="card-text">
                        <span class="card-zh">閱讀</span>
                        <span class="card-en">READING</span>
                    </div>
                </div>
            </div>

            <!-- 敘事抒情卡片 -->
            <div id="writingBtn" class="anime-card" style="--bg-img: url('相機.png');">
                <div class="card-overlay"></div>
                <div class="card-border-effect"></div>
                <div class="card-content">
                  
                    <div class="card-text">
                        <span class="card-zh">敘事抒情</span>
                        <span class="card-en">NARRATIVE</span>
                    </div>
                </div>
            </div>

            <!-- 議論卡片 -->
            <div id="argumentBtn" class="anime-card" style="--bg-img: url('筆.png');">
                <div class="card-overlay"></div>
                <div class="card-border-effect"></div>
                <div class="card-content">
                
                    <div class="card-text">
                        <span class="card-zh">議論</span>
                        <span class="card-en">ARGUMENT</span>
                    </div>
                </div>
            </div>

            <!-- 整合拓展卡片 -->
            <div id="expandBtn" class="anime-card" style="--bg-img: url('火車.png');">
                <div class="card-overlay"></div>
                <div class="card-border-effect"></div>
                <div class="card-content">
                  
                    <div class="card-text">
                        <span class="card-zh">整合拓展</span>
                        <span class="card-en">EXPAND</span>
                    </div>
                </div>
            </div>




        </div>
    </div>
</div>

<!-- 寫作容器 -->
<div id="writingContainer" class="box">
    <h2>敘事抒情</h2>
    <div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/lke2eo?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;" referrerpolicy="no-referrer-when-downgrade" credentialless></iframe></div>

    <div class="function-selector-wrapper">
        <label for="writingType">選擇功能：</label>
        <select id="writingType" onchange="toggleWritingType()">
            <option value="" selected disabled>請在此選擇功能</option>
           
            <option value="大綱">大綱點評</option>
            <option value="片段描寫">文章點評</option>
			 <option value="guide">解題指引</option>
            <option value="敘事物象">敘事物象</option>
        </select>
    </div>

    <div id="writingContentContainer" style="display: none;">
        
        <!-- === 新增：解題指引區域 (修訂版) === -->
        <div id="writingGuideArea" style="display: none;">
            <label for="writingGuideTopicInput">請輸入題目：</label>
            <input type="text" id="writingGuideTopicInput" placeholder="例如：寂寞的真相、被遺忘的承諾..." style="font-size: 1.1rem;">
            
            <button id="submitWritingGuideBtn" class="btn-action" onclick="submitWritingGuide()">提交分析</button>

            <!-- 結果顯示區 -->
            <div id="writingGuideResultContainer" style="display: none; margin-top: 25px;">
                
                <!-- 第一部分：關鍵詞張力分析 -->
                <div class="guide-section-header" style="border-left: 5px solid #4A90E2; color: #4A90E2;">
                    <h3><i class="fas fa-search"></i> 題眼分析</h3>
                </div>
                <!-- 總體分析 (比喻與關係) -->
                <div id="guideIntro" class="guide-intro-card"></div>
                <!-- 三種心情 (三欄佈局) -->
                <div id="guideEmotions" class="guide-grid-3"></div>

                <!-- 第二部分：寫作方向建議 -->
                <div class="guide-section-header" style="border-left: 5px solid #28a745; color: #28a745; margin-top: 30px;">
                    <h3><i class="fas fa-compass"></i> 寫作方向</h3>
                </div>
                <!-- 三個故事種子 (三欄佈局) -->
                <div id="guideSeeds" class="guide-grid-3"></div>


<!-- 新增：解題指引的聊天室介面 -->
                <div id="writingGuideChatHistory" style="display: none; background-color: #f0f4f8; border: 1px solid #dde3ea; border-radius: 12px; padding: 20px 15px; margin-top: 15px; margin-bottom: 15px; max-height: 400px; overflow-y: auto; flex-direction: column;"></div>
                
                <div id="writingGuideChatInputContainer" style="display: none; align-items: center; gap: 10px; margin-top: 15px;">
                    <textarea id="writingGuideUserInput" class="no-modal-editor" rows="2" placeholder="可就以上指引追問..." style="flex-grow: 1; margin: 0;"></textarea>
                    <button id="continueWritingGuideBtn" class="btn-icon-action" onclick="continueWritingGuideDiscussion()" title="繼續討論" style="background-color: #2d9966;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
				</div>

				
                <!-- 儲存按鈕 -->
                <div class="result-wrapper">
                    <button id="save-guide-html-btn" class="btn-save-html" title="儲存為HTML檔案" onclick="savePageAsHTML('神思-敘事抒情-解題指引.html')" style="display: flex;">
                        <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- === 新增結束 === -->

        <div id="outlineStructureArea" style="display: none;">
            <label for="structure">選擇大綱結構：</label>
            <select id="structure" onchange="generateOutlineTable()">
                <option value="fourPart">起承轉合</option>
                <option value="threeLine">三線</option>
            </select>
        </div>
        
        <!-- ... 舊有代碼保持不變 ... -->
        <div id="topicSelectionArea">
            <label>選擇題目方式：</label>
            <div class="topic-buttons-container">
                <button class="btn btn-generate" onclick="generateTopic(this)">
                    <i class="fas fa-sync-alt"></i> 生成
                </button>
                <button class="btn btn-custom" onclick="showCustomTopicInput(this)">
                    <i class="fas fa-edit"></i> 自訂
                </button>
            </div>
            <div id="customTopicArea" style="display: none; margin-top: 15px;"></div>
        </div>

        <div id="topicResult"></div>
        <div id="narrativeElementsArea" style="display: none;">
            <label for="narrativeElements">請輸入您的取材或故事背景：</label>
            <textarea id="narrativeElements" rows="5" placeholder="例如：故事背景、人物設定、取材等..."></textarea>
        </div>
        
        <div id="writingArea">
            <div id="outlineTableArea"></div>
            <div id="outlineButtons" style="display: none;" class="action-buttons-container">
                <button class="btn-icon-action btn-save-icon" onclick="saveOutline()" title="儲存大綱">
                    <i class="fas fa-save"></i>
                </button>
                <button class="btn-icon-action btn-clear-icon" onclick="clearOutline()" title="清空大綱">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            <textarea id="writingContent" rows="10" placeholder="請在此輸入您的文章..." style="display: none;"></textarea>
            
            <label for="writingTone" id="writingToneLabel" class="tone-selector-label" style="display: none;">選擇點評語氣：</label>
            <select id="writingTone" style="display: none;">
                <option value="serious">嚴肅正經</option>
                <option value="chen">陳SIR語氣</option>
            </select>

            <label for="writingReviewer" id="writingReviewerLabel" class="tone-selector-label" style="display: none;">選擇閱卷員：</label>
            <select id="writingReviewer" style="display: none;">
                <option value="chen_sir" selected>陳Sir</option>
                <option value="ms_chan">Ms Chan</option>
                <option value="huang_laoshi">黃老師</option>
                <option value="deng_laoshi">鄧老師</option>
                <option value="xiao_laoshi">蕭老師</option>
                <option value="dong_laoshi">董老師</option>
                <option value="li_laoshi">李老師</option>
                <option value="zhen_laoshi">甄老師</option>
                <option value="wen_laoshi">溫老師</option>
                <option value="jiang_laoshi">江老師</option>
            </select>

            <div id="reviewScopeArea" style="display: none; margin-top: 25px;">
                <label class="tone-selector-label">選擇點評範疇：</label>
                <div class="scope-selector-container">
                    <label class="scope-label all-scope"><input type="checkbox" name="reviewScope" value="全部" checked> 全部</label>
                    <label class="scope-label"><input type="checkbox" name="reviewScope" value="扣題"> 扣題</label>
                    <label class="scope-label"><input type="checkbox" name="reviewScope" value="立意"> 立意</label>
                    <label class="scope-label"><input type="checkbox" name="reviewScope" value="取材"> 取材</label>
                    <label class="scope-label"><input type="checkbox" name="reviewScope" value="詳略"> 詳略</label>
                    <label class="scope-label"><input type="checkbox" name="reviewScope" value="文筆"> 文筆</label>
                </div>
            </div>

            <button id="submitWritingBtn" class="btn-action" onclick="submitWriting()">提交</button>
            
            <div id="writingReviewResultContainer">
                <div id="writingGradingResult"></div>
                <div id="writingChatHistory" style="display: none;"></div>
                <div id="writingChatInputContainer" style="display: none;">
                    <textarea id="writingUserInput" class="no-modal-editor" rows="2" placeholder="可就以上點評追問..."></textarea>
                    <button id="continueWritingBtn" class="btn-icon-action" onclick="continueWritingDiscussion()" title="繼續討論" style="background-color: #2d9966;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            
            <div class="result-wrapper" style="position: relative;">
                <div id="commentResult"></div>
              
            </div>
        </div>
    </div>
</div>



<!-- 閱讀容器 -->
<div id="readingContainer" class="box" style="display: none;">
<h2>閱讀</h2>
<div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/vt3i1j?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;" referrerpolicy="no-referrer-when-downgrade" credentialless></iframe></div>

<div class="function-selector-wrapper">
<label for="readingFunction">選擇功能：</label>
<select id="readingFunction" onchange="toggleReadingFunction()">
<option value="" selected disabled>請在此選擇功能</option>
<option value="comment">點評</option>
<option value="guide">指引</option>
<option value="training">訓練</option>  <!-- 新增此行 -->
</select>
</div>

<div id="readingInputArea" style="display: none;">
<label for="readingPassage">貼上閱讀篇章：</label>
<textarea id="readingPassage" rows="10" placeholder="請在此貼上閱讀篇章..."></textarea>
<label for="readingQuestion">貼上題目：</label>
<textarea id="readingQuestion" rows="3" placeholder="請在此貼上題目..."></textarea>
<div id="studentAnswerArea" style="display: none;">
<label for="studentAnswer">貼上答案：</label>
<textarea id="studentAnswer" rows="5" placeholder="請在此貼上答案..."></textarea>
</div>
<label for="readingTone" id="readingToneLabel" class="tone-selector-label" style="display: none;">選擇點評語氣：</label>
<select id="readingTone" style="display: none;">
<option value="serious">嚴肅正經</option>
<option value="chen">陳SIR語氣</option>
</select>
<!-- 將 <button onclick="submitReading()"> 改為： -->
<button id="submitReadingBtn" class="btn-action" onclick="submitReading()">提交</button>
<div class="result-wrapper" style="position: relative;">
	<div id="readingResult"></div>
	
</div>
</div>
</div>

<!-- 課外書籍容器 -->
<div id="booksContainer" class="box" style="display: none;">
<h2>書籍討論</h2>
<div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/4eznsi?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;" referrerpolicy="no-referrer-when-downgrade" credentialless></iframe></div>

<!-- 初始輸入表單 -->
<div id="initialDiscussionForm">
<p>請在下方填寫書名、作者和討論問題，開始與陳SIR對話：</p>
<input type="text" id="bookTitle" class="no-modal-editor" placeholder="書名">
<input type="text" id="author" class="no-modal-editor" placeholder="作者">
<textarea id="discussionQuestion" class="no-modal-editor" rows="3" placeholder="討論問題"></textarea>
<label for="booksTone">選擇語氣：</label>
<select id="booksTone">
<option value="serious">嚴肅正經</option>
<option value="casual">輕鬆活潑</option>
</select>
<div id="discussionControlButtons">
<button id="startDiscussionBtn" class="btn-action" onclick="startDiscussion()">開始討論</button>
</div>
</div>

<!-- 聊天歷史紀錄 -->
<div class="result-wrapper" style="position: relative;">
	<div id="chatHistory"></div>
	
</div>


<!-- 聊天輸入介面 (已移除新增按鈕) -->
<div id="chatInputContainer">
<textarea id="userInput" class="no-modal-editor" rows="2" placeholder="請在此輸入您的回應..."></textarea>
<button id="continueBtn" class="btn-icon-action" onclick="continueDiscussion()" title="繼續討論" style="background-color: #2d9966;">
<i class="fas fa-paper-plane"></i>
</button>
</div>

<!-- 儲存/清除按鈕 (已加入新增按鈕) -->
<div id="booksButtons" class="action-buttons-container">
  
	
<!-- 「新增討論」按鈕已移到此處，位於儲存按鈕左方 -->
<button id="newTopicBtn" class="btn-icon-action btn-add-icon" title="新增討論主題">
<i class="fas fa-plus"></i>
</button>
<button class="btn-icon-action btn-save-icon" onclick="saveBooksChat()" title="儲存對話">
<i class="fas fa-save"></i>
</button>
<button class="btn-icon-action btn-clear-icon" onclick="clearBooksChat()" title="清空對話">
<i class="fas fa-trash-alt"></i>
</button>
</div>
</div>

<!-- 新增討論的彈出視窗 -->
<div id="newTopicModal" class="books-modal">
<div class="modal-content">
<span class="close-modal-btn" id="closeNewTopicModal">&times;</span>
<h3>新增討論</h3>
<input type="text" id="modalBookTitle" class="no-modal-editor" placeholder="書名">
<input type="text" id="modalAuthor" class="no-modal-editor" placeholder="作者">
<textarea id="modalDiscussionQuestion" class="no-modal-editor" rows="3" placeholder="討論問題"></textarea>
<div style="text-align: right; margin-top:15px;">
<button id="modalStartDiscussionBtn" class="btn-icon-confirm" title="開始新討論">
<i class="fas fa-check"></i>
</button>
</div>
</div>
</div>


<!-- 整合拓展容器 -->
<div id="expandContainer" class="box" style="display: none;">
<h2>整合拓展</h2>
<div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/2otwxv?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;" referrerpolicy="no-referrer-when-downgrade" credentialless></iframe></div>

<div class="function-selector-wrapper">
<label for="expandFunction">選擇功能：</label>
<select id="expandFunction" onchange="toggleExpandFunction()">
<option value="" selected disabled>請在此選擇功能</option>
<option value="comment">點評</option>
<option value="guide">指引</option>
</select>
</div>

<div id="expandContentContainer" style="display: none;">

<div id="expandTopicSelectionArea" style="display: none;">
<label>選擇題目方式：</label>
<div class="topic-buttons-container">
<!-- 套用新的 class: btn-generate -->
<button class="btn btn-generate" onclick="generateExpandTopic(this)">
<i class="fas fa-sync-alt"></i> 生成
</button>
<!-- 套用新的 class: btn-custom -->
<button class="btn btn-custom" onclick="showExpandCustomTopicInput(this)">
<i class="fas fa-edit"></i> 自訂
</button>
</div>
<!-- 這個 div 用來動態顯示自訂題目的輸入框 -->
<div id="expandCustomTopicInputArea" style="display: none; margin-top: 15px;">
</div>
</div>
<div id="expandTopicResult"></div>

<div id="expandWritingArea" style="display: none;">
<label for="expandContent">整合拓展（最多180字）：</label>
<textarea id="expandContent" rows="5" placeholder="請在此輸入整合拓展內容..." oninput="updateCharCount()"></textarea>
<p id="charCount">剩餘字數：180</p>
<label for="expandTone" id="expandToneLabel" class="tone-selector-label" style="display: none;">選擇點評語氣：</label>
<select id="expandTone" style="display: none;">
<option value="serious">嚴肅正經</option>
<option value="chen">陳SIR語氣</option>
</select>
<!-- 將 <button onclick="submitExpand()"> 改為： -->
<button id="submitExpandBtn" class="btn-action" onclick="submitExpand()">提交</button>
<div class="result-wrapper" style="position: relative;">
	<div id="expandCommentResult"></div>
	
</div>
</div>

<div id="expandGuideArea" style="display: none;">
<table>
<tr><th>題目</th><td><input type="text" id="expandGuideTitle" placeholder="請輸入題目"></td></tr>
<tr><th>主題句</th><td><textarea id="expandGuideTheme" rows="2" placeholder="請輸入主題句"></textarea></td></tr>
<tr><th>抄錄資料</th><td><textarea id="expandGuideData" rows="3" placeholder="請輸入抄錄資料"></textarea></td></tr>
<tr><th>整合拓展</th><td><textarea id="expandGuideExpand" rows="3" placeholder="請輸入整合拓展"></textarea></td></tr>
</table>
<!-- 【修訂處】為按鈕添加 ID -->
<button id="submitExpandGuideBtn" class="btn-action" onclick="submitExpand()">提交</button>
<div style="position: relative;">
	<div id="expandGuideResult"></div>

</div>
</div></div>
</div>

<!-- 議論容器 -->
<div id="argumentContainer" class="box" style="display: none;">
<h2>議論</h2>
<div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/0ki8mx?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;" referrerpolicy="no-referrer-when-downgrade" credentialless></iframe></div>

<div class="function-selector-wrapper">
<label for="argumentType">選擇功能：</label>
<select id="argumentType" onchange="toggleArgumentType()">
<option value="" selected disabled>請在此選擇功能</option>
<option value="outline">大綱點評</option>
<option value="writing">文章點評</option>
<option value="guide">指引</option>
</select>
</div>

<div id="argumentContentContainer" style="display: none;">
<div id="argumentTopicSelectionArea">
<label>選擇題目方式：</label>
<div class="topic-buttons-container">
<!-- 套用新的 class: btn-generate -->
<button class="btn btn-generate" onclick="generateArgumentTopic(this)">
<i class="fas fa-sync-alt"></i> 生成
</button>
<!-- 套用新的 class: btn-custom -->
<button class="btn btn-custom" onclick="showArgumentCustomTopicInput(this)">
<i class="fas fa-edit"></i> 自訂
</button>
</div>
<div id="argumentCustomTopicArea" style="display: none; margin-top: 15px;">
<!-- 內容將由 JavaScript 動態生成 -->
</div>
</div>
<div id="argumentTopicResult"></div>
<div id="argumentOutlineArea" style="display: none;">

<div id="argumentOutlineTableArea"></div>

<!-- 按鈕容器現在包含了新增、儲存和清除按鈕 -->
<div id="argumentOutlineButtons" class="action-buttons-container">
<button class="btn-icon-action btn-add-icon" onclick="addArgumentStructureSegment()" title="新增結構段">
<i class="fas fa-plus"></i>
</button>
<button class="btn-icon-action btn-save-icon" onclick="saveArgumentOutline()" title="儲存大綱">
<i class="fas fa-save"></i>
</button>
<button class="btn-icon-action btn-clear-icon" onclick="clearArgumentOutline()" title="清空大綱">
<i class="fas fa-trash-alt"></i>
</button>
</div>

<label for="argumentOutlineTone" class="tone-selector-label">選擇點評語氣：</label>
<select id="argumentOutlineTone">
<option value="serious">嚴肅正經</option>
<option value="chen">陳SIR語氣</option>
</select>
<button id="submitArgumentOutlineBtn" class="btn-action" onclick="submitArgumentOutline()">提交</button>
<div class="result-wrapper" style="position: relative;">
	<div id="argumentOutlineResult"></div>

</div>
</div>
<div id="argumentWritingArea" style="display: none;">
<textarea id="argumentWritingContent" rows="10" placeholder="請在此輸入您的文章..."></textarea>
<label for="argumentWritingTone" class="tone-selector-label">選擇點評語氣：</label>
<select id="argumentWritingTone">
        <option value="serious">嚴肅正經</option>
        <option value="chen">陳SIR語氣</option>
    </select>

    <!-- ======= 請在這裡加入以下程式碼 ======= -->
    <label for="argumentReviewer" class="tone-selector-label">選擇閱卷員：</label>
    <select id="argumentReviewer">
      <option value="chen_sir" selected>陳Sir</option>
      <option value="ms_chan">Ms Chan</option>
      <option value="huang_laoshi">黃老師</option>
      <option value="deng_laoshi">鄧老師</option>
      <option value="xiao_laoshi">蕭老師</option>
      <option value="dong_laoshi">董老師</option>
      <option value="li_laoshi">李老師</option>
      <option value="zhen_laoshi">甄老師</option>
      <option value="wen_laoshi">溫老師</option>
      <option value="jiang_laoshi">江老師</option>
    </select>
    <!-- ======= 加入結束 ======= -->

<!-- ======= 請在這裡加入【議論文點評範疇】HTML 程式碼 ======= -->
<div id="argumentReviewScopeArea" style="display: none; margin-top: 25px;">
    <label class="tone-selector-label">選擇點評範疇：</label>
    <div class="scope-selector-container">
        <label class="scope-label all-scope"><input type="checkbox" name="argumentReviewScope" value="全部" checked> 全部</label>
        <label class="scope-label"><input type="checkbox" name="argumentReviewScope" value="謀篇"> 謀篇</label>
        <label class="scope-label"><input type="checkbox" name="argumentReviewScope" value="論點"> 論點</label>
        <label class="scope-label"><input type="checkbox" name="argumentReviewScope" value="論據"> 論據</label>
        <label class="scope-label"><input type="checkbox" name="argumentReviewScope" value="論證"> 論證</label>
        <label class="scope-label"><input type="checkbox" name="argumentReviewScope" value="文筆"> 文筆</label>
    </div>
</div>
<!-- ======= 加入結束 ======= -->

  <button id="submitArgumentWritingBtn" class="btn-action" onclick="submitArgumentWriting()">提交</button>

    <!-- 正確的結構：用 result-wrapper 包裹住所有結果和聊天介面 -->
    <div class="result-wrapper">
        
        <!-- 評分卡、文字點評和聊天介面都將被動態放入這個容器中 -->
        <div id="argumentReviewResultContainer">
            <!-- 評分系統或聚焦式點評將會被動態插入到這裡 -->
            <div id="argumentGradingResult"></div>

            <!-- 聊天歷史紀錄 -->
            <div id="argumentChatHistory" style="display: none;"></div>

            <!-- 聊天輸入介面 -->
            <div id="argumentChatInputContainer" style="display: none;">
                <textarea id="argumentUserInput" class="no-modal-editor" rows="2" placeholder="可就以上點評追問..."></textarea>
                <button id="continueArgumentBtn" class="btn-icon-action" onclick="continueArgumentDiscussion()" title="繼續討論" style="background-color: #2d9966;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

    
    </div>
</div>
<div id="argumentGuideArea" style="display: none;">
<label for="argumentGuideTopic">題目：</label>
<input type="text" id="argumentGuideTopic" placeholder="請輸入題目">
<label for="argumentGuidePoint">論點（可選）：</label>
<textarea id="argumentGuidePoint" rows="3" placeholder="請輸入論點"></textarea>
<label for="argumentGuideEvidence">論據（可選）：</label>
<textarea id="argumentGuideEvidence" rows="3" placeholder="請輸入論據"></textarea>
<label for="argumentGuideArgument">論證（可選）：</label>
<textarea id="argumentGuideArgument" rows="3" placeholder="請輸入論證"></textarea>
<button id="submitArgumentGuideBtn" class="btn-action" onclick="submitArgumentGuide()">提交</button>
<div class="result-wrapper" style="position: relative;">
	<div id="argumentGuideResult"></div>
	
</div>
</div>
</div>
</div>

<!-- 音樂播放器 HTML (已更換圖示) -->
<!-- 音樂播放器 HTML (已移除懸浮按鈕) -->
<!-- 音樂播放器 HTML -->
<div id="music-player">
    <div class="controls">
        <select id="music-select">
            <option value="">選擇音樂</option>
            <!-- 其他選項已被移除，將由 JS 動態載入 -->
        </select>
        <button id="play-pause" title="播放/暫停"><i class="fas fa-play"></i></button>
    </div>
    
    <div class="progress">
        <input type="range" id="progress-bar-music" value="0" min="0" max="100">
    </div>
    
    <div class="mode">
        <select id="play-mode">
            <option value="loop" selected>單曲循環</option>
            <option value="next">自動播放下首</option>
        </select>
    </div>
    
    <button class="hide-btn" id="hide-player" title="關閉播放器"><i class="fas fa-chevron-down"></i></button>
</div>

<!-- 將 preload 改為 none，避免頁面載入時下載音訊 -->
<audio id="audio" preload="none"></audio>
<!-- === 歷史紀錄容器 (最終版) === -->
<div id="historyContainer" class="box" style="display: none;">
    
 <!-- 標題列 -->
    <div class="history-header-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
        <h2 style="margin:0; color: #333; font-size: 1.5em;"><i class="fas fa-history"></i> 歷史紀錄</h2>
        
        <div style="display: flex; gap: 10px;">
            
            <!-- ★★★ 新增：生成學習報告按鈕 ★★★ -->
           <button class="history-clear-btn" title="學習報告" onclick="openReportMenu()" style="color: #2A9689;">
    <i class="fas fa-chart-pie"></i>
</button>
            <!-- ★★★ 新增結束 ★★★ -->

            <!-- 原有的：日期搜尋按鈕 -->
            <div id="historyDateSearchContainer" style="display: none; position: relative;">
                <button class="history-clear-btn" title="依日期搜尋" onclick="triggerDatePicker()">
                    <i class="fas fa-calendar-alt"></i>
                </button>
                <input type="date" id="historyDatePicker" onchange="scrollToHistoryDate(this)" 
                       style="position: absolute; top: 0; left: 0; width: 0; height: 0; opacity: 0; border: none; padding: 0;">
            </div>

            <!-- 原有的：清空按鈕 -->
            <button class="history-clear-btn" title="清空所有紀錄" onclick="clearAllHistory()">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </div>


	<!-- 學習報告操作選單 (新增) -->
<div id="reportMenuModal" class="report-menu-overlay" onclick="closeReportMenu(event)">
    <div class="report-menu-content">
        <div class="report-menu-title">學習報告</div>
        <div class="report-options-grid">
            <!-- 選項一：生成新報告 -->
            <div class="report-option-card" onclick="generateHistoryReport()">
                <i class="fas fa-magic report-option-icon"></i>
                <span class="report-option-text">生成新報告</span>
            </div>
            <!-- 選項二：檢閱紀錄 -->
            <div class="report-option-card" onclick="viewPastReports()">
                <i class="fas fa-folder-open report-option-icon"></i>
                <span class="report-option-text">檢閱紀錄</span>
            </div>
        </div>
    </div>
</div>

    <!-- 麵包屑導航 -->
    <div id="historyBreadcrumb" class="history-breadcrumb" style="display: none; margin-bottom: 20px; padding: 10px 15px; background: rgba(0,0,0,0.05); border-radius: 8px; font-size: 1rem;">
        <span onclick="renderHistoryCategories()" style="cursor: pointer; color: #007bff; font-weight: bold;"><i class="fas fa-home"></i> 主範疇</span> 
        <span id="breadcrumb-sep-1" style="display:none; color: #666;"> &gt; </span>
        <span id="breadcrumb-category" onclick="backToSubFunctions()" style="cursor: pointer; color: #007bff; display:none;"></span>
        <span id="breadcrumb-sep-2" style="display:none; color: #666;"> &gt; </span>
        <span id="breadcrumb-sub" style="font-weight: bold; color: #333; display:none;"></span>
    </div>

    <!-- 第一層：主範疇選擇 (卡片容器) -->
    <div id="historyLevel1Wrapper" class="category-cards-wrapper" style="padding-top: 10px; padding-bottom: 20px;">
        <div id="historyLevel1" class="category-cards-container">
            <!-- JS 將在這裡生成動漫卡片 -->
        </div>
    </div>

    <!-- 第二層：子功能選擇 (Grid 選單) -->
    <div id="historyLevel2" class="history-grid-menu" style="display: none;">
        <!-- JS 生成子功能按鈕 -->
    </div>

    <!-- 第三層：紀錄列表 -->
    <div id="historyLevel3" class="history-list-container" style="display: none;">
        <!-- JS 生成紀錄卡片 -->
    </div>
</div>

<!-- === 歷史紀錄詳細檢視視窗 (保持不變) === -->
<div id="historyModal" class="preview-modal-overlay">
    <div class="preview-modal-content" style="max-width: 900px; height: 90%;">
        <div class="history-modal-header" style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
            <h3 id="historyModalTitle" style="margin: 0; color: #2A9689;">紀錄詳情</h3>
            <span id="historyModalDate" style="color: #888; font-size: 0.9em;"></span>
        </div>
        <div class="preview-modal-body" style="padding: 20px; overflow-y: auto; display: block;">
            <div id="historyModalContent"></div>
        </div>
        <button class="preview-close-btn" onclick="closeHistoryModal()" style="top: 10px; right: 10px;">&times;</button>
    </div>
</div>

	
<!-- 展開工具二 (語薈) 容器 -->
<div id="toolsContainer2">
<button id="closeToolsBtn2">&times;</button>
<div class="main-container">
<!-- Floating Title -->
<!-- Floating Title -->
<header class="floating-header">
<h1>語薈</h1>
<button id="video-tour-btn" title="觀看介紹影片">
<svg class="icon" viewBox="0 0 24 24"><use xlink:href="#icon-video"></use></svg>
</button>
</header>

<!-- Embedded SVG Icons -->
<svg width="0" height="0" style="position:absolute">
<defs>
<symbol id="icon-brain" viewBox="0 0 24 24"><path d="M7.445 11.232C7.445 10.537 7.98 9.96 8.629 9.96H9.02V8.203H7.818C6.983 8.203 6.3 8.91 6.3 9.778V11.23H5.161C4.326 11.23 3.644 11.938 3.644 12.806V14.17H2.82C2.17 14.17 1.636 14.746 1.636 15.44V17.65H1.523C.688 17.65 0 18.358 0 19.226V20.48C0 21.35 0.688 22.056 1.523 22.056H6.738C6.738 23.13 7.573 24 8.628 24H15.37C16.425 24 17.26 23.13 17.26 22.058H22.477C23.312 22.058 24 21.35 24 20.48V19.225C24 18.357 23.312 17.65 22.477 17.65H22.364V15.44C22.364 14.745 21.83 14.17 21.18 14.17H20.356V12.805C20.356 11.937 19.674 11.23 18.839 11.23H17.68V9.777C17.68 8.908 17.017 8.2 16.182 8.2H14.98V9.96H15.37C16.02 9.96 16.555 10.536 16.555 11.23V12.986H15.37V15.92H8.629V12.986H7.445V11.232M11.1 11.23H12.9V14.17H11.1V11.23M12 1.947C10.13 1.947 8.58 2.894 7.854 4.316C7.65 3.52 7.2 2.813 6.545 2.27C5.124 1.053 2.95 1.54 1.987 3.16C0.945 4.925 1.489 7.346 3.09 8.528C3.21 8.62 3.33 8.71 3.464 8.78C3.464 7.024 4.818 5.618 6.52 5.618C8.22 5.618 9.573 7.024 9.573 8.78V9.1H14.4V8.78C14.4 7.024 15.78 5.618 17.48 5.618C19.18 5.618 20.536 7.024 20.536 8.78C20.662 8.71 20.782 8.62 20.91 8.528C22.51 7.346 23.055 4.925 22.013 3.16C21.05 1.54 18.876 1.053 17.455 2.27C16.8 2.813 16.35 3.52 16.145 4.316C15.42 2.894 13.87 1.947 12 1.947Z"/></symbol>
<symbol id="icon-write" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></symbol>
<symbol id="icon-read" viewBox="0 0 24 24"><path d="M18.5,1.15C19.9,1.15 21.15,2.4 21.15,3.85V15.85C21.15,17.3 19.9,18.55 18.5,18.55H5.5C4.1,18.55 2.85,17.3 2.85,15.85V3.85C2.85,2.4 4.1,1.15 5.5,1.15H18.5M18.5,22.85H5.5C2.45,22.85 0,20.4 0,17.35V2.35C0,1.4 0.35,0.6 0.95,0.1C1.25,-0.1 1.7,-0.05 2,0.25L3.1,1.35C3.3,1.55 3.3,1.85 3.1,2.05L2.05,3.1C1.85,3.3 1.55,3.3 1.35,3.1L0.7,2.45C0.7,5.55 2.85,7.85 5.5,7.85H18.5C21.15,7.85 23.3,5.55 23.3,2.45L22.6,3.1C22.4,3.3 22.1,3.3 21.9,3.1L20.85,2.05C20.65,1.85 20.65,1.55 20.85,1.35L21.95,0.25C22.25,-0.05 22.7,-0.1 23,0.1C23.6,0.6 24,1.4 24,2.35V17.35C24,20.4 21.5,22.85 18.5,22.85Z" /></symbol>
<symbol id="icon-work" viewBox="0 0 24 24"><path d="M14,6V4H10V6H14M18,9H15V6H9V9H6A2,2 0 0,0 4,11V19A2,2 0 0,0 6,21H18A2,2 0 0,0 20,19V11A2,2 0 0,0 18,9Z" /></symbol>
<symbol id="icon-support" viewBox="0 0 24 24"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" /></symbol>
<symbol id="icon-foundation" viewBox="0 0 24 24"><path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM19.6 8.25L12 12.5L4.4 8.25L12 4L19.6 8.25Z"/></symbol>
<symbol id="icon-explore" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A1.5,1.5 0 0,1 13.5,5.5A1.5,1.5 0 0,1 12,7A1.5,1.5 0 0,1 10.5,5.5A1.5,1.5 0 0,1 12,4M12,18.2C9.5,18.2 7.29,16.42 6.5,14H17.5C16.71,16.42 14.5,18.2 12,18.2Z"/></symbol>
<symbol id="icon-video" viewBox="0 0 24 24"><path d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z" /></symbol>
</defs>
</svg>

<!-- Mind Map Layout -->
<main class="mind-map-container" id="mind-map">
<svg class="connector-svg" id="connector-svg"></svg>

<!-- 1. Core AI -->
<div class="category" id="core-ai" data-connect-to="">
<div class="node" data-id="core-ai-node" style="padding: 10px 20px;">
<a href="https://kenchan20141.github.io/AIChinese/" data-tool-id="sansi">






<svg class="icon" style="width:32px; height:32px;"><use xlink:href="#icon-brain"></use></svg>
神思
</a>
</div>
<div class="sub-group" style="flex-direction: row; gap: 10px;">

<div class="node level-3"><a href="https://sansi.vercel.app/" data-tool-id="sansi-v3">神思 (備用)</a></div>
</div>
</div>

<!-- Foundations tier -->
<div id="foundations" data-connect-to="core-ai-node">
<div class="foundation-item" data-id="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-foundation"></use></svg>應試</div>
<div class="sub-group-title">AI擬題</div>
<div class="node level-2"><a href="toolbox/generator.html" data-tool-id="tizi">題孳<br></a></div>
</div>
<div class="foundation-item" data-id="foundation-explore">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-explore"></use></svg>課外探索</div>
<div class="sub-group-title">課外篇章</div>
<div class="node level-2"><a href="toolbox/reading.html" data-tool-id="reading-pieces">文學・片段</a></div>
<div class="node level-2"><a href="toolbox/mensyu.html" data-tool-id="mensyu">文樞</a></div>
<div class="node level-2"><a href="toolbox/slowreading.html" data-tool-id="slowreading">慢讀</a></div>
<div class="sub-group-title">主題探討</div>
<div class="node level-2"><a href="https://litstudy.vercel.app/" data-tool-id="study">文學專題探究</a></div>

<div class="sub-group-title">生活詩意</div>
<div class="node level-2"><a href="toolbox/wabisabi.html" data-tool-id="wabisabi">一瞬之詩</a></div>
<div class="sub-group-title">書籍推薦</div>
<div class="node level-2"><a href="https://621d05f47d591.site123.me/%E6%9B%B8%E9%96%A3%E8%97%8F%E6%9B%B8%E6%A6%82%E8%A6%BD" data-tool-id="book-overview">書籍概覽</a></div>
	<div class="sub-group-title">歌詞遊戲</div>
<div class="node level-2"><a href="https://lyricschi.vercel.app/" data-tool-id="lyrics">詞海拾心</a></div>
</div>
</div>

<!-- 2. Writing -->
<div class="category" id="writing" data-connect-to="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-write"></use></svg>寫作創作</div>
<div class="sub-group">
<div class="sub-group-title">AI範文</div>
<div class="node level-2"><a href="toolbox/article.html" data-tool-id="fanshui-narrative">翻水 (敘事)</a></div>
<div class="node level-2"><a href="toolbox/essay.html" data-tool-id="fanshui-argument">翻水 (議論)</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">草擬</div>
<div class="node level-2"><a href="toolbox/manuscriptpaper.html" data-tool-id="manuscript">智能原稿紙</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">潤色與延伸</div>
<div class="node level-2"><a href="toolbox/words.html" data-tool-id="words">字斟・句酌</a></div>
<div class="node level-2"><a href="toolbox/slideshow.html" data-tool-id="slideshow">文章幻燈片</a></div>
</div>
</div>

<!-- 3. Reading -->
<div class="category" id="reading" data-connect-to="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-read"></use></svg>閱讀溫習</div>
 <div class="sub-group">
        <div class="sub-group-title">課文溫習</div>
        <!-- 修改處：移除 id="yuyilu-toggle"，直接放入連結，並移除下方的 yuyilu-grades div -->
        <div class="node level-2">
            <a href="https://kenchan20141.github.io/f1chinese/" data-tool-id="yuyilu">語弈錄</a>
        </div>
        <div class="node level-2"><a href="toolbox/timer.html" data-tool-id="timer">背書神器</a></div>
    </div>

    <div class="sub-group">
        <div class="sub-group-title">文言文</div>
        <div class="node level-2"><a href="toolbox/mensyu.html" data-tool-id="mensyu-2">文樞</a></div>
    </div>
</div>

<!-- 4. Assignments -->
<div class="category" id="assignments" data-connect-to="core-ai-node">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-work"></use></svg>工具</div>
<div class="sub-group">
<div class="sub-group-title">課業流程</div>
<div class="node level-2"><a href="https://script.google.com/a/macros/ccckyc.edu.hk/s/AKfycby1T18HxuFICIaR0LYWRuaqlpmglkL191bVl39MH69zj5CQ-uhozF17edtJ_T54NhZ5/exec" data-tool-id="zhiyun">帙雲</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">實用工具</div>
<div class="node level-2"><a href="toolbox/WCT.html" data-tool-id="zhuoyu">琢玉</a></div>
<div class="node level-2"><a href="toolbox/quizbuzzer.html" data-tool-id="quizbuzzer">搶答器</a></div>
	<div class="node level-2"><a href="toolbox/pulseqa.html" data-tool-id="pulseqa">脈問堂</a></div>
<div class="node level-2"><a href="https://www.i2ocr.com/free-online-chinese-traditional-ocr" data-tool-id="ocr">手寫文字轉換 (OCR)</a></div>
<div class="node level-2"><a href="toolbox/epub.html" data-tool-id="epub">電子書閱讀器</a></div>
	<div class="node level-2"><a href="toolbox/decibelmeter.html" data-tool-id="decibelmeter">分貝計</a></div>
	<div class="node level-2"><a href="https://penpalchi.vercel.app/" data-tool-id="friends">以文會友</a></div>
</div>
</div>

<!-- 5. Support -->
<div class="category" id="support" data-connect-to="core-ai-node">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-support"></use></svg>學習支援</div>
<div class="sub-group">
<div class="sub-group-title">AI聊天室</div>
<div class="node level-2"><a href="toolbox/chitutor.html" data-tool-id="chitutor">喻蛋教室</a></div>
<div class="node level-2"><a href="toolbox/histutor.html" data-tool-id="histutor">史萊姆教室</a></div>
<div class="node level-2"><a href="toolbox/counseling.html" data-tool-id="counseling">解憂雜貨店</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">資源庫</div>
<div class="node level-2"><a href="https://621d05f47d591.site123.me/" data-tool-id="self-learning">自學資源</a></div>
</div>
</div>
</main>
</div>
</div>

<!-- Preview Modal (修訂後) -->
<div id="previewModal" class="preview-modal-overlay">
<div class="preview-modal-content">
<div class="preview-modal-body">
<iframe id="previewIframe" src="" frameborder="0" credentialless></iframe>
<div class="preview-modal-footer">
<div id="previewDescription" class="preview-description"></div>
<a id="previewGoToPageBtn" href="" target="_blank" class="preview-goto-btn">前往</a>
</div>
</div>
<button id="previewCloseBtn" class="preview-close-btn" title="關閉">&times;</button>
</div>
</div>


<!-- Video Modal (新增) -->
<div id="videoModal" class="video-modal-overlay">
<div class="video-modal-content">
<iframe id="videoIframe" allow="fullscreen" allowfullscreen src="" width="100%" style="border:none;" credentialless></iframe>
</div>
</div>


<!-- Audio and Media Modules -->
<script src="platform/media/audio-engine.js"></script>
<script src="platform/media/music-player.js"></script>

<!-- UI Modules -->
<script src="platform/ui/custom-alert-override.js"></script>
<script src="platform/ui/custom-alerts.js"></script>
<script src="platform/ui/navigation.js"></script>
<script src="platform/ui/side-menu.js"></script>
<script src="platform/ui/cat-menu.js"></script>
<script src="platform/ui/featured-articles.js"></script>
<script src="platform/ui/history-manager.js"></script>

<!-- Platform Core Modules -->
<script src="platform/js/utils.js"></script>
<script src="platform/js/api.js"></script>
<script src="platform/js/live2d-manager.js"></script>
<script src="platform/js/live2d-gestures.js"></script>
<script src="platform/js/books-mode.js"></script>
<script src="platform/js/argument-mode.js"></script>
<script src="platform/js/expand-mode.js"></script>
<script src="platform/js/main-app-logic.js"></script>
<script src="platform/js/core-app-functions.js"></script>

<!-- Post-Body Initialization Scripts -->
<script src="platform/js/post-body-1.js"></script>
<script src="platform/js/post-body-2.js"></script>
<script src="platform/js/post-body-3.js"></script>
<script src="platform/js/post-body-4.js"></script>
<script src="platform/js/post-body-5.js"></script>
<script src="platform/js/post-body-6.js"></script>
<script src="platform/js/post-body-7.js"></script>
<script src="platform/js/post-body-8.js"></script>
<script src="platform/js/post-body-9.js"></script>
<script src="platform/js/post-body-10.js"></script>
<script src="platform/js/post-body-11.js"></script>

<!-- Tools and Auth Modules -->
<script src="platform/tools/tools-manager.js"></script>
<script src="platform/tools/rag-search.js"></script>
<script src="platform/tools/notifications.js"></script>
<script src="platform/auth/student-profile.js"></script>

</body>
</html>
