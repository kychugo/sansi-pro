/* === 全局基礎設定 === */
body {
    font-family: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background: url('背景.png') center/cover fixed;
    padding-bottom: 60px; /* 為頁面內容設置底部內邊距，避免被音樂播放器遮擋 */
    transition: background-image 0.6s ease-in-out, background-color 0.6s ease-in-out;
}

h1 {
    text-align: center;
    color: #333;
}

/* === 返回主頁按鈕樣式 === */
#homeBtn {
    position: fixed;
    top: 20px;
    left: 20px; /* 左上角 */
    z-index: 9999;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.6); /* 半透明黑底 */
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.5);
    font-size: 24px;
    cursor: pointer;
    display: none; /* 預設隱藏 */
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

#homeBtn:hover {
    background-color: rgba(0, 0, 0, 0.8);
    transform: scale(1.1);
    border-color: #fff;
}

/* === 通用容器與佈局 === */
.box {
    background: rgba(220, 220, 220, 0.96);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin: 15px 0;
}

.category {
    margin-bottom: 20px;
}

.category h3 {
    font-size: 18px;
    margin-bottom: 10px;
    color: #fff; /* 白色文字，適配深色背景 */
    text-align: left;
}

/* 手機設備調整 */
@media (max-width: 600px) {
    .category {
        padding-left: 25px; /* 增加左內邊距，讓按鍵遠離左邊緣 */
    }

    #toolsList button {
        width: auto; /* 寬度自適應文字內容 */
        display: inline-block; /* 按鈕以行內塊元素顯示，配合置中 */
        margin: 10px 0; /* 調整為上下 10px，左右 0px，避免額外水平間距 */
        font-size: 14px; /* 保留字體大小 */
        padding: 8px 16px; /* 保留內邊距，提供適當空間 */
    }

    .category h3 {
        font-size: 16px; /* 保留標題字體大小 */
    }
}

.copyright-footer {
    position: fixed;
    bottom: 0;
    right: 0;
    padding: 5px 10px;
    background-color: #f1f1f1;
}

.copyright-footer p {
    margin: 0;
    font-size: 14px;
}

@media (max-width: 600px) {
    .copyright-footer p {
        font-size: 12px;
    }
}

/* === 背景動畫效果 === */
/* 晴天效果：太陽 */
.sun {
    position: absolute;
    top: 10%;
    left: 5%; /* 調整為靠左 */
    width: 100px;
    height: 100px;
    background-color: yellow;
    border-radius: 50%;
    box-shadow: 0 0 20px yellow;
    animation: sunGlow 2s infinite alternate;
    z-index: -1; /* 確保太陽在其他元素下方，避免遮擋按鍵 */
}

/* 平板設備調整 */
@media (max-width: 768px) {
    .sun {
        left: 5%;
        top: 5%;
        width: 100px;
        height: 100px;
    }
}

/* 手機設備調整 */
@media (max-width: 480px) {
    .sun {
        left: 2%;
        top: 2%;
        width: 80px;
        height: 80px;
    }
}

/* 太陽光芒動畫 */
@keyframes sunGlow {
    0% { box-shadow: 0 0 20px yellow; }
    100% { box-shadow: 0 0 40px yellow; }
}

/* 多雲效果：雲朵 */
.cloud {
    position: absolute;
    background-color: white;
    border-radius: 50%;
    opacity: 0.8;
    animation: cloudMove linear infinite;
}

@keyframes cloudMove {
    0% { transform: translateX(-100vw); }
    100% { transform: translateX(100vw); }
}

/* 下雨效果：雨滴 */
.raindrop {
    position: absolute;
    width: 2px;
    height: 10px;
    background-color: #ADD8E6; /* 淺藍色，更自然 */
    opacity: 0.7; /* 增加透明度 */
    animation: rainFall linear infinite;
}

@keyframes rainFall {
    0% { transform: translateY(-10px); }
    100% { transform: translateY(100vh); }
}

/* 下雪效果：雪花 */
.snowflake {
    position: absolute;
    background-color: #e0f7fa;
    border-radius: 50%;
    opacity: 0.7;
    animation: snowfall linear infinite;
}

@keyframes snowfall {
    0% { top: -10px; transform: translateX(0); }
    50% { transform: translateX(20px); }
    100% { top: 100vh; transform: translateX(0); }
}

/* === 標題樣式 === */
.title-container {
    background: none;
    padding: 0;
    position: relative;
    margin-bottom: 3rem;
    text-align: center;
}

.title-text {
    display: block;
    font-size: 3rem;
    color: #d1f2eb;
    text-shadow: 3px 3px 0 #7f8c8d;
    letter-spacing: 4px;
    animation: titleFloat 3s ease-in-out infinite;
}

/* === 按鈕基礎樣式 === */
button {
    background: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
    margin: 5px;
}

button:hover {
    background: #0056b3;
}

.save-btn { background: #28a745; }
.save-btn:hover { background: #218838; }
.clear-btn { background: #dc3545; }
.clear-btn:hover { background: #c82333; }

/* === 表單輸入框美化 === */
/* === 表單輸入框美化 (已加入 password 支援) === */
select, textarea, input[type="text"], input[type="password"] {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0;
    border: 1px solid #dcdfe6;
    border-radius: 8px;
    box-sizing: border-box;
    background-color: #fcfdfd;
    font-size: 1.3em;
    color: #333;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-family: 'Noto Serif TC', serif; /* 確保字體一致 */
}

select:focus, textarea:focus, input[type="text"]:focus, input[type="password"]:focus {
    outline: none;
    border-color: #4A90E2;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

textarea {
    resize: vertical;
    min-height: 80px; /* 設定最小高度 */
}

/* === 表格樣式 === */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
}

th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
    vertical-align: top;
    word-break: break-word;
}

th {
    background: #f0f0f0;
}

.table-container {
    overflow-x: auto;
    width: 100%;
}

.table-container table {
    width: 100%;
    border-collapse: collapse;
}

.table-container th, .table-container td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
    vertical-align: top;
    word-break: break-word;
}

.table-container th:first-child, .table-container td:first-child { width: 60px; }
.table-container th:nth-child(2), .table-container td:nth-child(2),
.table-container th:nth-child(3), .table-container td:nth-child(3) { min-width: 100px; }
.table-container th:nth-child(4), .table-container td:nth-child(4),
.table-container th:nth-child(5), .table-container td:nth-child(5) { min-width: 150px; }

/* === 動畫 === */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.tool-btn {
    animation: fadeIn 0.2s ease-in-out forwards;
    opacity: 0;
}

/* === 範疇按鍵樣式 === */
.category-buttons-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center; /* 讓按鈕在容器內居中 */
}

.btn-category {
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    background-color: rgba(142, 142, 147, 0.7); /* 半透明灰色 */
    color: white;
    backdrop-filter: blur(5px);
    margin: 0; /* 重置 margin */
}

.btn-category:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    filter: brightness(115%);
}

.btn-category.active {
    filter: brightness(115%);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.7), 0 4px 12px rgba(0,0,0,0.25);
    transform: translateY(-2px);
}

/* Specific active colors */
#readingBtn.active { background-color: #28a745; }
#writingBtn.active { background-color: #007bff; }
#argumentBtn.active { background-color: #800080; }
#expandBtn.active { background-color: #dc3545; }
#booksBtn.active { background-color: #ffc107; }

/* Apply to the expand button as well */
#expandToolsBtn2 {
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    color: white;
    background-color: rgba(54, 187, 167, 0.8);
    backdrop-filter: blur(5px);
display: none; /* 新增這行 */
}

#expandToolsBtn2:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    filter: brightness(110%);
}

/* === 工具列表 === */
#toolsContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    overflow: hidden; /* 隱藏頁面滾動條 */
}

#toolsList {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    max-height: 80vh; /* 設置最大高度 */
    overflow-y: auto; /* 啟用垂直滾動條 */
    position: relative; /* 保持相對定位於容器內 */
}

#toolsList button {
    opacity: 0;
    margin: 10px 0;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#closeToolsBtn {
    position: absolute;
    top: 20px;
    right: 20px;
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
}

#commentResult {
    width: 100%;
    overflow-wrap: break-word;
}

#toggleOverviewBtn {
    background-color: #A9A9A9; /* 灰色背景 */
    color: white; /* 白色文字 */
}

#toggleOverviewBtn:hover {
    background-color: #808080; /* 懸停時深灰色 */
}

#manuscriptPaperBtn {
    background-color: #17a2b8;
}
#manuscriptPaperBtn:hover {
    background-color: #138496;
}

#writingContainer, #readingContainer, #booksContainer, #expandContainer, #argumentContainer {
    display: none;
}
#argumentTopicSelectionArea, #argumentCustomTopicArea, #argumentWritingArea, #argumentGuideArea {
    margin-top: 10px;
}

/* === 音樂播放器樣式優化 === */
#music-player {
    position: fixed;
    bottom: 0px;
    left: 0;
    width: 100%;
    background-color: rgba(40, 40, 40, 0.95); /* 深色半透明背景 */
    backdrop-filter: blur(5px);
    color: white;
    padding: 10px 15px;
    display: none; /* 預設隱藏 */
    align-items: center;
    justify-content: space-between;
    z-index: 1002;
    box-sizing: border-box;
    font-size: 14px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
}

#music-player .controls { 
    display: flex; 
    align-items: center; 
    flex-shrink: 0; 
    gap: 10px;
}

/* 播放按鈕樣式 */
#music-player .controls button#play-pause {
    background: none;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    color: white;
    font-size: 14px;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    margin: 0; /* 重置 margin */
}

#music-player .controls button#play-pause:hover {
    background-color: white;
    color: #333;
    border-color: white;
    transform: scale(1.1);
}

#music-player .controls select { 
    background: #555; 
    color: white; 
    border: none; 
    padding: 6px 10px; 
    border-radius: 4px; 
    max-width: 150px; 
    cursor: pointer;
}

#music-player .progress { 
    flex: 1; 
    margin: 0 15px; 
    display: flex; 
    align-items: center; 
}
#music-player .progress input[type="range"] { 
    width: 100%; 
    cursor: pointer;
}

#music-player .mode { 
    margin-left: 10px; 
    flex-shrink: 0; 
}
#music-player .mode select { 
    background: #555; 
    color: white; 
    border: none; 
    padding: 6px 10px; 
    border-radius: 4px; 
    cursor: pointer;
}

/* 隱藏 (箭頭) 按鈕樣式 */
#music-player .hide-btn { 
    background: none; 
    border: none; 
    color: #aaa; 
    font-size: 18px; 
    cursor: pointer; 
    margin-left: 15px; 
    transition: color 0.3s;
    padding: 5px;
}
#music-player .hide-btn:hover {
    color: white;
    transform: translateY(2px);
}

/* 懸浮顯示按鈕 (替代原本的鋼琴 Emoji) */
#show-player {
    position: fixed;
    bottom: 25px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: rgba(30, 30, 30, 0.9);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    z-index: 1003;
    font-size: 20px;
    display: none; /* JS 會控制顯示 */
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(5px);
    padding: 0;
}

#show-player:hover {
    transform: scale(1.15) rotate(15deg);
    background-color: #007bff; /* 懸停變藍色 */
    border-color: white;
    box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
}

@media (max-width: 600px) {
    #music-player { flex-wrap: wrap; padding: 5px; }
    #music-player .controls select { max-width: 100px; font-size: 12px; }
    #music-player .mode select { font-size: 12px; }
    #progress-bar-music {
        height: 10px;
        -webkit-appearance: none;
        appearance: none;
        background: #ddd;
        border-radius: 5px;
    }
    #progress-bar-music::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
    }
    #progress-bar-music::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
    }
    #music-player .controls select, #music-player .mode select { max-width: 80px; padding: 3px; font-size: 12px; }
    #music-player .controls button, #music-player .hide-btn { padding: 5px; font-size: 16px; }
}

/* --- Styles for Tool 2 (語薈) --- */
:root {
    --bg-color: #f5f5f3;
    --text-color: #333;
    --primary-color: #6a7a7d;
    --secondary-color: #8f8f8f;
    --accent-color: #8c9ea1;
    --line-color: #c5c5c5;
    --shadow-color: rgba(0, 0, 0, 0.05);
    --highlight-bg-writing: rgba(230, 240, 245, 0.6);
    --highlight-bg-reading: rgba(245, 240, 230, 0.6);
    --font-main: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
}

#toolsContainer2 {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-color);
    z-index: 1005;
    overflow-y: auto;
    display: none;
    padding: 2rem 1rem;
    box-sizing: border-box;
    justify-content: center;
}

#closeToolsBtn2 {
    position: fixed;
    top: 15px;
    right: 25px;
    background-color: transparent;
    border: none;
    font-size: 2.5rem;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    z-index: 1006;
    line-height: 1;
    padding: 5px 10px;
}

#closeToolsBtn2:hover { color: #d32f2f; }

.main-container {
    max-width: 1200px;
    width: 100%;
    position: relative;
    opacity: 0;
    transition: opacity 0.5s ease-in;
}

.main-container.loaded { opacity: 1; }

.floating-header {
    position: fixed;
    top: 15px;
    left: 20px;
    background-color: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(8px);
    padding: 5px 15px;
    border-radius: 30px;
    border: 1px solid #e0e0e0;
    z-index: 1000;
    box-shadow: 0 2px 10px var(--shadow-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

#video-tour-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
}

#video-tour-btn .icon {
    width: 24px;
    height: 24px;
    fill: var(--primary-color);
    transition: fill 0.3s;
}

#video-tour-btn:hover .icon { fill: var(--accent-color); }

.floating-header h1 {
    font-size: 1.2rem;
    margin: 0;
    font-weight: 700;
    color: var(--primary-color);
}

.mind-map-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto 1fr auto;
    grid-template-areas:
    "core-ai core-ai"
    "foundations foundations"
    "writing reading"
    "assignments support";
    gap: 50px 20px;
    width: 100%;
    margin-top: 80px;
    padding-bottom: 50px;
    position: relative;
}

.node {
    display: flex;
    align-items: center;
    text-align: center;
    padding: 8px 12px;
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    box-shadow: 0 3px 12px var(--shadow-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
}

.node:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border-color: var(--accent-color);
}

.node a {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 0.95rem;
    gap: 8px;
    width: 100%;
}

.node .icon {
    width: 24px;
    height: 24px;
    margin-right: 0;
    fill: var(--primary-color);
}

#toolsContainer2 .category {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-bottom: 0; /* Reset margin for this context */
}

#writing, #reading {
    padding: 20px;
    border-radius: 12px;
}
#writing { background-color: var(--highlight-bg-writing); }
#reading { background-color: var(--highlight-bg-reading); }

.category-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
    padding-bottom: 5px;
    border-bottom: 2px solid var(--accent-color);
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.category-title .icon {
    width: 24px;
    height: 24px;
    margin-right: 8px;
    fill: var(--primary-color);
}

.sub-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    width: 100%;
}

.sub-group-title {
    font-weight: bold;
    color: var(--secondary-color);
    font-size: 0.9rem;
    position: relative;
    padding-bottom: 5px;
    margin-bottom: 5px;
}
.sub-group-title::after{
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 1px;
    background-color: var(--line-color);
}

.node.level-2 { font-size: 0.9rem; }
.node.level-3 { font-size: 0.85rem; padding: 6px 10px; }
.node.level-3 a { font-weight: 400; flex-direction: row; }

/* Grid Area Assignments */
#core-ai { grid-area: core-ai; }
#foundations {
    grid-area: foundations;
    display: flex;
    flex-direction: row;
    justify-content: center;
    gap: 500px;
    align-items: flex-start;
}
#writing { grid-area: writing; }
#reading { grid-area: reading; }
#assignments { grid-area: assignments; }
#support { grid-area: support; }

.connector-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.connector-svg line {
    stroke: var(--line-color);
    stroke-width: 1.5;
    stroke-dasharray: 4;
    animation: dash 1s linear infinite;
}

@keyframes dash {
    to { stroke-dashoffset: -20; }
}

#yuyilu-toggle { cursor: pointer; }
.yuyilu-grades {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
    max-height: 500px;
    overflow: hidden;
    transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
    opacity: 1;
}
.yuyilu-grades.collapsed {
    max-height: 0;
    opacity: 0;
    pointer-events: none;
}

.foundation-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

@media (max-width: 768px) {
    #toolsContainer2 { padding: 1rem 0.5rem; }
    .floating-header { top: 10px; left: 10px; }

    .mind-map-container {
        margin-top: 70px;
        grid-template-columns: 1fr;
        grid-template-rows: auto;
        grid-template-areas:
        "core-ai"
        "foundations"
        "writing"
        "reading"
        "assignments"
        "support";
        gap: 40px;
    }

    #foundations {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
        width: 90%;
        margin: 0 auto;
        gap: 10px;
    }

    #writing, #reading { padding: 15px; }
}

/* --- Preview Modal Styles --- */
.preview-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    z-index: 2000;
    padding: 1rem;
    box-sizing: border-box;
}

.preview-modal-content {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    width: 90%;
    height: 90%;
    max-width: 1000px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
}

.preview-close-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255, 255, 255, 0.7);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s, color 0.3s;
    z-index: 2010;
}
.preview-close-btn:hover {
    color: #fff;
    background-color: #d32f2f;
}

.preview-modal-body {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
}

#previewIframe {
    width: 100%;
    flex-grow: 1; /* 佔據大部分空間 */
    border: none;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    min-height: 60%; /* 確保預覽畫面有足夠高度 */
}

.preview-modal-footer {
    padding: 16px;
    background-color: #f7f9fa;
    border-top: 1px solid #e0e0e0;
    display: flex;
    align-items: flex-start;
    gap: 16px;
    overflow-y: auto;
    max-height: 40%;
    flex-shrink: 0;
}

.preview-description {
    font-size: 0.95rem;
    color: #333;
    line-height: 1.6;
    text-align: left;
    flex-grow: 1;
}

.preview-goto-btn {
    background: #007bff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='18px' height='18px'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z'/%3E%3C/svg%3E") no-repeat 15px center;
    background-size: 18px 18px;
    color: white;
    padding: 10px 20px 10px 40px;
    border: none;
    border-radius: 20px;
    text-decoration: none;
    font-size: 1rem;
    font-weight: bold;
    transition: background-color 0.3s;
    cursor: pointer;
    flex-shrink: 0; /* 防止按鈕縮小 */
}
.preview-goto-btn:hover {
    background-color: #0056b3;
    color: white;
}

@media (max-width: 600px) {
    .preview-modal-footer {
        flex-direction: column;
        align-items: stretch;
    }
    .preview-goto-btn {
        align-self: flex-end; /* 在堆疊時仍將按鈕靠右 */
    }
}

/* --- Video Modal Styles --- */
.video-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    z-index: 2100;
    cursor: pointer;
}

.video-modal-content {
    position: relative;
    width: 90%;
    max-width: 960px;
    padding-top: 56.25%; /* 16:9 Aspect Ratio */
    height: 0;
    cursor: default;
}

.video-modal-content iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* --- 功能選擇與間距 --- */
.function-selector-wrapper {
    padding: 20px; /* 增加內邊距，讓內部元素有更多呼吸空間 */
    background-color: rgba(59, 184, 219, 0.2);
    border-left: 5px solid #0288d1;
    margin-top: 30px;
    margin-bottom: 35px; /* 明顯增加與下方內容的間距 */
    border-radius: 8px; /* 圓角稍大，視覺上更柔和 */
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.function-selector-wrapper label {
    font-size: 1.1em; /* 標題字體稍大，更突出 */
    font-weight: bold;
    color: #01579b;
    display: block;
    margin-bottom: 15px; /* 增加與下拉選單的間距 */
}
.function-selector-wrapper select {
    font-size: 1em; /* 統一下拉選單字體大小 */
    padding: 8px; /* 適度增加下拉選單的內邊距 */
}

/* 為各個功能容器內的主要區塊（div）增加統一的下間距 */
#writingContentContainer > div,
#expandContentContainer > div,
#argumentContentContainer > div {
    margin-bottom: 30px;
}

/* 清除最後一個元素的下邊距 */
#writingContentContainer > div:last-child,
#expandContentContainer > div:last-child,
#argumentContentContainer > div:last-child {
    margin-bottom: 0;
}

/* 針對閱讀區塊，其內部結構不同，單獨調整其子元素的間距 */
#readingInputArea > *:not(div#readingResult) {
    margin-bottom: 20px;
}

/* --- 改寫說明 UI --- */
.rewrite-explanation-container { margin-top: 20px; }
.rewrite-explanation-card {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.rewrite-explanation-card h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #343a40;
    font-size: 1.2em;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 10px;
}
.explanation-point {
    display: flex;
    align-items: flex-start;
    margin-bottom: 15px;
}
.explanation-point:last-child { margin-bottom: 0; }
.explanation-number {
    flex-shrink: 0;
    width: 28px;
    height: 28px;
     background-color: #6996b8 !important; 
box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
    color: white;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin-right: 15px;
    font-size: 1em;
}
.explanation-text {
    font-size: 1em;
    line-height: 1.6;
    color: #495057;
}

/* --- 點評語氣標籤 --- */
.tone-selector-label {
    display: block; /* 確保標籤獨佔一行 */
    margin-top: 25px; /* 增加與上方元素的距離 */
}

/* --- 題目顯示區塊樣式 --- */
#topicResult, #argumentTopicResult, #expandTopicResult {
    position: relative;
    padding: 12px 15px;
    margin-bottom: 20px;
    border-left: 5px solid #2A9689;
    border-radius: 4px;
    font-size: 1em;
    display: none;
    background-color: transparent !important; /* 強制容器本身透明 */
    z-index: 0;
}

#topicResult::before,
#argumentTopicResult::before,
#expandTopicResult::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(54, 187, 167, 0.5); /* 半透明背景 */
    border-radius: inherit;
    z-index: -1;
}

#topicResult td, #argumentTopicResult td, #expandTopicResult td { background-color: #ffffff !important; }
#topicResult th, #argumentTopicResult th, #expandTopicResult th { background-color: #f0f0f0 !important; }
#topicResult:not(:empty), #argumentTopicResult:not(:empty), #expandTopicResult:not(:empty) { display: block; }

#topicSelectionArea > label,
#argumentTopicSelectionArea > label,
#expandTopicSelectionArea > label {
    display: block;
    margin-bottom: 10px;
}

/* --- 按鍵美化修訂 --- */
.topic-buttons-container {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-top: 10px;
}

.btn {
    padding: 8px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    color: white;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    border: 3px solid transparent;
    background-color: #8E8E93; /* 中性灰 */
}

.btn:not(.active):hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    filter: brightness(110%);
}

.btn-generate.active { background-color: #4A90E2; }
.btn-custom.active { background-color: #7B68EE; }

.btn.active {
    filter: brightness(115%);
    border: 3px solid white;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    transform: translateY(-2px);
}

.btn .fas { font-size: 15px; }

/* --- 剩餘字數計數器 --- */
#charCount {
    margin-top: 0px;
    margin-bottom: 20px;
    text-align: right;
    font-size: 0.9em;
    color: #666;
}

/* --- 禁用按鈕樣式 --- */
button:disabled, .btn:disabled, .btn-icon-confirm:disabled, .btn-action:disabled {
    background-color: #cccccc !important;
    border-color: #cccccc !important;
    color: #666666;
    cursor: not-allowed;
    opacity: 0.6;
    box-shadow: none;
    transform: none;
}

/* --- 儲存/清除圖示按鍵 --- */
.action-buttons-container {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 10px;
    align-items: center;
}

.btn-add-icon { background-color: rgba(0, 123, 255, 0.8); }

.btn-icon-action {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    color: white;
    font-size: 16px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.2s ease-in-out;
    margin: 0;
}

.btn-icon-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    filter: brightness(110%);
}

.btn-icon-action:active { transform: translateY(0); }
.btn-save-icon { background-color: rgba(26, 117, 149, 0.8); }
.btn-clear-icon { background-color: rgba(220, 53, 69, 0.8); }

/* --- 確認圖示按鍵 --- */
.btn-icon-confirm {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-color: #28a745;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease-in-out;
}

.btn-icon-confirm:hover {
    transform: scale(1.1);
    filter: brightness(110%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}

.btn-icon-confirm:active { transform: scale(1.15); }

/* ========================================= */
/* === [修訂 V2] 書籍討論資訊卡片優化 === */
/* ========================================= */
.discussion-info {
    text-align: left;
    background-color: #fdfcf8;
    border: 2px solid #e0ddd7;
    color: #495057;
    padding: 20px;
    border-radius: 12px;
    margin: 10px auto 30px auto;
    
    /* [電腦端修正] 行距由 2.0 減為 1.5，讓視覺更緊湊 */
    line-height: 1.5; 
    
    width: 100%;
    box-sizing: border-box;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    font-family: 'Noto Serif TC', serif;
}

/* 表格佈局 */
.discussion-info table {
    width: 100%;
    border-collapse: collapse;
    /* 移除 table-layout: fixed，讓欄位寬度根據內容自然調整，避免浪費空間 */
    table-layout: auto; 
}

.discussion-info td {
    border: none;
    
    /* [電腦端修正] 上下內距由 10px 減半為 5px */
    padding: 5px 8px; 
    
    vertical-align: top; /* 保持靠上對齊 */
    word-wrap: break-word;
    overflow-wrap: break-word;
    font-size: 1.1rem;
}

/* 標籤欄位 (左側：書名、作者...) */
.discussion-info td:first-child {
    width: 60px; /* 稍微縮窄標籤欄寬度 */
    font-weight: bold;
    color: #2A9689;
    white-space: nowrap;
    
    /* [電腦端保持] 讓「書名」二字左右對齊，比較美觀 */
    text-align: justify;
    text-align-last: justify; 
}

/* ========================================= */
/* === [手機版專用修復] === */
/* ========================================= */
@media (max-width: 600px) {
    .discussion-info {
        padding: 15px; /* 手機版內距縮小 */
    }

    .discussion-info table, 
    .discussion-info tbody, 
    .discussion-info tr, 
    .discussion-info td {
        display: block; /* 強制變成垂直排列 */
        width: 100% !important;
        box-sizing: border-box;
    }

    /* 1. 修復手機標籤文字被拉寬的問題 */
    .discussion-info td:first-child {
        text-align: left !important;      /* [關鍵修正] 強制靠左，取消左右對齊 */
        text-align-last: auto !important; /* [關鍵修正] 重置末行對齊 */
        
        color: #007bff; /* 藍色標籤 */
        font-size: 0.95rem;
        
        /* 讓標籤和內容靠得更近 */
        padding-bottom: 2px; 
        padding-top: 10px;
        margin-bottom: 0;
        border-bottom: none; /* 移除分隔線，讓視覺更連貫 */
    }

    /* 2. 內容部分 (書名本體) */
    .discussion-info td:last-child {
        padding-top: 0;
        padding-bottom: 10px; /* 每個欄位之間的距離 */
        padding-left: 0;
        border-bottom: 1px dashed #eee; /* 在內容下方加分隔線 */
    }

    /* 最後一個欄位不需要底線 */
    .discussion-info tr:last-child td:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
}

/* ========================================= */
/* === [修訂] 聊天氣泡排版優化 === */
/* ========================================= */

/* 聊天歷史容器 */
#chatHistory, #writingChatHistory, #argumentChatHistory, #writingGuideChatHistory {
    background-color: #f4f6f9; /* 更柔和的背景色 */
    border: 1px solid #e1e4e8;
    border-radius: 15px;
    padding: 25px 20px; /* 增加內部空間 */
    margin-top: 15px;
    margin-bottom: 15px;
    max-height: 500px; /* 增加高度 */
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px; /* 關鍵：氣泡之間的間距 */
}

/* 單個氣泡 */
.message-bubble {
    padding: 18px 22px; /* 增加氣泡內白，文字不貼邊 */
    border-radius: 18px;
    line-height: 1.8; /* 關鍵：增加行距，文字不再緊湊 */
    font-size: 1.05rem; /* 字體微調大 */
    word-wrap: break-word;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    max-width: 88%; /* 稍微放寬最大寬度 */
    animation: fadeIn 0.3s ease-in-out;
    position: relative;
}

/* AI 氣泡 (左側) */
.message-bubble.ai-message {
    background-color: #ffffff;
    color: #333;
    align-self: flex-start;
    border-top-left-radius: 4px;
    border: 1px solid #e0e0e0;
}

/* 用戶氣泡 (右側) */
.message-bubble.user-message {
    background-color: #2A9689; /* 主題綠 */
    color: white;
    align-self: flex-end;
    border-top-right-radius: 4px;
    box-shadow: 0 4px 10px rgba(42, 150, 137, 0.2);
}

/* 手機版氣泡微調 */
@media (max-width: 600px) {
    .message-bubble {
        padding: 15px;
        font-size: 1rem;
        max-width: 92%; /* 手機上氣泡可以更寬一點 */
    }
}

#chatInputContainer, #writingChatInputContainer, #argumentChatInputContainer, #writingGuideChatInputContainer {
    display: none;
    align-items: center;
    gap: 10px;
    margin-top: 15px;
}

#chatInputContainer textarea, #writingChatInputContainer textarea, #argumentChatInputContainer textarea, #writingGuideChatInputContainer textarea {
    flex-grow: 1;
    margin: 0;
}

#initialDiscussionForm { display: block; }

.books-modal {
    display: none;
    position: fixed;
    z-index: 1010;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
}

.books-modal .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 25px;
    border: 1px solid #888;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    animation: fadeIn 0.4s;
}

.books-modal .close-modal-btn {
    color: #aaa;
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}
.books-modal .close-modal-btn:hover { color: black; }
#discussionControlButtons { margin-bottom: 20px; }
#booksButtons { display: none; }

/* --- 執行動作按鈕 --- */
.btn-action {
    display: inline-block;
    padding: 10px 20px;
    margin: 15px 0 5px 0;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    font-family: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    color: white;
    background-color: rgba(31, 122, 85, 0.8);
    backdrop-filter: blur(5px);
    text-align: center;
    text-decoration: none;
}

.btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    filter: brightness(110%);
}

/* --- 懸浮視窗編輯器 --- */
textarea:not(.no-modal-editor), input[type="text"]:not(.no-modal-editor) {
    cursor: pointer;
    background-color: #f0f8ff;
    transition: background-color 0.2s;
}

textarea:not(.no-modal-editor):hover, input[type="text"]:not(.no-modal-editor):hover {
    background-color: #e6f2ff;
}

.outline-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.65);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    box-sizing: border-box;
}

/* === 懸浮視窗容器設定 (修訂版：限制高度防止爆版) === */
.outline-modal-content {
    background-color: #fdfdfd;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 900px;       /* 稍微加寬，讓電腦版視野更好 */
    max-height: 90vh;       /* 關鍵：限制高度最多佔螢幕 90% */
    position: relative;
    animation: fadeIn 0.3s;
    display: flex;          /* 使用 Flexbox 排版 */
    flex-direction: column; /* 垂直排列子元素 */
    box-sizing: border-box; /* 確保 padding 不會撐大寬度 */
}

.outline-modal-content h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #2A9689;
    font-size: 1.2em;
    font-weight: 700;
    border-bottom: 2px dashed #a8dad5;
    padding-bottom: 12px;
    text-align: center;
    letter-spacing: 2px;
    flex-shrink: 0;         /* 防止標題被壓縮 */
}

/* === 懸浮視窗輸入框設定 (修訂版：自動填滿空間) === */
#modal-textarea {
    width: 100%;
    box-sizing: border-box !important;
    
    /* 字體與原稿紙設定 (保持不變) */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 20px !important;       
    line-height: 40px !important;     
    color: #2c3e50;                   
    letter-spacing: 2px;              
    background-color: #fffcf6;        
    background-image: 
        linear-gradient(transparent 39px, rgba(42, 150, 137, 0.3) 39px, rgba(42, 150, 137, 0.3) 40px, transparent 40px),
        linear-gradient(90deg, transparent 39px, rgba(0,0,0,0.03) 39px, rgba(0,0,0,0.03) 40px, transparent 40px);
    background-size: 40px 40px;       
    background-attachment: local;     
    border: 2px solid #8baea8;        
    border-radius: 8px;               
    padding: 0 18px !important;       
    box-shadow: inset 0 0 40px rgba(0,0,0,0.02);

    /* === 關鍵修訂：高度控制 === */
    flex-grow: 1;           /* 自動填滿視窗剩餘高度 */
    height: auto;           /* 讓 flex 控制高度 */
    min-height: 200px;      /* 設定最小高度 */
    resize: none;           /* 禁止手動拉伸，避免破壞佈局 */
    overflow-y: auto;       /* 內容過多時，只有輸入框內部會滾動 */
    margin-bottom: 10px;
}

/* 手機版適配 (保持不變，但需確保優先級) */
@media (max-width: 600px) {
    #modal-textarea {
        font-size: 16px !important;
        line-height: 32px !important;
        background-image: 
            linear-gradient(transparent 31px, rgba(42, 150, 137, 0.3) 31px, rgba(42, 150, 137, 0.3) 32px, transparent 32px),
            linear-gradient(90deg, transparent 31px, rgba(0,0,0,0.03) 31px, rgba(0,0,0,0.03) 32px, transparent 32px);
        background-size: 32px 32px !important;
        padding: 0 10px !important;
    }
}

.outline-modal-content .modal-buttons { 
    text-align: right; 
    margin-top: 5px; 
    flex-shrink: 0;         /* 防止按鈕被壓縮 */
}

.outline-modal-content .modal-buttons { text-align: right; margin-top: 15px; }
.outline-modal-content .preview-close-btn { position: absolute; top: 10px; right: 10px; }

#structure, #writingTone, #writingReviewer, #readingTone, #booksTone, #expandTone, #argumentOutlineTone, #argumentWritingTone, #argumentReviewer {
    font-size: 1.05em;
    padding: 6px 10px;
}

#booksContainer #initialDiscussionForm input[type="text"],
#booksContainer #initialDiscussionForm textarea {
    font-size: 1rem !important;
    padding: 10px 12px;
}

/* --- 答題步驟卡片 --- */
.steps-container {
    margin-top: 20px;
    padding-left: 15px;
    border-left: 4px solid #4A90E2;
}

.step-card {
    background-color: #f7f9fc;
    border-radius: 8px;
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.step-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

.step-card:last-child { margin-bottom: 0; }
.step-title {
    font-weight: bold;
    font-size: 1.1em;
    color: #0056b3;
    margin-bottom: 10px;
}
.step-content {
    font-size: 1em;
    line-height: 1.7;
    color: #333;
}

#customTopicArea input[type="text"], #customTopicArea textarea, #argumentCustomTopicArea input[type="text"], #expandCustomTopicInputArea input[type="text"], #expandCustomTopicInputArea textarea, #expandGuideArea input[type="text"], #expandGuideArea textarea {
    font-size: 1rem !important;
    padding: 10px 12px;
}

/* --- 評等系統 --- */
.grading-container {
    margin-top: 25px;
    border-top: 2px dashed #aeb6bf;
    padding-top: 20px;
    max-width: 100%;
    overflow-x: hidden;
}

.grading-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    align-items: flex-start;
}

.grading-scores, .grading-radar {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    max-width: 100%;
    box-sizing: border-box;
    width: 90%;
    margin: 0 auto;
}

.grading-scores h3, .grading-radar h3 {
    margin-top: 0;
    color: #343a40;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.score-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    gap: 10px;
}

.score-item label {
    font-weight: bold;
    color: #495057;
    flex-shrink: 0;
    margin-right: 10px;
}

.score-item .slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    max-width: 160px;
}

.score-item .progress-bar-container {
    width: 120px;
    height: 12px;
    background-color: #e9ecef;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid #ced4da;
}

.score-item .progress-bar-fill {
    height: 100%;
    width: 0%;
    background-color: #007bff;
    border-radius: 6px;
    transition: width 0.4s ease-in-out;
}

.score-item .score-display {
    font-weight: bold;
    width: 25px;
    text-align: center;
    color: #0056b3;
}

.total-score-container {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    flex-wrap: wrap;
}

#finalGrade, [id$="FinalGrade"] {
    font-size: 2.5em;
    font-weight: bold;
    color: #d9534f;
    line-height: 1;
}

#totalScoreDisplay, [id$="TotalScoreDisplay"] {
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
}

.radar-chart-container {
    position: relative;
    aspect-ratio: 4 / 3;
    max-height: 350px;
    width: 100%;
}

@media (max-width: 768px) {
    .grading-grid {
        grid-template-columns: 1fr;
        width: 95%;
        margin: 0 auto;
        justify-items: center;
    }
    .grading-scores, .grading-radar {
        padding: 15px;
        width: 95%;
        max-width: 95%;
    }
    .radar-chart-container {
        aspect-ratio: 1 / 1;
        max-height: 400px;
    }
    .score-item { flex-wrap: wrap; }
    .score-item label { width: 100%; margin-bottom: 5px; }
    .score-item .slider-container { max-width: 100%; }
}

/* --- 儲存HTML按鈕 --- */
.result-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.btn-save-html {
    position: static;
    margin-top: 20px;
    width: 40px;
    height: 40px;
    background-color: rgba(106, 122, 138, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    color: white;
    display: none;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 10;
    opacity: 0.85;
    transition: all 0.2s ease-in-out;
    padding: 0;
    margin-left: auto;
    margin-right: auto;
}

.btn-save-html:hover {
    opacity: 1;
    transform: scale(1.1);
    background-color: rgba(90, 105, 120, 0.9);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.btn-save-html svg { width: 20px; height: 20px; }
#booksButtons #save-books-html-btn { background-color: rgba(74, 144, 226, 0.8); }

#writingReviewResultContainer, #argumentReviewResultContainer {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
}

/* --- 點評範疇 UI --- */
.scope-selector-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 10px;
    padding: 15px;
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.08);
}

.scope-label input[type="checkbox"] { display: none; }

.scope-label {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    user-select: none;
    border: 1px solid transparent;
    background-color: #f0f0f0;
    color: #555;
}

.scope-label:not(.disabled):hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-color: #007bff;
}

.scope-label.active {
    background-color: #007bff;
    color: white;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
}

.scope-label.disabled {
    background-color: #e9ecef;
    color: #adb5bd;
    cursor: not-allowed;
    opacity: 0.7;
}

.scope-label.all-scope.active {
    background-color: #4F5B93;
    color: white;
    box-shadow: 0 2px 5px rgba(79, 91, 147, 0.3);
}

/* --- 解題指引輸入框 --- */
#writingGuideTopicInput {
    padding: 15px;
    border: 2px solid #4A90E2;
    border-radius: 8px;
    width: 100%;
    margin-bottom: 15px;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    background-color: #fcfdfd;
}
#writingGuideTopicInput:focus {
    border-color: #28a745;
    box-shadow: 0 0 10px rgba(40, 167, 69, 0.2);
    outline: none;
}

/* 2. 標題區塊 */
.guide-section-header {
    padding: 10px 15px;
    margin-bottom: 15px;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 0 8px 8px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.guide-section-header h3 {
    margin: 0;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 3. 介紹卡片 (Intro) */
.guide-intro-card {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    margin-bottom: 25px;
    line-height: 1.8;
    color: #444;
    font-size: 1.05rem;
    border: 1px solid #eee;
}

/* === 動漫風格角色選擇卡片 === */
.category-cards-wrapper {
    width: 100%;
    display: flex;
    justify-content: center;
    perspective: 1000px;
    padding: 10px 0 30px 0;
}

.category-cards-container {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding: 10px 20px;
    scrollbar-width: none;
    -ms-overflow-style: none;
    justify-content: center;
}

.category-cards-container::-webkit-scrollbar { display: none; }

.anime-card {
    position: relative;
    width: 120px;
    height: 180px;
    border-radius: 15px;
    background-image: var(--bg-img);
    background-size: cover;
    background-position: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
    flex-shrink: 0;
    border: 1px solid rgba(255,255,255,0.2);
    filter: grayscale(30%);
}

.card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.2) 60%, rgba(0,0,0,0) 100%);
    transition: all 0.3s ease;
}

.card-border-effect {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 15px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    z-index: 5;
    box-sizing: border-box;
}

.card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    padding-bottom: 20px;
    z-index: 10;
}

.card-icon-container {
    font-size: 28px;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: auto;
    margin-top: 40px;
    transform: translateY(10px);
    transition: all 0.4s ease;
    opacity: 0.8;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

.card-text {
    text-align: center;
    transform: translateY(0);
    transition: transform 0.3s ease;
}

.card-zh {
    display: block;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    letter-spacing: 1px;
white-space: nowrap !important; /* 核心指令：強制文字不換行 */
    width: 100%;                    /* 確保文字容器寬度足夠 */
    text-align: center;             /* 確保文字水平置中 */
    display: block;                 /* 確保它是區塊元素 */
}

.card-en {
    display: block;
    font-size: 10px;
    font-weight: 700;
    color: rgba(255,255,255,0.6);
    letter-spacing: 2px;
    margin-top: 4px;
    text-transform: uppercase;
    font-family: 'Arial', sans-serif;
white-space: nowrap !important; /* 核心指令：強制文字不換行 */
}

.anime-card:hover {
    transform: translateY(-15px) scale(1.05);
    filter: grayscale(0%);
    box-shadow: 0 15px 30px rgba(0,0,0,0.5), 0 0 20px rgba(0, 191, 255, 0.6);
    z-index: 20;
}

.anime-card:hover .card-border-effect { border-color: rgba(255, 255, 255, 0.9); }
.anime-card:hover .card-overlay { background: linear-gradient(to top, rgba(0,86,179,0.8) 0%, rgba(0,0,0,0) 100%); }
.anime-card:hover .card-icon-container {
    transform: translateY(-5px) scale(1.2);
    color: #fff;
    text-shadow: 0 0 10px #00bfff;
}

.anime-card.active {
    /* --- 核心修正 --- */
    /* 將原本的 -8px 改為 -15px (與 hover 狀態一致) */
    /* 將原本的 1.02 改為 1.05 (與 hover 狀態一致) */
    transform: translateY(-15px) scale(1.05) !important;
    
    /* --- 以下完全保留您原本的樣式，不作任何更動 --- */
    filter: grayscale(0%);
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.4);
    z-index: 15;
}

.anime-card.active .card-border-effect {
    border: 3px solid #FFD700;
    box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.5);
}

.anime-card.active .card-overlay { background: linear-gradient(to top, rgba(184, 134, 11, 0.8) 0%, rgba(0,0,0,0.1) 100%); }
.anime-card.active .card-zh { color: #fff; text-shadow: 0 0 10px #FFD700; }
.anime-card.active .card-en { color: #FFD700; }
.anime-card.active .card-icon-container { color: #FFD700; transform: translateY(-5px) scale(1.1); }

@media (max-width: 600px) {
    .category-cards-container {
        justify-content: flex-start;
        padding-bottom: 20px;
    }
    .anime-card { width: 100px; height: 150px; }
    .card-zh { font-size: 16px; }
    .card-en { font-size: 8px; }
    .card-icon-container { font-size: 24px; margin-top: 30px; }
}

/* ========================================= */
/* === 卡片排版終極修復 (Fix Layout V2) === */
/* ========================================= */

/* 1. 外層網格：確保每張卡片寬度被限制 */
.guide-grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 強制三欄均分 */
    gap: 25px;            /* 卡片之間的間距 */
    width: 100%;
    box-sizing: border-box; /* 確保 padding 不會撐爆寬度 */
}

/* 2. 卡片本體：垂直排列 (標題在上，內容在下) */
.guide-card {
    display: flex !important;
    flex-direction: column !important;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    height: 100%;         /* 讓卡片撐滿網格高度 */
    overflow: hidden;     /* 關鍵：防止內容溢出圓角 */
    position: relative;
    box-sizing: border-box; /* 關鍵：讓寬度包含邊框與內距 */
}

/* 3. 標題區域：藍色部分 */
.card-title, .seed-header {
    flex-shrink: 0;       /* 禁止標題被壓縮 */
    width: 100%;
    padding: 15px;
    font-size: 1.2rem;
    font-weight: bold;
    text-align: center;
    box-sizing: border-box; /* 防止標題文字撐爆 */
}

/* 4. 內容區域：白色文字部分 (修復重點) */
.card-content, .seed-body {
    flex-grow: 1;         /* 填滿剩餘高度 */
    padding: 20px;        /* 內邊距 */
    
    /* === 文字排版核心修復 === */
    font-size: 1rem;
    line-height: 1.8;     /* 增加行高，讓文字不擠 */
    color: #444;
    text-align: justify;  /* 左右對齊，讓方塊更整齊 */
    
    /* 強制換行設定 */
    white-space: normal !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    word-break: break-word; /* 針對中英文混排優化 */
    
    width: 100%;          /* 確保不超過卡片寬度 */
    box-sizing: border-box; /* 關鍵：讓 padding 包含在寬度內 */
}

/* 5. 手機版適配：變成單欄 */
@media (max-width: 768px) {
    .guide-grid-3 {
        grid-template-columns: 1fr !important; /* 手機強制一欄 */
    }
    .guide-card {
        margin-bottom: 20px;
        height: auto !important; /* 手機版高度自動 */
    }
}

/* 5. 針對不同類型的卡片配色 */
/* 藍色卡片 (心情/題眼) */
.emotion-card {
    border-top: 5px solid #4A90E2;
}
.emotion-card .card-title {
    background-color: #f0f7ff;
    color: #0056b3;
}

/* 綠色卡片 (種子/寫作方向) */
.seed-card {
    border-top: 5px solid #28a745;
}
.seed-card .seed-header {
    background-color: #f0fff4;
    color: #155724;
}

/* 6. 種子卡片內的段落標題 */
.seed-body p {
    margin-bottom: 12px;
}
.seed-body p:last-child {
    margin-bottom: 0;
}
.seed-body strong {
    color: #155724 !important; /* 改為深綠色 */
    display: inline-block;
    margin-bottom: 5px;
    font-size: 1.05rem;
    border-bottom: 2px solid rgba(40, 167, 69, 0.4) !important; /* 改為淺綠色底線 */
}

/* 7. 手機版適配：強制單欄 */
@media (max-width: 768px) {
    .guide-grid-3 {
        grid-template-columns: 1fr !important; /* 強制變為單欄 */
        gap: 30px; /* 增加手機版卡片間距 */
        margin-bottom: 30px;
    }
    
    .guide-card {
        height: auto !important; /* 手機版高度完全自動 */
        margin-bottom: 0; 
    }
}

/* 8. 下載按鈕容器防重疊修正 */
.result-wrapper {
    margin-top: 40px; /* 確保按鈕與上方內容有足夠距離 */
    padding-top: 20px;
    border-top: 1px dashed #ddd; /* 增加分隔線，視覺上區隔 */
    width: 100%;
    clear: both; /* 清除浮動 */
}

#sideMenuToggle {
    position: fixed;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    z-index: 9998;
    width: 20px;
    height: 60px;
    border-radius: 8px 0 0 8px;
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    border: none;
    border-right: none;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

#sideMenuToggle:hover {
    background-color: rgba(0, 0, 0, 0.8);
    width: 24px;
}

.side-menu-overlay {
    position: fixed;
    top: 50%;
    right: -80px;
    transform: translateY(-50%);
    width: 60px;
    height: auto;
    background-color: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(10px);
    z-index: 9999;
    transition: right 0.3s ease;
    box-shadow: -4px 0 15px rgba(0, 0, 0, 0.5);
    border-radius: 12px 0 0 12px;
    padding: 10px 0;
}

.side-menu-overlay.active {
    right: 0;
}

.side-menu-content {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 0;
}

.side-menu-close {
    display: none; /* 移除獨立關閉鍵 */
}

.side-menu-items {
    margin-top: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 5px;
}

.side-menu-item {
    width: 100%;
    padding: 12px 0;
    background-color: transparent;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.side-menu-item span {
    display: none; /* 隱藏文字 */
}

.side-menu-item:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.side-menu-item i {
    font-size: 24px;
    width: 100%;
    text-align: center;
}

/* 讓卡扣本身也能關閉選單 */
#sideMenuToggle.active {
    background-color: rgba(255, 100, 100, 0.8);
}



/* === 永遠隱藏主頁的「工具一覽」container（但保留代碼）=== */
#mainMenuBox ~ #toolsBox,
#toolsBox {
    display: none !important;
}

/* === 手機版：每行 2 張卡片，最後一張放大到兩張卡片寬 === */
@media (max-width: 600px) {
    .category-cards-wrapper {
        padding: 20px 0 50px 0;
    }

    .category-cards-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        justify-items: center;
        padding: 10px 20px;
        overflow: hidden;
    }

    /* 正常卡片大小（前四張） */
    .anime-card {
        width: 120px !important;
        height: 180px !important;
        flex-shrink: 0;
    }

    /* 第 5 張卡片：放大到兩張卡片的總寬度並居中 */
    .category-cards-container .anime-card:nth-child(5) {
        grid-column: 1 / -1;
        width: calc(120px * 2 + 24px) !important;  /* 兩張寬 + gap */
        height: 130px !important;
        max-width: none;
    }

    /* 第 5 張卡片內文字圖標微調（可選，視覺更突出） */
    .category-cards-container .anime-card:nth-child(5) .card-zh {
        font-size: 22px;
    }
    .category-cards-container .anime-card:nth-child(5) .card-en {
        font-size: 13px;
    }
    .category-cards-container .anime-card:nth-child(5) .card-icon-container {
        font-size: 34px;
        margin-top: 45px;
    }

    .card-zh {
        font-size: 18px;
    }
    .card-icon-container {
        font-size: 28px;
        margin-top: 40px;
    }
}

/* === 煙花特效畫布 === */
#fireworksCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999; /* 確保在最上層 */
    pointer-events: none; /* 讓滑鼠點擊可以穿透煙花，不影響按鈕操作 */
    display: none; /* 預設隱藏 */
}

/* ========================================= */
/* === 神思專用：文藝風原稿紙 UI 設計 (RWD 終極版) === */
/* ========================================= */

/* --- 1. 電腦版預設樣式 (大格、大字) --- */
/* --- 1. 電腦版預設樣式 (大格、大字) --- */
/* 將原本長串的 ID 選擇器改成單純的 textarea，這樣所有多行輸入框都會生效 */
/* --- 1. 電腦版預設樣式 (大格、大字) --- */
/* 加入 input[type="text"] 讓單行輸入框（如書名、作者）也生效 */
textarea, input[type="text"] {
    /* 防止爆版核心設定 */
    box-sizing: border-box !important;
    width: 100% !important;
    max-width: 100% !important;
    
    /* 字體與行高 (配合 40px 格子) */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 20px !important;       
    line-height: 40px !important;     
    color: #2c3e50;                   
    letter-spacing: 2px;              
    
    /* 原稿紙背景 (40px 高) */
    background-color: #fffcf6 !important;        
    background-image: 
        linear-gradient(transparent 39px, rgba(42, 150, 137, 0.3) 39px, rgba(42, 150, 137, 0.3) 40px, transparent 40px),
        linear-gradient(90deg, transparent 39px, rgba(0,0,0,0.03) 39px, rgba(0,0,0,0.03) 40px, transparent 40px) !important;
    background-size: 40px 40px !important;       
    background-attachment: local;     
    
    /* 邊框與陰影 */
    border: 2px solid #8baea8 !important;        
    border-radius: 8px !important;               
    padding: 0 18px !important;       
    box-shadow: 
        inset 0 0 40px rgba(0,0,0,0.02),  
        5px 5px 0px rgba(42, 150, 137, 0.15); 
        
    transition: all 0.3s ease;
    resize: vertical;                 
}

/* 互動效果 - 點擊時加深陰影 */
textarea:focus, input[type="text"]:focus {
    background-color: #fff !important;           
    border-color: #2A9689 !important;            
    outline: none;
    box-shadow: 
        inset 0 0 10px rgba(42, 150, 137, 0.1), 
        8px 8px 0px rgba(42, 150, 137, 0.25); 
    transform: translateY(-2px);      
}

/* Placeholder 樣式 */
textarea::placeholder, input[type="text"]::placeholder {
    color: rgba(42, 150, 137, 0.4);   
    font-style: italic;               
    font-size: 16px;
    letter-spacing: 1px;
}

/* --- 2. 手機版響應式調整 (螢幕寬度小於 600px) --- */
/* --- 2. 手機版響應式調整 (螢幕寬度小於 600px) --- */
@media (max-width: 600px) {
    /* 同樣加入 input[type="text"] */
    textarea, input[type="text"] {
        /* 字體縮小，適配窄螢幕 */
        font-size: 16px !important;
        letter-spacing: 1px !important;
        
        /* 行高縮小至 32px (更緊湊) */
        line-height: 32px !important;
        
        /* 重新繪製背景格線 (配合 32px 高度) */
        background-image: 
            /* 31px 透明 + 1px 線條 = 32px */
            linear-gradient(transparent 31px, rgba(42, 150, 137, 0.3) 31px, rgba(42, 150, 137, 0.3) 32px, transparent 32px),
            linear-gradient(90deg, transparent 31px, rgba(0,0,0,0.03) 31px, rgba(0,0,0,0.03) 32px, transparent 32px) !important;
        background-size: 32px 32px !important;
        
        /* 減少內邊距，爭取書寫空間 */
        padding: 0 10px !important;
        
        /* 縮小陰影 */
        box-shadow: 
            inset 0 0 20px rgba(0,0,0,0.02),  
            3px 3px 0px rgba(42, 150, 137, 0.15) !important;
    }
    
    /* 手機版聚焦效果微調 */
    textarea:focus, input[type="text"]:focus {
        box-shadow: 
            inset 0 0 10px rgba(42, 150, 137, 0.1), 
            4px 4px 0px rgba(42, 150, 137, 0.25) !important;
        transform: translateY(-1px); 
    }
}
/* 懸浮視窗標題美化 (通用) */
.outline-modal-content h3 {
    color: #2A9689;
    font-family: 'Noto Serif TC', serif;
    border-bottom: 2px dashed #a8dad5;
    padding-bottom: 12px;
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 2px;
}

	/* ========================================= */
/* === 灰藍色原稿紙風格：下拉選單專用樣式 === */
/* ========================================= */

select {
    /* 1. 基礎字體與排版 */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 18px !important;
    font-weight: bold !important;
    line-height: 40px !important; /* 配合格線高度 */
    color: #455A64 !important;    /* 深灰藍文字 (Blue Grey 700) */
    letter-spacing: 1px;
    padding: 0 40px 0 15px !important; /* 右邊預留箭頭空間 */
    height: 44px !important;      /* 固定高度確保格線對齊 */
    width: 100%;
    margin: 10px 0;
    box-sizing: border-box;

    /* 2. 背景設定 - 灰藍色原稿紙 */
    background-color: #ECEFF1 !important; /* 淺灰藍底色 (Blue Grey 50) */
    
    /* 繪製底線：透明 -> 灰藍線條 -> 透明 + 自定義箭頭 */
    background-image:
        /* 格線：38px透明 + 2px 線條 = 40px */
        linear-gradient(transparent 38px, rgba(120, 144, 156, 0.4) 38px, rgba(120, 144, 156, 0.4) 40px, transparent 40px),
        /* 下拉箭頭圖示 (深灰藍色) */
        url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23455A64%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E") !important;
    
    background-repeat: no-repeat, no-repeat;
    background-position: center, right 15px center; /* 格線置中，箭頭靠右 */
    background-size: 40px 40px, 12px 12px;          /* 格線大小，箭頭大小 */
    background-attachment: local, scroll;           /* 讓背景隨內容滾動(雖然select很少滾動) */

    /* 3. 邊框與外觀 */
    border: 2px solid #90A4AE !important; /* 中灰藍邊框 (Blue Grey 300) */
    border-radius: 8px !important;
    
    /* 增加一點紙張厚度感 */
    box-shadow: 
        inset 0 0 20px rgba(255,255,255,0.5), /* 內部微光 */
        3px 3px 0px rgba(144, 164, 174, 0.3) !important; /* 右下角陰影 */
        
    /* 移除瀏覽器預設外觀 */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* 互動效果：滑鼠懸停或點擊時 */
select:focus, select:hover {
    background-color: #FFFFFF !important; /* 變亮 */
    border-color: #607D8B !important;     /* 邊框變深 (Blue Grey 500) */
    outline: none;
    transform: translateY(-2px);          /* 輕微浮起 */
    box-shadow: 
        inset 0 0 10px rgba(84, 110, 122, 0.1),
        5px 5px 0px rgba(84, 110, 122, 0.3) !important;
}

/* 針對音樂播放器內的小選單進行微調 (避免變得太大) */
#music-player .controls select, 
#music-player .mode select {
    height: 30px !important;
    line-height: 26px !important;
    font-size: 14px !important;
    padding: 0 25px 0 10px !important;
    background-size: 30px 30px, 10px 10px !important; /* 縮小格線和箭頭 */
    background-image:
        linear-gradient(transparent 28px, rgba(120, 144, 156, 0.4) 28px, rgba(120, 144, 156, 0.4) 30px, transparent 30px),
        url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23455A64%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E") !important;
}

/* 手機版響應式調整 */
@media (max-width: 600px) {
    select {
        font-size: 16px !important;
        height: 36px !important;
        line-height: 32px !important; /* 手機版格線高度縮小 */
        background-position: center, right 10px center;
        
        /* 重新繪製 32px 高度的格線 */
        background-image:
            linear-gradient(transparent 30px, rgba(120, 144, 156, 0.4) 30px, rgba(120, 144, 156, 0.4) 32px, transparent 32px),
            url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23455A64%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E") !important;
        background-size: 32px 32px, 10px 10px !important;
        
        box-shadow: 
            inset 0 0 10px rgba(255,255,255,0.5),
            2px 2px 0px rgba(144, 164, 174, 0.3) !important;
    }
}

/* ==========================================
   === 文藝風歷史紀錄卡片 (莫蘭迪色系) ===
   ========================================== */

/* 定義莫蘭迪色變數 */
:root {
    --morandi-bg: #fdfcf8;          /* 米白紙張底色 */
    --morandi-text: #5e5e5e;        /* 深灰文字 */
    --morandi-green: #8fa398;       /* 閱讀 - 灰綠 */
    --morandi-blue: #94a7b5;        /* 敘事 - 霧霾藍 */
    --morandi-purple: #b6a6ca;      /* 議論 - 香芋紫 */
    --morandi-red: #d69a92;         /* 拓展 - 豆沙紅 */
    --morandi-border: #e0ddd7;      /* 淺卡其邊框 */
    --morandi-shadow: rgba(149, 157, 165, 0.1);
}

/* 列表容器調整 */
.history-list-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* 改為網格排列 */
    gap: 20px;
    padding: 10px;
    max-height: 70vh;
    overflow-y: auto;
}

/* ==========================================
   === 歷史紀錄卡片：Note Card 打洞風格 ===
   ========================================== */

.history-card {
    /* 1. 基礎卡片設定 */
    background-color: var(--morandi-bg);
    border: 1px solid var(--morandi-border); /* 統一使用細邊框 */
    border-radius: 8px; 
    padding: 20px;
    position: relative;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.03);
    transition: all 0.3s ease;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;

    /* 2. Note Card 關鍵樣式：打洞與分隔線 */
    padding-left: 55px !important; /* 左側留白給打洞區 */
    
    background-image: 
        /* A. 垂直分隔線 (模擬紅線或灰線，這裡用莫蘭迪灰 #e0ddd7) */
        linear-gradient(to right, transparent 39px, #e0ddd7 40px, transparent 41px),
        /* B. 打洞效果 (模擬孔洞，使用深灰色圓形 #d1cdc5) */
        radial-gradient(circle at 20px 50%, #d1cdc5 6px, transparent 7px);
    
    /* 設定背景圖層大小 */
    background-size: 
        100% 100%, /* 分隔線：撐滿整張卡片 */
        100% 35px; /* 打洞：每 35px 重複一顆 */
    
    /* 設定背景重複方式 */
    background-repeat: 
        no-repeat, /* 分隔線不重複 */
        repeat-y;  /* 打洞在垂直方向重複 */
        
    /* 設定起始位置 */
    background-position: 
        0 0,       /* 分隔線位置 */
        0 12px;    /* 打洞起始位置向下微調，避免切到頂部色條 */
}

/* 3. 頂部裝飾條 (保留您要求的頂部色條) */
.history-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px; /* 頂部色條高度 */
    background-color: #ccc; /* 預設顏色，會被下方 Theme 覆蓋 */
    opacity: 0.8;
    z-index: 1;
}

/* 4. 懸停效果 */
.history-card:hover {
    transform: translateY(-3px);
    box-shadow: 6px 6px 0px rgba(0,0,0,0.05);
    border-color: #d1cdc5;
    /* 確保 Hover 時不會出現左側粗色條，保持打洞風格 */
    border-left-width: 1px;
    border-left-style: solid;
}

/* 5. 顏色主題設定 (只改變頂部色條與標籤顏色) */

/* Theme 1 (灰綠) */
.history-card.history-theme-1::before { background-color: var(--m-color-1); }
.history-card.history-theme-1 .history-tag { background-color: var(--m-color-1); }
.history-card.history-theme-1:hover { border-left-color: var(--morandi-border); }

/* Theme 2 (霧霾藍) */
.history-card.history-theme-2::before { background-color: var(--m-color-2); }
.history-card.history-theme-2 .history-tag { background-color: var(--m-color-2); }
.history-card.history-theme-2:hover { border-left-color: var(--morandi-border); }

/* Theme 3 (香芋紫) */
.history-card.history-theme-3::before { background-color: var(--m-color-3); }
.history-card.history-theme-3 .history-tag { background-color: var(--m-color-3); }
.history-card.history-theme-3:hover { border-left-color: var(--morandi-border); }

/* Theme 4 (豆沙紅) */
.history-card.history-theme-4::before { background-color: var(--m-color-4); }
.history-card.history-theme-4 .history-tag { background-color: var(--m-color-4); }
.history-card.history-theme-4:hover { border-left-color: var(--morandi-border); }

/* Theme 5 (奶茶棕) */
.history-card.history-theme-5::before { background-color: var(--m-color-5); }
.history-card.history-theme-5 .history-tag { background-color: var(--m-color-5); }
.history-card.history-theme-5:hover { border-left-color: var(--morandi-border); }
/* 不同範疇的顏色標記 */
.history-card.type-reading { border-left-color: #28a745; }   /* 閱讀-綠 */
.history-card.type-narrative { border-left-color: #007bff; } /* 敘事-藍 */
.history-card.type-argument { border-left-color: #800080; }  /* 議論-紫 */
.history-card.type-expand { border-left-color: #dc3545; }    /* 拓展-紅 */



.history-meta {
    font-size: 0.85em;
    color: #888;
    margin-bottom: 5px;
}

.history-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    background-color: #eee;
    color: #555;
    font-size: 0.8em;
    margin-right: 8px;
    font-weight: bold;
}

.history-title {
    font-size: 1.1em;
    font-weight: bold;
    color: #333;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* 操作區 (刪除按鈕) */
.history-actions {
    margin-top: 15px;
    display: flex;
    justify-content: flex-end;
    opacity: 0.6;
    transition: opacity 0.3s;
}

.history-card:hover .history-actions {
    opacity: 1;
}


.btn-delete-history {
    background-color: transparent;
    border: 1px solid #dc3545;
    color: #dc3545;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-delete-history:hover {
    background-color: #dc3545;
    color: white;
}

/* 3. 模態視窗內容美化 */
#historyModalContent {
    line-height: 1.6;
    font-size: 1.1em;
}

#historyModalContent h3 {
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
    margin-top: 20px;
    color: #0056b3;
}

/* 4. 新增：層級選單 (Grid Menu) 樣式 (Level 1 & 2) */
.history-grid-menu {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); /* 自動適應寬度 */
    gap: 15px;
    padding: 10px 0;
}

.history-folder-btn {
    background-color: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #555;
    min-height: 100px; /* 確保按鈕有足夠高度 */
}

.history-folder-btn:hover {
    background-color: #fff;
    border-color: #007bff;
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.15);
    color: #007bff;
}

.history-folder-btn i {
    font-size: 2em;
    margin-bottom: 10px;
    color: #6c757d;
    transition: color 0.3s ease;
}

.history-folder-btn:hover i {
    color: #007bff;
}

.history-folder-btn span {
    font-weight: bold;
    font-size: 1.1em;
}

/* 5. 新增：麵包屑導航樣式 */
.history-breadcrumb span:hover {
    text-decoration: underline;
}

/* 6. 新增：雷達圖圖片化樣式 (確保 Canvas 轉圖後在歷史紀錄中正確顯示) */
.radar-chart-history-img {
    width: 100% !important;
    max-width: 500px;
    height: auto !important;
    margin: 0 auto;
    display: block;
    border: 1px solid #eee; /* 選用：增加邊框讓圖表更清晰 */
    border-radius: 8px;
    padding: 10px;
    background-color: #fff;
}

	/* 確保歷史紀錄內的卡片容器不會有過多的上下留白 */
#historyContainer .category-cards-wrapper {
    margin-top: 0;
    margin-bottom: 0;
}

/* 讓麵包屑導航更明顯 */
.history-breadcrumb {
    transition: all 0.3s ease;
}
.history-breadcrumb span:hover {
    opacity: 0.8;
}

/* === 新增：標頭的低調清空按鈕 === */
.history-clear-btn {
    background: transparent;
    border: 1px solid transparent; /* 預設無邊框 */
    color: #aaa; /* 淺灰色，非常低調 */
    font-size: 1.2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.history-clear-btn:hover {
    color: #d9534f; /* 懸停時才變紅 */
    background-color: rgba(217, 83, 79, 0.1); /* 淡淡的紅色背景 */
    transform: rotate(15deg); /* 增加一點點互動趣味 */
}


/* 內容佈局 */
.history-info {
    flex-grow: 1;
}

/* 標題樣式：襯線字體，文藝感 */
.history-title {
    font-family: 'Noto Serif TC', serif;
    font-size: 1.15em;
    font-weight: 600;
    color: #4a4a4a;
    margin: 10px 0;
    line-height: 1.5;
    
    /* 多行省略 */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* 日期與標籤區域 */
.history-meta {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 10px;
    border-bottom: 1px dashed var(--morandi-border); /* 虛線分隔 */
}

.history-date {
    font-family: 'Courier New', monospace; /* 打字機字體 */
    font-size: 0.85em;
    color: #999;
    letter-spacing: 1px;
}

/* 範疇標籤 (像貼紙) */
.history-tag {
    font-size: 0.75em;
    padding: 2px 8px;
    border-radius: 4px;
    margin-right: auto; /* 將日期推到右邊 */
    color: #fff;
    font-weight: normal;
    letter-spacing: 1px;
}



	
/* 刪除按鈕美化 */
.btn-delete-history {
    background: transparent;
    border: none;
    color: #bfaea8; /* 淺紅棕色 */
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    padding: 5px;
    border-radius: 50%;
}

.btn-delete-history:hover {
    color: #d69a92;
    background-color: rgba(214, 154, 146, 0.1);
    transform: scale(1.1);
}

/* ==========================================
   === 歷史紀錄樣式修訂 (多色卡片 & 導航美化) ===
   ========================================== */

/* 1. 定義 5 種莫蘭迪輪替色 (用於同一列表中的不同卡片) */
/* 讓同一個列表中的卡片擁有不同顏色，以作區分 */
.history-card.accent-1::before { background-color: #8fa398; } /* 灰綠 */
.history-card.accent-1 .history-tag { background-color: #8fa398; }
.history-card.accent-1:hover { border-color: #8fa398; }

.history-card.accent-2::before { background-color: #94a7b5; } /* 霧霾藍 */
.history-card.accent-2 .history-tag { background-color: #94a7b5; }
.history-card.accent-2:hover { border-color: #94a7b5; }

.history-card.accent-3::before { background-color: #b6a6ca; } /* 香芋紫 */
.history-card.accent-3 .history-tag { background-color: #b6a6ca; }
.history-card.accent-3:hover { border-color: #b6a6ca; }

.history-card.accent-4::before { background-color: #d69a92; } /* 豆沙紅 */
.history-card.accent-4 .history-tag { background-color: #d69a92; }
.history-card.accent-4:hover { border-color: #d69a92; }

.history-card.accent-5::before { background-color: #c7b299; } /* 奶茶棕 */
.history-card.accent-5 .history-tag { background-color: #c7b299; }
.history-card.accent-5:hover { border-color: #c7b299; }

/* 2. 麵包屑導航 (顏色區分修訂) */
.history-breadcrumb {
    background-color: transparent !important;
    border: none !important;
    border-bottom: 1px dashed #d1cdc5 !important;
    padding: 10px 5px !important;
    margin-bottom: 25px;
    font-size: 1rem;
    color: #999; /* 分隔符顏色 */
    display: flex;
    align-items: center;
    gap: 8px;
}

/* 第一層：主範疇 (藍色，可點擊) */
.history-breadcrumb span[onclick*="renderHistoryCategories"] {
    color: #007bff !important; 
    font-weight: 900;
    cursor: pointer;
}

/* 第二層：子功能分類 (深灰色，可點擊) */
.history-breadcrumb span[onclick*="enterHistoryCategory"] {
    color: #555 !important; 
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}
.history-breadcrumb span[onclick*="enterHistoryCategory"]:hover {
    color: #007bff !important;
    text-decoration: underline;
}

/* 第三層：當前頁面 (霧霾藍，不可點擊) */
.history-breadcrumb span#breadcrumb-sub {
    color: #94a7b5 !important; 
    font-weight: bold;
    padding: 2px 4px;
    background-color: rgba(148, 167, 181, 0.1);
    border-radius: 4px;
}

/* 分隔符號 */
.history-breadcrumb span[id^="breadcrumb-sep"] {
    color: #ccc !important;
    font-weight: normal;
}

/* 3. 卡片細節微調 (確保日期與標籤排版) */
.history-meta {
    border-bottom: 1px dashed #e0ddd7;
    padding-bottom: 8px;
    margin-bottom: 10px;
    display: flex; /* 確保左右對齊 */
    justify-content: space-between; /* 標籤靠左，日期靠右 */
    align-items: center;
}

.history-date {
    font-family: 'Courier New', monospace;
    font-size: 0.85em;
    color: #aaa;
    letter-spacing: 0px;
    margin-left: auto; /* 強制靠右 */
}

.history-tag {
    color: white;
    font-size: 0.75em;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: normal;
    letter-spacing: 1px;
}

/* 手機版適配 */
@media (max-width: 600px) {
    .history-list-container {
        grid-template-columns: 1fr; /* 手機單欄 */
    }
}

	/* 搜尋到的卡片高亮動畫 */
@keyframes highlight-card {
    0% { transform: scale(1); box-shadow: 0 0 0 rgba(40, 167, 69, 0); }
    50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(40, 167, 69, 0.5); border-left-color: #28a745; }
    100% { transform: scale(1); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
}

.history-card.highlighted {
    animation: highlight-card 1.5s ease-in-out;
    background-color: #f0fff4; /* 淡淡的綠色背景 */
}

	/* === 定義莫蘭迪色系變數 === */
:root {
    --m-color-1: #8fa398; /* 灰綠 */
    --m-color-2: #94a7b5; /* 霧霾藍 */
    --m-color-3: #b6a6ca; /* 香芋紫 */
    --m-color-4: #d69a92; /* 豆沙紅 */
    --m-color-5: #c7b299; /* 奶茶棕 */
}

/* === 修改：歷史紀錄導航列 (麵包屑) === */
/* 需求三：主範疇要莫迪蘭色，不要藍色 */
.history-breadcrumb span[onclick*="renderHistoryCategories"] {
    color: #6a7a7d !important; /* 莫蘭迪深灰藍 */
    font-weight: 900;
    cursor: pointer;
    transition: color 0.3s;
}
.history-breadcrumb span[onclick*="renderHistoryCategories"]:hover {
    color: #8c9ea1 !important;
}

/* === 修改：子功能按鈕 (Level 2) 的顏色邏輯 === */
/* 需求一：子功能卡片要不同顏色 */
.history-folder-btn.history-theme-1 { border-color: var(--m-color-1); color: var(--m-color-1); }
.history-folder-btn.history-theme-1 i { color: var(--m-color-1); }
.history-folder-btn.history-theme-1:hover { background-color: var(--m-color-1); color: white; }
.history-folder-btn.history-theme-1:hover i { color: white; }

.history-folder-btn.history-theme-2 { border-color: var(--m-color-2); color: var(--m-color-2); }
.history-folder-btn.history-theme-2 i { color: var(--m-color-2); }
.history-folder-btn.history-theme-2:hover { background-color: var(--m-color-2); color: white; }
.history-folder-btn.history-theme-2:hover i { color: white; }

.history-folder-btn.history-theme-3 { border-color: var(--m-color-3); color: var(--m-color-3); }
.history-folder-btn.history-theme-3 i { color: var(--m-color-3); }
.history-folder-btn.history-theme-3:hover { background-color: var(--m-color-3); color: white; }
.history-folder-btn.history-theme-3:hover i { color: white; }

.history-folder-btn.history-theme-4 { border-color: var(--m-color-4); color: var(--m-color-4); }
.history-folder-btn.history-theme-4 i { color: var(--m-color-4); }
.history-folder-btn.history-theme-4:hover { background-color: var(--m-color-4); color: white; }
.history-folder-btn.history-theme-4:hover i { color: white; }

.history-folder-btn.history-theme-5 { border-color: var(--m-color-5); color: var(--m-color-5); }
.history-folder-btn.history-theme-5 i { color: var(--m-color-5); }
.history-folder-btn.history-theme-5:hover { background-color: var(--m-color-5); color: white; }
.history-folder-btn.history-theme-5:hover i { color: white; }

/* === 修改：紀錄卡片 (Level 3) 的顏色邏輯 === */
/* 需求：卡片左側不要有色條，保留頂部色條(::before)與標籤顏色 */

/* 確保所有主題卡片的左邊框回歸預設樣式 (無粗色條) */
.history-card {
    border-left: 1px solid var(--morandi-border) !important;
}

/* Theme 1 (灰綠) */
.history-card.history-theme-1::before { background-color: var(--m-color-1); }
.history-card.history-theme-1 .history-tag { background-color: var(--m-color-1); }
/* 確保 hover 時也不會出現左側色條，只加深陰影 */
.history-card.history-theme-1:hover { border-left-color: var(--morandi-border); }

/* Theme 2 (霧霾藍) */
.history-card.history-theme-2::before { background-color: var(--m-color-2); }
.history-card.history-theme-2 .history-tag { background-color: var(--m-color-2); }
.history-card.history-theme-2:hover { border-left-color: var(--morandi-border); }

/* Theme 3 (香芋紫) */
.history-card.history-theme-3::before { background-color: var(--m-color-3); }
.history-card.history-theme-3 .history-tag { background-color: var(--m-color-3); }
.history-card.history-theme-3:hover { border-left-color: var(--morandi-border); }

/* Theme 4 (豆沙紅) */
.history-card.history-theme-4::before { background-color: var(--m-color-4); }
.history-card.history-theme-4 .history-tag { background-color: var(--m-color-4); }
.history-card.history-theme-4:hover { border-left-color: var(--morandi-border); }

/* Theme 5 (奶茶棕) */
.history-card.history-theme-5::before { background-color: var(--m-color-5); }
.history-card.history-theme-5 .history-tag { background-color: var(--m-color-5); }
.history-card.history-theme-5:hover { border-left-color: var(--morandi-border); }

/* === 歷史紀錄：輸入內容優化樣式 === */
.history-input-card {
    background-color: #fdfdfd;
    border: 1px solid #e0e0e0;
    border-left: 5px solid #6a7a7d; /* 莫蘭迪深灰藍裝飾線 */
    border-radius: 6px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.history-input-header {
    margin-top: 0;
    margin-bottom: 15px;
    color: #4a4a4a;
    font-size: 1.1em;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px dashed #ddd;
    padding-bottom: 10px;
}

.history-input-body {
    font-family: 'Noto Serif TC', serif; /* 保持文藝字體 */
    font-size: 1rem;
    line-height: 1.8; /* 增加行高，避免文字擠在一起 */
    color: #333;
    white-space: pre-wrap; /* 保留換行 */
    word-wrap: break-word;
}

/* 自動將「標籤」加粗的樣式 (配合 JS 使用) */
.history-label-bold {
    font-weight: 700;
    color: #2c3e50;
    background-color: rgba(0,0,0,0.03);
    padding: 2px 6px;
    border-radius: 4px;
    margin-right: 5px;
}

	/* === 歷史紀錄：結構化顯示優化 === */
.history-parsed-container {
    display: flex;
    flex-direction: column;
    gap: 15px; /* 區塊間距 */
}

.history-item-block {
    background-color: transparent;
}

.history-item-label {
    display: block;
    font-size: 0.95em;
    font-weight: bold;
    color: #2A9689; /* 使用你的主題綠色 */
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* 標題前的小裝飾 */
.history-item-label::before {
    content: '';
    display: block;
    width: 4px;
    height: 14px;
    background-color: #2A9689;
    border-radius: 2px;
}

.history-item-content {
    background-color: #f7f9fa; /* 淺灰背景，區分內容 */
    border: 1px solid #e1e4e8;
    border-radius: 8px;
    padding: 12px 15px;
    font-size: 1rem;
    line-height: 1.8;
    color: #333;
    font-family: 'Noto Serif TC', serif;
    white-space: pre-wrap; /* 關鍵：保留詩詞的換行 */
    word-break: break-word;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); /* 內陰影增加層次感 */
}

	/* === 歷史紀錄：結構化顯示優化 (莫蘭迪色系版) === */

/* 定義顏色對應類別 */
.history-theme-context-1 { --current-theme-color: var(--m-color-1); } /* 灰綠 */
.history-theme-context-2 { --current-theme-color: var(--m-color-2); } /* 霧霾藍 */
.history-theme-context-3 { --current-theme-color: var(--m-color-3); } /* 香芋紫 */
.history-theme-context-4 { --current-theme-color: var(--m-color-4); } /* 豆沙紅 */
.history-theme-context-5 { --current-theme-color: var(--m-color-5); } /* 奶茶棕 */

/* 預設顏色 (防呆) */
.history-parsed-container {
    --current-theme-color: #6a7a7d; 
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.history-item-block {
    background-color: transparent;
}

/* 標題樣式：使用動態變數 */
.history-item-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1em;
    font-weight: bold;
    color: var(--current-theme-color); /* 跟隨主題色 */
    margin-bottom: 8px;
    padding-left: 2px;
}

/* 標題前的裝飾小圓點 */
.history-item-label::before {
    content: '';
    display: block;
    width: 8px;
    height: 8px;
    background-color: var(--current-theme-color); /* 跟隨主題色 */
    border-radius: 50%;
    opacity: 0.8;
}

/* 內容區塊樣式 */
.history-item-content {
    background-color: #fcfcfc;
    border: 1px solid #e1e4e8;
    /* 左側加上粗邊框，顏色跟隨主題，增強識別度 */
    border-left: 4px solid var(--current-theme-color); 
    border-radius: 4px; /* 稍微方一點，更有文件感 */
    padding: 12px 16px;
    font-size: 1rem;
    line-height: 1.8;
    color: #444;
    font-family: 'Noto Serif TC', serif;
    white-space: pre-wrap;
    word-break: break-word;
}

	/* === 歷史紀錄：標題原地編輯樣式 === */
.history-title {
    cursor: text; /* 提示用戶這是文字 */
    transition: background-color 0.2s;
    border-radius: 4px;
    padding: 2px 4px;
    margin: -2px -4px; /* 抵消 padding，保持位置不變 */
}

.history-title:hover {
    background-color: rgba(0, 0, 0, 0.05); /* 懸停時給一點提示 */
}

/* 編輯模式下的輸入框樣式 */
.history-title-input {
    font-family: 'Noto Serif TC', serif; /* 保持原有字體 */
    font-size: 1em; /* 保持原有大小 */
    font-weight: bold;
    color: #333;
    width: 100%;
    border: 1px solid #2A9689; /* 編輯時顯示綠色邊框 */
    border-radius: 4px;
    padding: 2px 4px;
    background-color: #fff;
    outline: none;
    box-shadow: 0 0 5px rgba(42, 150, 137, 0.3);
    margin: 0;
}

	/* === 新增：通用過渡動畫 === */
.fade-in-up {
    /* 使用 cubic-bezier 讓動畫更有質感，不是線性的死板移動 */
    animation: fadeUpEnter 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    opacity: 0; /* 預設隱藏，由動畫控制變為可見 */
}

@keyframes fadeUpEnter {
    0% {
        opacity: 0;
        transform: translateY(15px) scale(0.98); /* 稍微縮小並向下偏移 */
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1); /* 回復原狀 */
    }
}

	/* === 新增：頁面收縮退場動畫 === */
.page-exit-shrink {
    /* 0.4秒完成，使用 ease-in 讓開始慢結束快，感覺像被吸走 */
    animation: shrinkFadeOut 0.4s cubic-bezier(0.32, 0, 0.67, 0) forwards;
    transform-origin: center 20vh; /* 設定縮放中心點在視窗上方偏中，視覺更自然 */
    pointer-events: none; /* 動畫播放時禁止點擊，防止誤觸 */
}

@keyframes shrinkFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.92) translateY(20px); /* 縮小並稍微往下沉 */
    }
}

/* === 新增：主頁選單進場特效 (配合退場) === */
.home-enter-pop {
    animation: popIn 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    opacity: 0;
}

@keyframes popIn {
    0% {
        opacity: 0;
        transform: scale(1.05); /* 主頁從稍微放大的狀態回復，產生景深感 */
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

	/* 針對音樂播放器內的小選單進行微調 (改為簡約純淨風格) */
#music-player .controls select, 
#music-player .mode select {
    height: 30px !important;
    line-height: 26px !important;
    font-size: 14px !important;
    padding: 0 30px 0 10px !important; /* 右側留空間給箭頭 */
    
    /* === 樣式重置：去除原稿紙背景 === */
    background-color: rgba(255, 255, 255, 0.1) !important; /* 低調的半透明背景 */
    color: #fff !important; /* 白色文字 */
    border: 1px solid rgba(255, 255, 255, 0.2) !important; /* 極細的半透明邊框 */
    border-radius: 20px !important; /* 圓潤的膠囊狀 */
    box-shadow: none !important; /* 去除原本的紙張厚度陰影 */
    
    /* === 僅保留白色箭頭 === */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 8px center !important;
    background-size: 14px 14px !important;
    
    transition: all 0.3s ease;
}

/* 互動效果：滑鼠懸停時 */
#music-player .controls select:hover, 
#music-player .mode select:hover {
    background-color: rgba(255, 255, 255, 0.2) !important; /* 稍微變亮 */
    border-color: rgba(255, 255, 255, 0.5) !important;
    transform: translateY(0) !important; /* 取消原有的浮起效果，保持穩定 */
}

/* 確保下拉後的選項是深色底 (避免在某些瀏覽器變白底黑字) */
#music-player select option {
    background-color: #333;
    color: white;
    padding: 5px;
}

/* === 學生雲端中心：全新課業列表樣式 === */

/* =======================================================
   === 雲端中心：Note Card 打洞風格 (莫蘭迪色系 V3) ===
   ======================================================= */

/* 1. 基礎卡片構造 (Note Card) */
.task-card {
    /* 基礎紙張設定 */
    background-color: #fdfcf8;      /* 米白紙張底色 */
    border: 1px solid #e0ddd7;      /* 淺卡其細邊框 */
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    padding: 20px 15px 20px 55px;   /* 左側留白給打洞區 */
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.03); /* 復古硬陰影 */

    /* 關鍵：打洞與分隔線背景 */
    background-image: 
        /* A. 垂直分隔線 */
        linear-gradient(to right, transparent 39px, #e0ddd7 40px, transparent 41px),
        /* B. 打洞效果 (模擬孔洞) */
        radial-gradient(circle at 20px 50%, #d1cdc5 6px, transparent 7px);
    
    background-size: 
        100% 100%, /* 分隔線撐滿 */
        100% 35px; /* 打洞重複間距 */
    
    background-repeat: 
        no-repeat,
        repeat-y;
        
    background-position: 
        0 0,
        0 12px;
}

/* 2. 頂部顏色條 (用來區分狀態) */
.task-card::before {
    content: '';
    position: absolute;
	background-color: var(--theme-color) !important;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px; /* 頂部色條高度 */
    z-index: 1;
}



/* 3. 懸停效果 */
.task-card:hover {
    transform: translateY(-3px);
    box-shadow: 6px 6px 0px rgba(0,0,0,0.05);
    background-color: #fff; /* 稍微變亮 */
}

/* 4. 左側文字區塊優化 */
.task-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex-grow: 1;
    padding-right: 15px;
    z-index: 2; /* 確保在背景之上 */
}

.task-topic {
    font-family: 'Noto Serif TC', serif; /* 文藝字體 */
    font-weight: bold;
    font-size: 1.1rem;
    color: #4a4a4a;
}

.task-meta {
    font-family: 'Courier New', monospace; /* 打字機字體日期 */
    font-size: 0.85rem;
    color: #999;
    display: flex;
    align-items: center;
    gap: 10px;
}

.task-type-tag {
    font-family: sans-serif;
    font-size: 0.75rem;
    padding: 2px 8px;
    border-radius: 4px;
    background: #eee;
    color: #666;
    font-weight: normal;
    letter-spacing: 1px;
}

/* 5. 右側狀態膠囊 (Pill) 優化 */
.task-status {
    flex-shrink: 0;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
    z-index: 2;
}

/* =========================================
   === 狀態配色定義 (莫蘭迪色系) ===
   ========================================= */

/* A. 未繳交 (豆沙紅) */
.status-pending::before {
    background-color: #d69a92; /* 頂部色條 */
}
.status-pending .task-status {
    background-color: #f7ebea; /* 淺豆沙底 */
    color: #a67069;            /* 深豆沙字 */
}
.status-pending .task-topic {
    color: #a67069;            /* 題目變色以示提醒 */
}

/* B. 待批改 (灰綠) */
.status-submitted::before {
    background-color: #8fa398; /* 頂部色條 */
}
.status-submitted .task-status {
    background-color: #e8edea; /* 淺灰綠底 */
    color: #5e7067;            /* 深灰綠字 */
}
.status-submitted .task-topic {
    color: #888;               /* 題目變灰 */
}

/* C. 已發還 (香芋紫) */
.status-returned::before {
    background-color: #b6a6ca; /* 頂部色條 */
}
.status-returned .task-status {
    background-color: #f0ebf5; /* 淺紫底 */
    color: #7e6f8f;            /* 深紫字 */
}
.status-returned .task-topic {
    color: #333;               /* 題目深灰 */
}

/* === 三種狀態的配色 === */


/* === 老師評語專用樣式 (嵌入在歷史紀錄 UI 中) === */
.teacher-feedback-section {
    background-color: #fffaf5; /* 極淡的米暖色背景 */
    border: 2px solid #e6dace; /* 淺卡其/奶茶色邊框 */
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    position: relative;
    box-shadow: 0 4px 15px rgba(141, 110, 99, 0.08); /* 暖色系微陰影 */
    animation: slideDown 0.5s ease-out;
}

.teacher-feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px dashed #d7ccc8; /* 淺褐色虛線 */
    padding-bottom: 10px;
    margin-bottom: 15px;
}

/* 標題文字顏色 */
.teacher-feedback-title {
    font-weight: bold; 
    font-size: 1.2rem; 
    color: #8d6e63; /* 莫蘭迪深褐色文字 */
    display: flex;
    align-items: center;
    gap: 8px;
}

.teacher-score-badge {
    background-color: #d9534f; /* 保留紅色分數牌，突顯重點 */
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    padding: 5px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transform: rotate(-2deg);
}

.teacher-comment-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #4e342e; /* 深咖啡色文字 */
    white-space: pre-wrap;
    word-break: break-word;
    margin: 0;
    padding: 0;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.teacher-feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px dashed #ffb74d;
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.teacher-score-badge {
    background-color: #d9534f;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    padding: 5px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transform: rotate(-2deg); /* 蓋章效果 */
}

.teacher-comment-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #5d4037;
    white-space: pre-wrap; /* 保留老師評語的換行 */
}



	/* === 新增：評語詳情彈窗樣式 === */
.feedback-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    z-index: 10000; /* 確保在最上層 */
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    backdrop-filter: blur(5px);
}

.feedback-modal-content {
    background-color: #fff;
    width: 100%;
    max-width: 700px;
    max-height: 90vh;
    border-radius: 12px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    animation: fadeIn 0.3s ease-out;
}

.feedback-header {
    padding: 15px 20px;
    background-color: #f8f9fa;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.feedback-header h3 {
    margin: 0;
    color: #2A9689;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.feedback-close-btn {
    background: #e9ecef; /* 明顯的按鈕背景 */
    border: none;
    color: #555;
    font-size: 1.5rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.feedback-close-btn:hover {
    background-color: #d9534f;
    color: white;
    transform: rotate(90deg);
}

.feedback-body {
    padding: 20px;
    overflow-y: auto;
    flex-grow: 1;
}

/* 老師評語區塊 */
.teacher-comment-box {
    background-color: #fff8e1;
    border: 1px solid #ffe0b2;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    line-height: 1.6;
    color: #5d4037;
    position: relative;
}

.teacher-comment-box::before {
    content: '老師回饋';
    position: absolute;
    top: -10px;
    left: 15px;
    background: #ff9800;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
}

/* 學生原稿區塊 */
.original-work-box {
    background-color: #fdfdfd;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin-top: 10px;
}

.original-work-summary {
    padding: 12px 15px;
    cursor: pointer;
    font-weight: bold;
    color: #555;
    background-color: #f1f1f1;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.2s;
}

.original-work-summary:hover {
    background-color: #e2e6ea;
}

.original-work-content {
    padding: 15px;
    white-space: pre-wrap;
    font-family: 'Noto Serif TC', serif;
    color: #333;
    line-height: 1.8;
    border-top: 1px solid #eee;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

	/* ============================================
   === 學生雲端中心：全螢幕模式 (App 風格) ===
   ============================================ */

/* 1. 強制讓內容容器填滿整個視窗 */
#studentCloudModal .modal-content {
    width: 100% !important;
    height: 100% !important;
    max-width: none !important;  /* 移除原本的寬度限制 */
    max-height: none !important; /* 移除高度限制 */
    margin: 0 !important;        /* 移除置中邊距 */
    border-radius: 0 !important; /* 移除圓角，更像原生頁面 */
    border: none !important;     /* 移除邊框 */
    display: flex;               /* 使用 Flexbox 佈局 */
    flex-direction: column;      /* 垂直排列內容 */
    box-sizing: border-box;
    padding: 20px;               /* 保持內距 */
}

/* 2. 調整關閉按鈕的位置，讓它更大、更顯眼 */
#studentCloudModal .close-modal-btn {
    top: 15px;
    right: 20px;
    font-size: 36px; /* 加大按鈕 */
    z-index: 10;
}

/* 3. 調整登入後的面板，讓它佔滿剩餘空間 */
/* === 修正：學生雲端面板 (第 2054 行附近) === */
#studentCloudPanel {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    margin-top: 10px !important;
    /* 原本是 overflow: hidden; 這導致了無法滾動，必須改為 visible */
    overflow: visible !important; 
    height: auto !important; /* 確保高度自動撐開 */
}

/* 4. 關鍵優化：讓課業列表自動延伸，並在內部滾動 */
/* 原本設定了 max-height: 250px，全螢幕模式下這會太短，所以要移除限制 */
#studentCloudModal #assignmentList {
    max-height: none !important;  /* 移除任何高度限制 */
    height: auto !important;      /* 高度隨內容自動變長 */
    overflow-y: visible !important; /* 內部不需要滾動條，直接撐開 */
    flex-grow: 0 !important;      /* 不要自動填滿，避免計算錯誤 */
    padding-bottom: 120px !important; /* ★關鍵：增加大量底部留白，防止手機版被底部導航列或邊緣遮擋 */
    border: none !important;
}

/* 5. 針對手機版的微調 */
@media (max-width: 600px) {
    #studentCloudModal .modal-content {
        padding: 15px;
    }
}

	/* === 區塊分隔線 (老師回饋 vs 學生作業) === */
.feedback-separator {
    position: relative;
    height: 1px;
    margin: 40px 0; /* 上下大幅留白，區隔兩者 */
    border: none;
    border-top: 2px dashed #d7ccc8; /* 淺褐色虛線 */
    text-align: center;
    overflow: visible;
}

.feedback-separator::after {
    content: '▼ 提交內容'; /* 中央提示文字 */
    position: absolute;
    top: -12px; /* 垂直置中 */
    left: 50%;
    transform: translateX(-50%);
    background-color: #fff; /* 白底蓋住虛線 */
    padding: 0 15px;
    color: #a1887f; /* 莫蘭迪淺褐文字 */
    font-size: 0.85rem;
    font-weight: bold;
    letter-spacing: 1px;
}

	/* =======================================================
   === 學生雲端中心：全螢幕鎖定樣式 (App 風格修正版) ===
   ======================================================= */

/* 1. 外層容器：變成全螢幕視窗，負責處理滾動 */
#studentCloudModal {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
    background-color: #fdfcf8 !important; /* 設定背景色，避免透明 */
    z-index: 10050 !important; /* 確保在最上層 */
    padding: 0 !important;
    
    /* 關鍵：讓容器自己產生滾動條，而不是內容 */
    overflow-y: auto !important; 
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch; /* 讓 iOS 滾動更順滑 */
    
    /* 佈局重置：移除置中，改為自然流動 */
    display: none; /* 預設隱藏，由 JS 控制 */
    align-items: flex-start !important;
    justify-content: flex-start !important;
}

/* 2. 內容區域：撐滿寬度，移除圓角 */
#studentCloudModal .modal-content {
    width: 100% !important;
    max-width: 100% !important;
    min-height: 100% !important; /* 確保高度至少填滿螢幕 */
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background-color: transparent !important; /* 背景由外層決定 */
    padding: 20px 20px 80px 20px !important; /* 底部留白，方便手機操作 */
    box-sizing: border-box;
    
    /* 確保內部元素排列 */
    display: flex;
    flex-direction: column;
}

/* 3. 調整關閉按鈕位置 (固定在右上角，不會隨頁面滾動消失) */
#studentCloudModal .close-modal-btn {
    position: fixed !important; /* 固定定位 */
    top: 20px;
    right: 20px;
    background-color: rgba(255, 255, 255, 0.8);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 10060;
}

	/* ==========================================
   === 確保側邊選單在全螢幕模式下依然可見 ===
   ========================================== */

/* 1. 提高漢堡按鈕的層級 (原為 9998，全螢幕視窗為 10050) */
#sideMenuToggle {
    z-index: 20000 !important; 
}

/* 2. 提高選單展開後的層級 */
.side-menu-overlay {
    z-index: 20001 !important;
}

/* 3. 確保返回主頁按鈕的層級也足夠高 (以防萬一) */
#homeBtn, #sideMenuHomeBtn {
    z-index: 20000 !important;
}

	/* === 修訂：評語視窗層級提升 (解決被課業狀態遮擋的問題) === */
#historyModal, 
.preview-modal-overlay,
.feedback-modal-overlay {
    z-index: 20000 !important; /* 確保高於 studentCloudModal 的 10050 */
}

/* === 修訂：學生雲端中心 全屏設計與排版優化 (仿照語薈風格) === */
#studentCloudModal {
    background-color: #f5f5f3 !important; /* 語薈的米色背景 */
    padding: 0 !important;
}

#studentCloudModal .modal-content {
    background-color: transparent !important;
    width: 100% !important;
    max-width: 800px !important; /* 限制最大寬度，避免電腦版太寬 */
    margin: 0 auto !important;
    height: 100% !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    padding: 80px 20px 20px 20px !important; /* 關鍵：頂部留 80px 空間給關閉鍵，防止重疊 */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* 內容從上方開始 */
}

/* 關閉按鈕樣式優化 (與語薈一致) */
#studentCloudModal .close-modal-btn {
    position: fixed !important;
    top: 25px !important;
    right: 25px !important;
    background-color: transparent !important;
    border: none !important;
    color: #333 !important;
    font-size: 2.5rem !important;
    width: auto !important;
    height: auto !important;
    line-height: 1 !important;
    z-index: 10060 !important;
    box-shadow: none !important;
    cursor: pointer;
    transition: color 0.3s;
}

#studentCloudModal .close-modal-btn:hover {
    color: #d32f2f !important;
    background-color: transparent !important;
}

	/* === 修復：繳交課業選擇視窗 (層級與響應式優化) === */
#submitAssignmentModal {
    z-index: 25000 !important; /* 確保高於歷史紀錄 (20000) 和其他元素 */
    padding: 0 20px; /* 關鍵：左右留白，確保手機版不貼邊 */
    box-sizing: border-box; /* 確保 padding 不會撐大寬度 */
    display: none; /* 預設隱藏 */
    justify-content: center; /* 垂直居中 */
    align-items: center;     /* 水平居中 */
}

#submitAssignmentModal .modal-content {
    width: 100%;
    max-width: 450px; /* 限制電腦版最大寬度，比較精緻 */
    margin: auto; /* 確保在 Flex 容器中居中 */
    max-height: 85vh; /* 防止高度溢出 */
    display: flex;
    flex-direction: column;
    border-radius: 12px; /* 圓角更柔和 */
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* 增加立體感 */
}

/* === 新增：莫蘭迪色系按鈕樣式 === */
.btn-morandi {
    /* 莫蘭迪暖棕色/陶土色，低飽和度，看起來舒服高級 */
    background-color: #a1887f !important; 
    background-image: linear-gradient(135deg, #bcaaa4 0%, #8d6e63 100%) !important;
    color: #fff !important;
    border: none !important;
    padding: 10px 20px !important;
    font-size: 1rem !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 10px rgba(141, 110, 99, 0.3) !important;
    transition: all 0.3s ease !important;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'Noto Serif TC', serif;
}

.btn-morandi:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(141, 110, 99, 0.4) !important;
    filter: brightness(105%);
}

.btn-morandi:active {
    transform: translateY(0);
}

	/* ========================================= */
/* === 大綱結果表格美化 (原稿紙風格) === */
/* ========================================= */

/* 針對 敘事抒情(rewriteTable) 和 議論(argumentRewriteTable) 的改寫表格 */
/* 同時也美化點評表格 (commentTable, argumentCommentTable) 以保持一致 */
#rewriteTable td, #commentTable td,
#argumentRewriteTable td, #argumentCommentTable td {
    /* 1. 基礎字體與排版 (與輸入框一致) */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 18px !important;       
    line-height: 40px !important;     /* 關鍵：配合格線高度 */
    color: #2c3e50;                   
    letter-spacing: 1px;              
    
    /* 2. 原稿紙背景 (40px 高) */
    background-color: #fffcf6 !important;        
    background-image: 
        linear-gradient(transparent 39px, rgba(42, 150, 137, 0.2) 39px, rgba(42, 150, 137, 0.2) 40px, transparent 40px),
        linear-gradient(90deg, transparent 39px, rgba(0,0,0,0.02) 39px, rgba(0,0,0,0.02) 40px, transparent 40px) !important;
    background-size: 40px 40px !important;       
    background-attachment: local;     
    
    /* 3. 邊框與間距 */
    border: 1px solid #8baea8 !important;        
    padding: 0 15px !important;       
    vertical-align: top; /* 文字靠上對齊 */
    
    /* 確保文字對齊格線 */
    white-space: pre-wrap; /* 保留換行 */
}

/* 表頭樣式美化 */
#rewriteTable th, #commentTable th,
#argumentRewriteTable th, #argumentCommentTable th {
    background-color: #2A9689 !important;
    color: white !important;
    font-weight: bold;
    border: 1px solid #1e7e72 !important;
    padding: 10px;
    font-size: 1.1em;
}

/* === 手機版響應式調整 (格線縮小) === */
@media (max-width: 600px) {
    #rewriteTable td, #commentTable td,
    #argumentRewriteTable td, #argumentCommentTable td {
        font-size: 16px !important;
        line-height: 32px !important; /* 手機版行高 */
        
        /* 手機版背景格線 (32px) */
        background-image: 
            linear-gradient(transparent 31px, rgba(42, 150, 137, 0.2) 31px, rgba(42, 150, 137, 0.2) 32px, transparent 32px),
            linear-gradient(90deg, transparent 31px, rgba(0,0,0,0.02) 31px, rgba(0,0,0,0.02) 32px, transparent 32px) !important;
        background-size: 32px 32px !important;
        
        padding: 0 8px !important;
    }
}

/* ========================================= */
/* === 大綱表格寬度優化 (V3 - 平衡版) === */
/* ========================================= */

/* 1. 統一「結構段重點/論點」(第二欄) 的寬度設定 */
/* 設定為 150px，與點評表格保持一致 */
#commentTable th:nth-child(2), #commentTable td:nth-child(2),
#argumentCommentTable th:nth-child(2), #argumentCommentTable td:nth-child(2),
#rewriteTable th:nth-child(2), #rewriteTable td:nth-child(2),
#argumentRewriteTable th:nth-child(2), #argumentRewriteTable td:nth-child(2) {
    min-width: 150px !important; 
    max-width: 300px !important; /* 限制最大寬度，避免太寬 */
    width: auto !important;
}

/* 2. 統一「情節大要/論據及論證」(第三欄) 的寬度設定 */
/* 設定為 280px，既能橫向伸展減少高度，又不會過寬 */
#commentTable th:nth-child(3), #commentTable td:nth-child(3),
#argumentCommentTable th:nth-child(3), #argumentCommentTable td:nth-child(3),
#rewriteTable th:nth-child(3), #rewriteTable td:nth-child(3),
#argumentRewriteTable th:nth-child(3), #argumentRewriteTable td:nth-child(3) {
    min-width: 180px !important; /* <--- 修改這裡，從 280px 改小 */
    width: auto !important;
}

/* 3. 確保原稿紙背景樣式 (通用) */
#rewriteTable td, #commentTable td,
#argumentRewriteTable td, #argumentCommentTable td {
    background-attachment: local !important; 
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 18px !important;       
    line-height: 40px !important;     
    color: #2c3e50;                   
    letter-spacing: 1px;              
    
    /* 原稿紙背景 (40px 高) */
    background-color: #fffcf6 !important;        
    background-image: 
        linear-gradient(transparent 39px, rgba(42, 150, 137, 0.2) 39px, rgba(42, 150, 137, 0.2) 40px, transparent 40px),
        linear-gradient(90deg, transparent 39px, rgba(0,0,0,0.02) 39px, rgba(0,0,0,0.02) 40px, transparent 40px) !important;
    background-size: 40px 40px !important;       
    
    border: 1px solid #8baea8 !important;        
    padding: 0 15px !important;       
    vertical-align: top;
    white-space: pre-wrap; 
}

/* 表頭樣式 */
#rewriteTable th, #commentTable th,
#argumentRewriteTable th, #argumentCommentTable th {
    background-color: #2A9689 !important;
    color: white !important;
    font-weight: bold;
    border: 1px solid #1e7e72 !important;
    padding: 10px;
    font-size: 1.1em;
    white-space: nowrap; 
}

/* 手機版微調 */
@media (max-width: 600px) {
    #rewriteTable td, #commentTable td,
    #argumentRewriteTable td, #argumentCommentTable td {
        font-size: 16px !important;
        line-height: 32px !important;
        background-image: 
            linear-gradient(transparent 31px, rgba(42, 150, 137, 0.2) 31px, rgba(42, 150, 137, 0.2) 32px, transparent 32px),
            linear-gradient(90deg, transparent 31px, rgba(0,0,0,0.02) 31px, rgba(0,0,0,0.02) 32px, transparent 32px) !important;
        background-size: 32px 32px !important;
    }
}


/* === 加載動畫覆蓋層樣式 === */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 252, 245, 0.92); /* 米白色半透明背景 */
    backdrop-filter: blur(5px); /* 毛玻璃效果 */
    z-index: 99999; /* 確保在最上層 */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    flex-direction: column;
    animation: fadeIn 0.3s ease-in-out;
}

.loading-content {
    text-align: center;
    transform: translateY(-50px);
    width: 100%;          /* 確保容器撐滿 */
    padding: 0 20px;      /* 左右保留 20px 的安全邊距，不讓文字撞牆 */
    box-sizing: border-box; 
    display: flex;
    flex-direction: column;
    align-items: center;
}

.loading-gif {
    width: 280px; /* 根據你的 GIF 大小調整 */
    height: auto;
    margin-bottom: 25px;
    opacity: 0.8;
}

.loading-text {
    font-family: 'Noto Serif TC', serif;
    /* 核心修改：自動縮放字體大小 */
    font-size: clamp(1.2rem, 5vw, 2.2rem); 
    font-weight: 700;
    color: #2A9689;
    
    /* 核心修改：不分行 */
    white-space: nowrap; 
    
    /* 核心修改：字距也改為動態，避免在小螢幕太撐 */
    letter-spacing: clamp(2px, 1vw, 6px); 
    
    text-shadow: 0 2px 10px rgba(42, 150, 137, 0.2);
    animation: pulseText 2s infinite ease-in-out;
}
@keyframes pulseText {
    0% { opacity: 0.6; transform: scale(0.98); }
    50% { opacity: 1; transform: scale(1); }
    100% { opacity: 0.6; transform: scale(0.98); }
}


	/* === 生成結果畫布專用樣式 === */
.result-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(245, 245, 243, 0.98); /* 接近語薈的米色底 */
    z-index: 30000; /* 確保在最頂層 */
    display: none; /* 預設隱藏 */
    overflow-y: auto;
    animation: fadeIn 0.4s ease-out;
}

.result-canvas-content {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.result-canvas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 2px solid #2A9689;
    margin-bottom: 20px;
    position: sticky;
    top: 0;
    background: rgba(245, 245, 243, 0.95);
    z-index: 10;
}

#resultCanvasTitle {
    font-size: 1.4rem;
    font-weight: bold;
    color: #2A9689;
    font-family: 'Noto Serif TC', serif;
}

.result-canvas-close {
    background-color: #d9534f;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.result-canvas-close:hover {
    background-color: #c9302c;
    transform: scale(1.05);
}

.result-canvas-body {
    flex-grow: 1;
    /* 這裡會繼承原本的結果樣式，如表格、點評卡片等 */
}

/* 確保畫布內的雷達圖容器高度正確 */
.result-canvas-body .radar-chart-container {
    height: 350px;
    margin-bottom: 20px;
}

@media (max-width: 600px) {
    .result-canvas-content { padding: 15px; }
    #resultCanvasTitle { font-size: 1.1rem; }
}

	/* === 新增：學生登出按鈕樣式 === */
.logout-icon-btn {
    background-color: #ef9a9a; /* 莫蘭迪淡紅色 */
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 10px; /* 與歡迎文字保持距離 */
    font-size: 14px;
    vertical-align: middle;
}

.logout-icon-btn:hover {
    background-color: #e53935; /* 懸停時變深紅 */
    transform: scale(1.15) rotate(90deg); /* 懸停時稍微旋轉放大 */
    box-shadow: 0 4px 8px rgba(229, 57, 53, 0.3);
}

	/* === 通知系統 UI === */
/* === 持久性通知系統 - 精緻排版版 === */
.sansi-notification-container {
    position: fixed;
    top: 25px;
    right: 20px;
    z-index: 100005;
    display: flex;
    flex-direction: column;
    gap: 18px;
    pointer-events: none;
}

.sansi-notification {
    pointer-events: auto;
    width: 300px;
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 12px;
    padding: 15px 15px 15px 50px; /* 增加左邊距給打洞區 */
    box-shadow: 0 15px 35px rgba(0,0,0,0.12);
    position: relative;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    animation: notifIn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    
    /* 強化原稿紙打洞風格 */
    background-image: radial-gradient(circle at 22px 50%, #d1cdc5 6px, transparent 7px);
    background-size: 100% 35px;
    background-repeat: repeat-y;
}

@keyframes notifIn {
    from { opacity: 0; transform: translateX(80px) scale(0.9); }
    to { opacity: 1; transform: translateX(0) scale(1); }
}

.sansi-notification:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.18);
    background-color: #fff;
}

/* 頂部彩色裝飾線條 */
.sansi-notification::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 6px;
    border-radius: 12px 12px 0 0;
}

/* 性質標籤樣式 */
.notif-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

/* 莫蘭迪性質分類 - 修改版 */
/* 上方色條改為讀取變數，以便與課業列表的莫蘭迪色系一致 */
.sansi-notification::before { background-color: var(--theme-color) !important; }

/* 標籤與圖示顏色保持原有的性質區分 (紅色代表新，紫色代表發還)，不做變動 */
.notif-new .notif-badge { background-color: #f7ebea; color: #a67069; }
.notif-new .notif-icon { color: #d69a92; }

.notif-returned .notif-badge { background-color: #f0ebf5; color: #7e6f8f; }
.notif-returned .notif-icon { color: #b6a6ca; }

/* 內容排版 */
.notif-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.notif-topic {
    font-family: 'Noto Serif TC', serif;
    font-weight: 700;
    font-size: 1.1rem;
    color: #333;
    line-height: 1.4;
    margin: 4px 0 8px 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.notif-desc {
    font-size: 0.88rem;
    color: #777;
    line-height: 1.6;
    border-top: 1px dashed #eee;
    padding-top: 8px;
}

.notif-footer {
    margin-top: 10px;
    font-size: 0.75rem;
    color: #aaa;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 5px;
}

.notif-icon {
    font-size: 0.9rem;
}

/* === 雲端按鈕與紅點樣式修正 === */

/* 1. 確保按鈕本身是相對定位，讓紅點可以依附在它右上角 */
#sideMenuCloudBtn {
    position: relative !important; 
    overflow: visible !important; /* 確保紅點不會被切掉 */
}

/* 2. 紅點樣式 (呼吸燈效果) */
.notification-badge {
    display: none; /* 預設隱藏，由 JS 控制顯示 */
    position: absolute;
    top: 5px;          /* 距離頂部 */
    right: 5px;        /* 距離右邊 */
    width: 10px;
    height: 10px;
    background-color: #ff4444; /* 鮮豔紅 */
    border-radius: 50%;
    border: 2px solid #333;    /* 與深色背景區隔的邊框 */
    box-shadow: 0 0 5px rgba(255, 68, 68, 0.8);
    z-index: 100;
    pointer-events: none;      /* 讓紅點不影響點擊 */
    animation: badgePulse 2s infinite;
}

/* 紅點呼吸動畫 */
@keyframes badgePulse {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
    70% { transform: scale(1.2); box-shadow: 0 0 0 4px rgba(255, 68, 68, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
}


/* === 學習報告專用樣式 (莫蘭迪簡約風) === */
.report-section {
    margin-bottom: 40px;
    animation: fadeIn 0.5s ease;
}

.report-header {
    border-left: 5px solid #8fa398; /* 莫蘭迪灰綠 */
    padding-left: 15px;
    margin-bottom: 20px;
}

.report-header h3 {
    margin: 0;
    color: #5e7067;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 文字分析卡片 (無標題、無醜陋圖示) */
.report-text-card {
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 8px;
    padding: 20px;
    margin-top: 15px;
    line-height: 1.8;
    color: #555;
    font-size: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    text-align: justify;
}

/* 強調文字樣式 */
.report-highlight {
    font-weight: bold;
    color: #94a7b5; /* 莫蘭迪霧霾藍 */
    border-bottom: 1px dashed #94a7b5;
}

/* 金句樣式 (靠左) */
.report-quote {
    margin-top: 30px;
    padding: 15px 20px;
    background-color: rgba(143, 163, 152, 0.1);
    border-radius: 8px;
    color: #5e7067;
    font-style: italic;
    font-weight: bold;
    text-align: left; /* 靠左對齊 */
    border-left: 4px solid #8fa398;
}

/* 確保雷達圖容器高度足夠 */
.report-radar-wrapper {
    margin-top: 20px;
    margin-bottom: 30px;
}


	/* ==========================================
   === 學習報告專用樣式 (V2 - 視覺分層版) ===
   ========================================== */

.report-section {
    margin-bottom: 50px; /* 增加間距，讓各範疇區隔更明顯 */
    animation: fadeIn 0.5s ease;
}

/* 1. 範疇標題 (膠囊型標籤，視覺上明確區分層級) */
.report-category-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 25px;
    border-radius: 50px;
    color: white;
    font-weight: bold;
    font-size: 1.3rem;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    letter-spacing: 1px;
}

/* 各範疇專屬顏色 (莫蘭迪色系加深版，確保白字清晰) */
.badge-narrative { background-color: #7da3c0; /* 藍 */ }
.badge-argument  { background-color: #a692c2; /* 紫 */ }
.badge-reading   { background-color: #8da399; /* 綠 */ }
.badge-expand    { background-color: #d69a92; /* 紅 */ }
.badge-general   { background-color: #5e7067; /* 深灰綠 */ }

/* 2. 文字分析卡片 (簡約米色) */
.report-text-card {
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 12px;
    padding: 25px;
    line-height: 1.9;
    color: #4a4a4a;
    font-size: 1.05rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    text-align: justify;
    margin-top: 10px;
}

/* 3. 金句專用容器 (Note Card 打孔風格) */
.report-quote-card {
    position: relative;
    background-color: #fffefb;
    border: 1px solid #e0ddd7;
    border-radius: 8px;
    padding: 30px 30px 30px 65px; /* 左側留白給打孔 */
    margin-top: 40px;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.05);
    text-align: left; /* 靠左對齊 */
    
    /* 打孔與紅線特效 */
    background-image: 
        /* 垂直紅線 */
        linear-gradient(to right, transparent 49px, #eebdbd 50px, transparent 51px),
        /* 圓形打孔 */
        radial-gradient(circle at 25px 50%, #d1cdc5 8px, transparent 9px);
        
    background-size: 
        100% 100%,  /* 線條 */
        100% 40px;  /* 打孔重複間距 */
        
    background-repeat: 
        no-repeat,
        repeat-y;
        
    background-position: 
        0 0,
        0 15px; /* 打孔起始位置 */
}

/* 金句文字樣式 */
.report-quote-content {
    font-family: 'Noto Serif TC', serif;
    font-size: 1.2rem;
    font-weight: bold;
    color: #5d4037; /* 深咖啡色 */
    font-style: italic;
    line-height: 1.6;
}

.report-quote-author {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #888;
    text-align: right;
    font-style: normal;
}

/* 雷達圖容器修正 */
.report-radar-wrapper {
    margin-bottom: 30px;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #eee;
}


	/* === 學習報告專用樣式 (V3 - 最終修正版) === */

/* 1. 整體概況 (最高層級：全寬、置中、深色背景) */
.badge-general {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px 10px;
    margin-bottom: 10px;

    /* === 修改重點開始：無印風．暖麻米色 (Muji Linen) === */
    /* 這種漸層模擬了無印良品常見的未漂白棉麻或再生紙的質感 */
    background: linear-gradient(135deg, #C5B4A1 0%, #A99885 100%) !important; 
    
    /* 陰影調整為淡淡的暖棕色，讓卡片浮起得更自然 */
    box-shadow: 0 8px 20px rgba(169, 152, 133, 0.35) !important; 
    
    border-bottom: none !important; 
    /* === 修改重點結束 === */

    color: white; /* 白色文字在這個底色上依然清晰 */
    border-radius: 12px;
    position: relative;
    overflow: hidden;
}

/* 2. 其他主範疇 (膠囊型，靠左) */
.report-category-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 25px;
    border-radius: 50px;
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    letter-spacing: 1px;
}
/* 範疇顏色 */
.badge-narrative { background-color: #7da3c0; } /* 敘事-藍 */
.badge-argument  { background-color: #a692c2; } /* 議論-紫 */
.badge-reading   { background-color: #8da399; } /* 閱讀-綠 */
.badge-expand    { background-color: #d69a92; } /* 拓展-紅 */

/* 3. 確保雷達圖容器與文章點評一致 */
.report-radar-wrapper .grading-container {
    margin-top: 0;
    padding-top: 0;
    border-top: none;
}

	/* === 1. 修復手機版整體概況寬度溢出 === */
.badge-general {
    /* 確保寬度不超過父容器，並預留內距 */
    width: 100%;
    max-width: 100%; 
    box-sizing: border-box; /* 關鍵：讓 padding 包含在寬度內 */
    
    display: flex;
    justify-content: center;
    padding: 15px 10px; /* 左右內距稍微縮小 */
    margin-bottom: 30px;
    background-color: #5e7067;
    color: white;
    font-size: 1.6rem;
    font-weight: bold;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    letter-spacing: 2px;
    border-bottom: 4px solid #46544d;
    
    /* 強制文字換行，防止長標題撐開 */
    white-space: normal; 
    text-align: center;
}

/* 手機版字體微調 */
@media (max-width: 600px) {
    .badge-general {
        font-size: 1.3rem; /* 手機上字體稍微縮小 */
        padding: 12px 5px;
    }
}

/* === 2. 報告操作選擇視窗 (半屏 Bottom Sheet 風格) === */
.report-menu-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10000;
    display: none;
    align-items: flex-end; /* 靠底對齊 */
    justify-content: center;
    backdrop-filter: blur(3px);
}

.report-menu-content {
    background: #fdfcf8;
    width: 100%;
    max-width: 600px; /* 電腦版限制寬度 */
    border-radius: 20px 20px 0 0; /* 上方圓角 */
    padding: 30px 20px 50px 20px;
    box-shadow: 0 -5px 25px rgba(0,0,0,0.15);
    animation: slideUp 0.3s ease-out;
    border-top: 5px solid #8fa398;
}

@keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}

.report-menu-title {
    text-align: center;
    color: #5e7067;
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 25px;
    border-bottom: 1px dashed #ccc;
    padding-bottom: 10px;
}

.report-options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.report-option-card {
    background: white;
    border: 2px solid #e0ddd7;
    border-radius: 12px;
    padding: 25px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    color: #666;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.report-option-card:hover {
    transform: translateY(-5px);
    border-color: #8fa398;
    color: #8fa398;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.report-option-icon {
    font-size: 2rem;
    margin-bottom: 5px;
}

.report-option-text {
    font-weight: bold;
    font-size: 1.1rem;
}


/* ==========================================
   === 學習報告專用樣式 (V4 - 最終優化版) ===
   ========================================== */

/* 1. 整體概況標題容器 (增強版) */
.badge-general {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column; /* 改為垂直排列 */
    align-items: center;
    justify-content: center;
    padding: 20px 10px;
    margin-bottom: 10px; /* 減少下方間距，因為有分隔線 */
    background: linear-gradient(135deg, #5e7067 0%, #4b5e56 100%); /* 漸層背景 */
    color: white;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(94, 112, 103, 0.3);
    position: relative;
    overflow: hidden;
}

/* 標題文字 */
.badge-general-title {
    font-size: 1.6rem;
    font-weight: bold;
    letter-spacing: 2px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 2. 綜合評級 (突出的視覺設計) */
.overall-grade-tag {
    background-color: #fff;
    color: #d9534f; /* 醒目的等級紅 */
    padding: 5px 25px;
    border-radius: 50px;
    font-size: 1.4rem;
    font-weight: 900;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transform: scale(1);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 2px solid #d69a92; /* 莫蘭迪紅邊框 */
    display: flex;
    align-items: center;
    gap: 8px;
}

.overall-grade-tag:hover {
    transform: scale(1.1);
}

.overall-grade-label {
    font-size: 0.8rem;
    color: #888;
    font-weight: normal;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* 3. 莫蘭迪色虛線分隔 */
.report-separator {
    position: relative;
    height: 1px;
    border: 0;
    border-top: 3px dashed #b6a6ca; /* 莫蘭迪紫 */
    margin: 40px 0 50px 0; /* 上下大幅留白 */
    opacity: 0.6;
}

/* 裝飾中間的小剪刀或圖示 (選用) */
.report-separator::after {
    content: '▼';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: #fdfcf8; /* 背景色遮擋 */
    padding: 0 10px;
    color: #b6a6ca;
    font-size: 12px;
}

/* 4. 修復圖表佈局 (手機版強制垂直堆疊，不壓縮) */
@media (max-width: 768px) {
    /* 強制將左右兩欄變為單欄垂直排列 */
    .grading-grid {
        grid-template-columns: 1fr !important;
        gap: 30px !important;
    }
    
    /* 確保容器寬度填滿 */
    .grading-scores, .grading-radar {
        width: 100% !important;
        box-sizing: border-box !important;
        margin: 0 !important;
    }

    /* 確保雷達圖高度足夠 */
    .radar-chart-container {
        height: 300px !important; /* 給予固定高度 */
        width: 100% !important;
    }
    
    /* 手機字體微調 */
    .badge-general-title { font-size: 1.3rem; }
    .overall-grade-tag { font-size: 1.2rem; padding: 5px 20px; }
}

	/* ==========================================
   === 手機版顯示修復 (Mobile Responsiveness) ===
   ========================================== */
@media (max-width: 768px) {
    /* 1. 強制將「評分表」與「雷達圖」改為垂直排列 */
    .grading-grid {
        display: flex !important;       /* 使用 Flex 取代 Grid，控制力更好 */
        flex-direction: column !important; /* 垂直堆疊 */
        gap: 20px !important;           /* 上下間距 */
        width: 100% !important;
        margin: 0 !important;
    }

    /* 2. 限制容器寬度，防止溢出 */
    .grading-scores, 
    .grading-radar,
    .report-radar-wrapper {
        width: 100% !important;
        max-width: 100% !important;     /* 絕不超過螢幕寬 */
        box-sizing: border-box !important; /* 確保 padding 包含在寬度內 */
        padding: 15px !important;       /* 稍微減少內距 */
        margin: 0 !important;
        overflow: hidden !important;    /* 隱藏任何溢出的內容 */
    }

    /* 3. 修復雷達圖 Canvas 的響應式大小 */
    .radar-chart-container {
        position: relative !important;
        width: 100% !important;         /* 寬度撐滿容器 */
        height: auto !important;        /* 高度自動 */
        aspect-ratio: 1 / 1 !important; /* 保持正方形比例 */
        max-height: 350px !important;   /* 限制最大高度，避免在大手機上太長 */
        margin: 0 auto !important;
    }

    /* 4. 優化進度條區域 (避免標籤文字換行擠壓) */
    .score-item {
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        gap: 10px !important;
    }

    .score-item label {
        font-size: 0.9rem !important;   /* 字體稍縮小 */
        white-space: nowrap !important; /* 防止文字換行 */
        min-width: 80px !important;     /* 給予最小寬度 */
    }

    .slider-container {
        flex-grow: 1 !important;        /* 讓進度條佔據剩餘空間 */
        width: auto !important;
    }

    /* 5. 確保標題和標籤也不會爆版 */
    .badge-general, 
    .report-category-badge {
        width: 100% !important;
        max-width: 100% !important;
        white-space: normal !important; /* 允許文字換行 */
        box-sizing: border-box !important;
    }
}

	/* ==========================================
   === 手機版顯示修復 (V2 - 標題置中不拉寬) ===
   ========================================== */
@media (max-width: 768px) {
    /* --- 1. 圖表與評分表佈局 (垂直堆疊) --- */
    .grading-grid {
        display: flex !important;
        flex-direction: column !important;
        gap: 20px !important;
        width: 100% !important;
        margin: 0 !important;
    }

    .grading-scores, 
    .grading-radar,
    .report-radar-wrapper {
        width: 100% !important;
        box-sizing: border-box !important;
        padding: 15px !important;
        margin: 0 !important;
        overflow: hidden !important;
    }

    .radar-chart-container {
        height: auto !important;
        aspect-ratio: 1 / 1 !important;
        max-height: 350px !important;
        margin: 0 auto !important;
    }

    /* --- 2. 標題樣式區分 (關鍵修正) --- */

    /* A. 整體概況 (最高層級)：強制拉寬 (100%)，方形圓角 */
    .badge-general {
        width: 100% !important;
        max-width: 100% !important;
        display: flex !important;
        flex-direction: column !important; /* 垂直排列內容 */
        align-items: center !important;
        
        box-sizing: border-box !important;
        padding: 20px 10px !important;
        margin-bottom: 30px !important;
        
        border-radius: 12px !important; /* 方形圓角，區別於膠囊 */
        text-align: center !important;
    }

    /* B. 一般範疇 (閱讀、議論等)：不拉寬 (fit-content) + 水平置中 + 膠囊狀 */
    /* ★★★ 使用 :not(.badge-general) 排除整體概況，避免衝突 ★★★ */
    .report-category-badge:not(.badge-general) {
        width: -moz-fit-content !important;
        width: fit-content !important;       /* 寬度只包住文字 */
        max-width: 90% !important;           /* 防止文字過長 */
        
        display: flex !important;
        justify-content: center !important;
        
        /* 關鍵：利用 margin auto 達成置中 */
        margin-left: auto !important;
        margin-right: auto !important;
        margin-bottom: 20px !important;
        
        border-radius: 50px !important;      /* 保持圓潤膠囊狀 */
        white-space: normal !important;
        text-align: center !important;
    }

    /* C. 進度條文字微調 */
    .score-item label {
        white-space: nowrap !important;
        min-width: 70px !important;
    }
}



	/* === 新增：雲端按鈕凍結狀態樣式 === */
.btn-frozen {
    opacity: 0.4 !important;           /* 降低透明度 */
    filter: grayscale(100%) !important; /* 變成灰色 */
    pointer-events: none !important;    /* 關鍵：徹底禁止滑鼠點擊事件 */
    cursor: wait !important;            /* 滑鼠移上去顯示等待圖示 */
    transform: scale(0.95);             /* 稍微縮小，視覺上感覺「凹陷/無效」 */
}

	/* === 安全版：只針對「課業列表」內的卡片生效 === */
/* 加上 #assignmentList 前綴，確保絕對不會影響到其他頁面的卡片 */
#assignmentList .task-card::before {
    background-color: var(--theme-color) !important;
}

	/* =======================================================
   === [新增] 修復改寫範例樣式 & 畫布聊天室樣式 ===
   ======================================================= */

/* 1. 改寫內容專用樣式 (已修正字體大小與行距) */
.rewrite-content {
    font-family: 'Noto Serif TC', serif !important;
    font-size: 1rem !important; /* 修正：由 1.1rem 改為 1rem，與點評一致 */
    line-height: 1.8 !important; /* 修正：微調行距 */
    color: #2c3e50 !important;
    white-space: pre-wrap !important;
    text-align: justify !important;
    background-color: #fff !important;
    padding: 20px !important;
    border-radius: 8px !important;
    border: 1px solid #e0e0e0 !important;
    margin-top: 10px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
}

/* 2. 結果畫布內的聊天室容器 (保持不變) */
.canvas-chat-container {
    margin-top: 50px;
    padding-top: 25px;
    border-top: 3px dashed #2A9689;
    animation: fadeIn 0.5s ease;
    background-color: #fcfdfd;
    padding-bottom: 20px;
}

/* 聊天室標題 */
.canvas-chat-header {
    color: #2A9689;
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 聊天紀錄區域 */
.canvas-chat-history {
    background-color: #f0f4f8;
    border: 1px solid #d1d9e6;
    border-radius: 12px;
    padding: 20px;
    height: 300px; /* 固定高度 */
    overflow-y: auto;
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* 輸入區域 */
.canvas-input-area {
    display: flex;
    gap: 10px;
    align-items: flex-start;
}

.canvas-input-area textarea {
    flex: 1;
    min-height: 50px;
    padding: 12px;
    border: 2px solid #ccc;
    border-radius: 8px;
    resize: vertical;
    font-size: 1rem;
    transition: border-color 0.3s;
    font-family: 'Noto Serif TC', serif;
}

.canvas-input-area textarea:focus {
    border-color: #2A9689;
    outline: none;
    box-shadow: 0 0 0 3px rgba(42, 150, 137, 0.2);
}

/* 發送按鈕 */
.canvas-send-btn {
    background-color: #2A9689;
    color: white;
    border: none;
    width: 55px;
    height: 55px;
    border-radius: 50%; /* 圓形 */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.2s;
    flex-shrink: 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.canvas-send-btn:hover {
    background-color: #238074;
    transform: scale(1.1);
}

.canvas-send-btn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    transform: none;
}


	/* === 新增：詞彙/物象 網格展示樣式 === */
.vocab-grid {
    display: grid;
    /* 自動填滿，每格最小寬度 80px，適應手機與電腦 */
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 15px;
    padding: 15px 5px;
    margin-top: 10px;
}

.vocab-item {
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px 5px;
    text-align: center;
    
    /* 字體設定：確保與主體一致 */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 1.1rem !important;
    font-weight: 500;
    color: #555;
    
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    transition: all 0.3s ease;
    cursor: default;
    
    /* 防止長詞彙溢出 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.vocab-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 12px rgba(42, 150, 137, 0.15);
    border-color: #2A9689;
    color: #2A9689;
    font-weight: bold;
    background-color: #f0fdfc;
}

/* 針對改寫範例的標題修正，確保與上方一致 */
.rewrite-content {
    /* 再次確認字體大小與行距 */
    font-size: 1rem !important;
    line-height: 1.8 !important;
    font-family: 'Noto Serif TC', serif !important;
    color: #333 !important;
}


/* ========================================= */
/* === 取消生成 UI (莫蘭迪色系設計) === */
/* ========================================= */
 
/* 1. 純圖示取消鍵 (低調圓形按鈕) */
.cancel-icon-btn {
    margin-top: 30px;
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: transparent;
    border: 1px solid rgba(143, 163, 152, 0.6); /* 莫蘭迪灰綠邊框 */
    color: #8fa398;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(2px);
    pointer-events: auto; /* 確保可以點擊 */
}
 
.cancel-icon-btn:hover {
    background-color: rgba(143, 163, 152, 0.15);
    transform: rotate(90deg); /* 懸停時旋轉效果 */
    color: #5e7067;
    border-color: #5e7067;
    box-shadow: 0 0 15px rgba(143, 163, 152, 0.2);
}
 
/* 2. 確認視窗遮罩 (覆蓋在 Loading 之上) */
.morandi-modal-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.92); /* 米白遮罩，高模糊 */
    backdrop-filter: blur(8px);
    z-index: 20; /* 必須高於 loading-content */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
}
 
/* 3. 視窗卡片本體 */
.morandi-modal-card {
    background: #fffcf6; /* 暖白紙張色 */
    padding: 30px 35px;
    border-radius: 16px;
    border: 1px solid #e0ddd7;
    box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15); /* 暖色柔和陰影 */
    text-align: center;
    max-width: 85%;
    width: 340px;
    transform: translateY(0);
    animation: slideUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); /* 彈性動畫 */
}
 
.morandi-title {
    color: #5d4037; /* 莫蘭迪深咖啡 */
    font-size: 1.3rem;
    margin: 0 0 12px 0;
    font-weight: bold;
    letter-spacing: 1px;
}
 
.morandi-text {
    color: #8d8d8d; /* 暖灰 */
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 25px;
}
 
/* 4. 按鈕群組 */
.morandi-btn-group {
    display: flex;
    gap: 15px;
    justify-content: center;
}
 
.morandi-btn {
    border: none;
    padding: 10px 24px;
    border-radius: 8px;
    font-size: 0.95rem;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    transition: transform 0.2s, filter 0.2s;
}
 
.morandi-btn:hover {
    transform: translateY(-2px);
    filter: brightness(105%);
}
 
.morandi-btn:active { transform: translateY(0); }
 
/* 灰色按鈕 (繼續等待) */
.btn-gray {
    background-color: #ececec;
    color: #777;
}
 
/* 紅色按鈕 (確認取消 - 豆沙紅) */
.btn-red {
    background-color: #d69a92;
    color: white;
    box-shadow: 0 4px 12px rgba(214, 154, 146, 0.4);
}
 
/* 動畫定義 */
@keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}


	/* ========================================= */
/* === [新增] 手機版確認視窗優化 === */
/* ========================================= */
@media (max-width: 600px) {
    .morandi-modal-card {
        /* 強制設定寬度為：螢幕總寬減去 80px (即左右各留 40px 的寬敞邊距) */
        width: calc(100% - 80px) !important;
        
        /* 移除原本的固定像素寬度限制 */
        max-width: none !important;
        
        /* 稍微縮小內邊距，讓文字在窄卡片中更有呼吸空間 */
        padding: 25px 20px !important;
    }
 
    /* 微調按鈕在手機上的間距 */
    .morandi-btn {
        padding: 10px 15px !important; /* 按鈕變稍微緊湊一點，防止換行 */
        font-size: 0.85rem !important;
        white-space: nowrap; /* 防止按鈕文字換行 */
    }
    
    .morandi-btn-group {
        gap: 10px !important; /* 縮小按鈕之間的距離 */
    }
}



/* === 手機版專用：莫蘭迪虛線與卡片修復 === */
@media (max-width: 600px) {
    /* 1. 虛線樣式 */
    .section-separator {
        display: block;
        width: 100%;
        height: 0;
        border-top: 5px dashed #a89f91; /* 莫蘭迪暖灰，很粗的虛線 */
        margin: 25px 0 15px 0;          /* 上下間距 */
        grid-column: 1 / -1;            /* 強制佔滿整行 */
        opacity: 0.6;
    }

    /* 2. 【關鍵修復】強制鎖定「課外書籍」為大卡片 */
    /* 使用 ID 選擇器，確保不會因為加了虛線而變形 */
    #booksBtn {
        grid-column: 1 / -1 !important;             /* 佔滿整行 */
        width: calc(120px * 2 + 24px) !important;   /* 兩張卡片寬 + 間距 */
        height: 130px !important;                   /* 設定高度 */
        max-width: none !important;
        margin: 0 auto !important;                  /* 置中 */
    }
    
    /* 調整大卡片內的文字大小 (保持您原本的設定) */
    #booksBtn .card-zh { font-size: 22px !important; }
    #booksBtn .card-en { font-size: 13px !important; }
    #booksBtn .card-icon-container { font-size: 34px !important; margin-top: 45px !important; }
}

/* 電腦版隱藏虛線 */
@media (min-width: 601px) {
    .section-separator { display: none; }
}


/* === 全局莫蘭迪 Alert 樣式 (手機版邊距優化版) === */
.sansi-alert-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.6); /* 極淡米色遮罩 */
    backdrop-filter: blur(5px); /* 毛玻璃效果 */
    z-index: 2147483647; /* 最頂層 */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.sansi-alert-box {
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 16px;
    box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15);
    
    /* --- 關鍵修改開始 --- */
    width: auto;           /* 讓寬度自動適應，不強制固定 */
    max-width: 320px;      /* 電腦版最大限制寬度 */
    min-width: 260px;      /* 防止內容太少時縮得太小 */
    margin: 0 35px;        /* ★ 重點：手機版強制左右留白 35px，解決貼邊問題 */
    /* --- 關鍵修改結束 --- */

    padding: 25px;
    text-align: center;
    transform: translateY(20px);
    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    position: relative;
    background-image: linear-gradient(to right, transparent 29px, #f2f0eb 30px, transparent 31px);
    background-size: 100% 100%;
}

.sansi-alert-icon {
    font-size: 2.5rem;
    color: #8fa398;
    margin-bottom: 15px;
}

.sansi-alert-message {
    font-family: 'Noto Serif TC', serif;
    font-size: 1.05rem;
    color: #5e5e5e;
    line-height: 1.6;
    margin-bottom: 25px;
    white-space: pre-wrap;
    word-break: break-word;
}

.sansi-alert-btn {
    background-color: #8fa398;
    color: white;
    border: none;
    padding: 10px 30px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(143, 163, 152, 0.3);
    transition: all 0.2s ease;
    font-family: 'Noto Serif TC', serif;
}

.sansi-alert-btn:hover {
    background-color: #7d9186;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(143, 163, 152, 0.4);
}

.sansi-alert-show {
    opacity: 1;
}
.sansi-alert-show .sansi-alert-box {
    transform: translateY(0);
}

#classNumberUpdateModal .modal-content {
    padding: 0 20px; /* 添加左右20px的内边距 */
}

	@media (max-width: 480px) {
    #classNumberUpdateModal .modal-content {
        padding: 0 15px; /* 小屏幕设备使用稍小的内边距 */
    }
}

	/* 修改班號更新窗口的內容容器，增加上下內邊距 */
#classNumberUpdateModal .modal-content {
    padding: 30px 25px;  /* 上下30px，左右25px的內邊距 */
    box-sizing: border-box; /* 確保內邊距不會增加總寬度 */
}

/* 可選：如果需要進一步調整文字區域的上下間距 */
#classNumberUpdateModal .modal-content > div:first-child {
    margin-bottom: 25px; /* 增加標題區域與下方內容的距離 */
    padding-bottom: 10px; /* 增加標題區域底部的內邊距 */
    border-bottom: 1px solid #e9e5db; /* 可選：添加分隔線，增加視覺層次 */
}

/* 調整按鈕與選擇器之間的距離 */
#classNumberUpdateModal .modal-content button {
    margin-top: 15px; /* 增加按鈕上方邊距 */
}
	

/* === [新增] 歷史紀錄修訂功能樣式 === */
 
/* 1. 編輯模式下的視覺提示 */
[contenteditable="true"] {
    outline: none;
    border: 2px dashed #94a7b5 !important; /* 莫蘭迪藍虛線 */
    background-color: #fffcf6; /* 暖白底色 */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
    cursor: text;
}
 
/* 2. 莫蘭迪懸浮儲存鍵 (純圖案設計) */
.morandi-save-float-btn {
    position: fixed;
    bottom: 50px;
    right: 50px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    
    /* 莫蘭迪灰綠漸層 */
    background: linear-gradient(135deg, #8fa398 0%, #7d9186 100%);
    color: white;
    
    border: none;
    box-shadow: 0 8px 25px rgba(143, 163, 152, 0.6);
    
    display: none; /* 預設隱藏 */
    align-items: center;
    justify-content: center;
    font-size: 1.6rem;
    cursor: pointer;
    z-index: 99999; /* 確保在最上層 */
    
    animation: floatPopIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transition: transform 0.2s ease, background 0.2s;
}
 
.morandi-save-float-btn:hover {
    transform: scale(1.1) rotate(15deg);
    background: linear-gradient(135deg, #9db1a6 0%, #8fa398 100%);
}
 
.morandi-save-float-btn:active {
    transform: scale(0.95);
}
 
@keyframes floatPopIn {
    from { opacity: 0; transform: scale(0); }
    to { opacity: 1; transform: scale(1); }
}

/* === 歷史紀錄操作按鈕區優化 === */
.history-actions {
    margin-top: 15px;
    display: flex;
    justify-content: flex-end;
    gap: 12px; /* 增加按鈕之間的間距 */
    opacity: 0.8; /* 稍微提高預設透明度，方便手機辨識 */
    transition: opacity 0.3s;
}

/* 下載按鈕樣式 (莫蘭迪藍/灰色) */
.btn-download-history {
    background: transparent;
    border: 1px solid #94a7b5; /* 霧霾藍邊框 */
    color: #94a7b5;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;
}

.btn-download-history:hover {
    background-color: #94a7b5;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
}

/* 手機版適配：確保按鈕區域夠大，防止誤觸 */
@media (max-width: 600px) {
    .history-actions {
        opacity: 1; /* 手機上總是顯示 */
        margin-top: 12px;
    }
    .btn-download-history, .btn-delete-history {
        width: 40px; /* 手機上按鈕稍微加大 */
        height: 40px;
        font-size: 1.1em;
    }
}


	/* === 備用線路提示視窗 (響應式設計) === */
.backup-alert-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.85); /* 米白高模糊遮罩 */
    backdrop-filter: blur(8px);
    z-index: 999999; /* 確保在最上層 */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
}

.backup-alert-card {
    background: #fff;
    
    /* === 修改部分：優化響應式寬度 === */
    /* 強制左右各留 30px 邊距，解決手機貼邊問題 */
    width: calc(100% - 60px); 
    max-width: 360px;         /* 電腦版最大寬度保持不變 */
    box-sizing: border-box;   /* 確保內距不會撐大卡片 */
    margin: 0 auto;           /* 確保水平置中 */
    /* ============================ */

    padding: 30px 25px;
    border-radius: 16px;
    border: 1px solid #e0ddd7;
    box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15);
    text-align: center;
    position: relative;
}

.backup-alert-icon {
    font-size: 3rem;
    color: #d69a92; /* 莫蘭迪紅，表示警示 */
    margin-bottom: 15px;
    animation: pulse 2s infinite;
}

.backup-alert-title {
    color: #5d4037;
    font-size: 1.3rem;
    font-weight: bold;
    margin: 0 0 10px 0;
}

.backup-alert-desc {
    color: #888;
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 25px;
}

.backup-btn-group {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.backup-btn {
    border: none;
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 0.95rem;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    transition: transform 0.2s;
}

.backup-btn:hover { transform: translateY(-2px); }

.btn-stay { background: #f0f0f0; color: #777; }
.btn-switch { 
    background: #8fa398; /* 莫蘭迪綠 */
    color: white; 
    box-shadow: 0 4px 12px rgba(143, 163, 152, 0.4);
}


/* =======================================================
   === [新增] 閱卷員追問區 (畫布聊天室) 樣式 - 歷史紀錄專用 ===
   ======================================================= */

/* 1. 聊天室外層容器 */
.canvas-chat-container {
    margin-top: 40px;
    padding-top: 25px;
    border-top: 3px dashed #2A9689; /* 標誌性的綠色虛線 */
    background-color: #fcfdfd;
    padding-bottom: 20px;
    font-family: 'Noto Serif TC', serif;
    animation: fadeIn 0.5s ease;
}

/* 2. 標題設計 */
.canvas-chat-header {
    color: #2A9689;
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-left: 5px;
}

/* 3. 聊天紀錄捲動區 (在歷史紀錄中我們通常希望它自動伸展，不要 Scroll，方便列印或閱讀) */
.canvas-chat-history {
    background-color: #f0f4f8; /* 淺藍灰背景 */
    border: 1px solid #d1d9e6;
    border-radius: 12px;
    padding: 25px;
    /* 這裡移除了固定高度 (height: 300px)，改為自動高度，讓歷史紀錄完整顯示 */
    height: auto !important; 
    min-height: 100px;
    display: flex;
    flex-direction: column;
    gap: 20px; /* 氣泡間距 */
}

/* 4. 訊息氣泡通用設定 */
.message-bubble {
    padding: 15px 20px;
    border-radius: 18px;
    line-height: 1.8;
    font-size: 1rem;
    max-width: 88%;
    word-wrap: break-word;
    position: relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

/* 5. AI (閱卷員) 氣泡 - 左側 */
.message-bubble.ai-message {
    background-color: #ffffff;
    color: #333;
    align-self: flex-start; /* 靠左 */
    border-top-left-radius: 4px;
    border: 1px solid #e0e0e0;
}

/* 6. 學生 (用戶) 氣泡 - 右側 */
.message-bubble.user-message {
    background-color: #2A9689; /* 主題綠 */
    color: white;
    align-self: flex-end; /* 靠右 */
    border-top-right-radius: 4px;
    box-shadow: 0 4px 10px rgba(42, 150, 137, 0.2);
}

/* 7. 強制隱藏歷史紀錄中的輸入框 (保險起見，雖然 JS 會移除) */
.history-modal-content .canvas-input-area,
.detail-view .canvas-input-area {
    display: none !important;
}

	/* ========================================= */
/* === [議論-指引] 專屬輸入內容美化 === */
/* ========================================= */

/* 1. 啟動網格佈局：將容器變為 2 欄 Grid */
.history-parsed-container.argument-guide-layout {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 左右兩欄平分 */
    gap: 15px; /* 卡片間距 */
    background: transparent;
    padding: 5px;
}

/* 2. 讓每一個資料區塊變成一張「卡片」 */
.history-parsed-container.argument-guide-layout .history-item-block {
    background-color: #fdfcf8; /* 米白底色 */
    border: 1px solid #e0ddd7; /* 莫蘭迪邊框 */
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    transition: transform 0.2s ease;
}

/* 懸停微互動 */
.history-parsed-container.argument-guide-layout .history-item-block:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    border-color: #ccc;
}

/* 3. 特殊處理：第一個區塊 (通常是「題目」) 強制佔滿整行 */
.history-parsed-container.argument-guide-layout .history-item-block:first-child {
    grid-column: 1 / -1; /* 跨越所有欄位 */
    background-color: #f4f6f9; /* 稍微深一點的底色以示區別 */
    border-left: 4px solid var(--current-theme-color, #6a7a7d); /* 左側加粗色條 */
}

/* 4. 優化標籤 (Label) 樣式 */
.history-parsed-container.argument-guide-layout .history-item-label {
    font-size: 0.9rem;
    color: #888;
    margin-bottom: 8px;
    padding-bottom: 5px;
    border-bottom: 1px dashed #e0e0e0;
    font-weight: bold;
    display: flex;
    align-items: center;
}

/* 移除原本的小圓點 (因為卡片式設計不需要了) */
.history-parsed-container.argument-guide-layout .history-item-label::before {
    display: none;
}

/* 5. 優化內容 (Content) 樣式 */
.history-parsed-container.argument-guide-layout .history-item-content {
    background-color: transparent !important; /* 移除原本的灰色背景 */
    border: none !important; /* 移除邊框 */
    padding: 0 !important;
    font-size: 1.1rem; /* 字體稍微加大 */
    color: #444;
    line-height: 1.6;
    font-family: 'Noto Serif TC', serif;
}

/* 6. 手機版響應式：變回單欄垂直排列 */
@media (max-width: 600px) {
    .history-parsed-container.argument-guide-layout {
        grid-template-columns: 1fr; /* 強制單欄 */
    }
}

/* === 全螢幕閱讀模式專用樣式 (修復全屏覆蓋問題) === */
#featuredDetailView {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;           /* 新增：確保寬度填滿 */
    bottom: 0;          /* 核心修復：強制錨定到底部，解決手機工具列導致的高度問題 */
    width: 100%;
    
    /* 移除舊的 height 設定，改用 auto 配合 bottom:0 */
    height: auto !important;
    min-height: 100dvh; /* 針對現代移動瀏覽器的動態視口高度 */
    
    background-color: #fdfcf8;
    z-index: 25000;
    
    /* 滾動設定 */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: none; /* 關鍵：防止滑動到頂底時露出主頁背景 */
    
    padding: 0;
    box-sizing: border-box;
    
    /* 移除原本容器的 padding-bottom，避免計算誤差，改由內容撐開 */
}
/* 閱讀內容容器 (限制寬度以利閱讀) */
.read-mode-container {
    max-width: 800px;        /* 最佳閱讀寬度 */
    margin: 60px auto 100px auto; /* 上方留白給標題，下方留白 */
    padding: 40px;
    background-color: #fff;
    box-shadow: 0 4px 30px rgba(0,0,0,0.05);
    border-radius: 12px;
    position: relative;
    /* 原稿紙背景效果 */
    background-image: linear-gradient(to bottom, transparent 29px, #f0f0f0 30px);
    background-size: 100% 30px;
    line-height: 30px;
}

/* 右上角懸浮返回鍵 */
.detail-back-btn {
    position: fixed;
    top: 20px;
    right: 25px;
    z-index: 25001; /* 比內容層更高 */
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.05);
    color: #666;
    border: 1px solid #ddd;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.detail-back-btn:hover {
    background-color: #d69a92; /* 莫蘭迪紅 */
    color: white;
    transform: rotate(-90deg); /* 趣味旋轉效果 */
    border-color: #d69a92;
}

/* 作者與標題排版 */


.detail-title-text {
    font-size: 2.2rem;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    margin-bottom: 15px;
    line-height: 1.4;
}

.detail-meta-info {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    font-family: 'Noto Serif TC', serif;
    font-size: 1.1rem;
}

.detail-author {
    color: #8d6e63; /* 莫蘭迪深褐 (與標題區分) */
    font-weight: bold;
    padding: 2px 10px;
    background-color: #efebe9;
    border-radius: 20px;
}

.detail-date {
    color: #9e9e9e;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

/* 手機版適配 */
@media (max-width: 600px) {
    .read-mode-container {
        width: 100%;
        margin: 0;
        padding: 80px 20px 40px 20px; /* 上方留更多空間給手機狀態列與返回鍵 */
        border-radius: 0;
        box-shadow: none;
        min-height: 100%;
        background-image: none; /* 手機版移除格線，增加易讀性 */
    }
    .detail-title-text { font-size: 1.8rem; }
    .detail-back-btn { top: 15px; right: 15px; }
}


	/* === 全螢幕閱讀模式調整 (V2) === */

/* 閱讀內容容器：改為 90% 寬度，善用螢幕空間 */
.read-mode-container {
    width: 90% !important;        /* 核心修訂：寬度維持 90% */
    max-width: 1200px !important; /* 放寬最大寬度，避免在大螢幕太窄 */
    margin: 60px auto 100px auto; 
    padding: 50px 40px;           /* 內部留白 */
    background-color: #fff;
    box-shadow: 0 4px 30px rgba(0,0,0,0.05);
    border-radius: 12px;
    position: relative;
    /* 原稿紙背景效果 (保持不變) */
    background-image: linear-gradient(to bottom, transparent 29px, #f0f0f0 30px);
    background-size: 100% 30px;
    line-height: 30px;
    box-sizing: border-box; /* 確保 padding 不會撐破 90% */
}

/* 標題與作者區塊容器 */
.detail-header-group {
    display: flex;
    flex-direction: column; /* 垂直排列 */
    align-items: center;    /* 水平置中 */
      /* ↓↓↓ 修改這兩行 ↓↓↓ */
    margin-bottom: 15px !important;  /* 原本是 40px，改為 15px */
    padding-bottom: 15px !important; /* 原本是 25px，改為 15px */
    
    border-bottom: 2px dashed #e0ddd7;
    padding-bottom: 25px;
}

/* 篇名樣式 */
.detail-title-text {
    font-size: 2.4rem;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    margin-bottom: 20px; /* 與作者名的距離 */
    line-height: 1.4;
    text-align: center;
}

/* 作者名專屬容器 (修訂需求一) */
.detail-author-box {
    display: inline-block;
    padding: 8px 25px;
    background-color: #f5f5f5;      /* 淺灰底色 */
    border-radius: 4px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    /* 已移除 border-left 色條 */
}

.detail-author-text {
    color: #5d4037;
    font-size: 1.1rem;
    font-weight: bold;
    letter-spacing: 1px;
}
/* 日期樣式 */
.detail-date {
    margin-top: 10px;
    color: #9e9e9e;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

/* 手機版適配 */
@media (max-width: 600px) {
read-mode-container {
        /* 1. 容器寬度：維持 90%，讓螢幕左右兩側有空隙 */
        width: 90% !important;
        
        /* 2. 內部間距：由 20px 增加至 30px，解決文字太貼邊的問題 */
        padding: 60px 30px 40px 30px !important; 
        
        background-image: none; /* 手機版移除格線 */
        
        /* 確保長單字不會撐爆容器 */
        overflow-wrap: break-word; 
    }
    
    .detail-title-text { font-size: 1.8rem; }
    .detail-author-box { padding: 6px 20px; }
}



/* 3. 作者標籤容器微調 */
.list-author-tag {
    margin-top: 10px;       /* 與上方標題保持距離 */
    display: inline-block;
    padding: 4px 12px;
    background-color: #f5f5f5;
    color: #8d6e63;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: bold;
    /* 無色條 */
}

/* 4. 日期樣式：固定在右側 */
.article-item-date {
    white-space: nowrap;    /* 日期不換行 */
    flex-shrink: 0;         /* 確保日期不會被壓縮 */
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    color: #aaa;
}

/* 手機版微調 */
@media (max-width: 600px) {
    .article-item {
        align-items: flex-start !important; /* 手機版日期靠上對齊比較好看 */
    }
    .article-item-date {
        margin-top: 5px; /* 對齊標題 */
        font-size: 0.8rem;
    }
}



/* === 極致緊湊版：賞析樣式 === */

/* 1. 外層容器 */
.analysis-container {
    /* ↓↓↓ 修改這兩行：增加與上方分隔線的距離 ↓↓↓ */
    margin-top: 40px !important;    /* 增加外部間距，讓分隔線與上方正文分開 */
    padding-top: 40px !important;   /* 關鍵：增加內部間距，讓標題遠離分隔線 */
    
    border-top: 1px dashed #d1cdc5; /* 建議改為虛線 dashed，視覺上較輕盈，也不會那麼壓迫 */
    position: relative;
}
	
/* 2. 賞析標題 */
.analysis-header {
    text-align: center;
    font-size: 1.4rem;
    font-weight: bold;
    color: #8d6e63;
    
   /* ↓↓↓ 確保下方無多餘留白 ↓↓↓ */
    margin-bottom: 5px !important; 
    padding-bottom: 0 !important;
    line-height: 1.2; 
    
    letter-spacing: 2px;
 
}

/* 標題上方的裝飾符號 */
.analysis-header::before {
    content: '✦';
    display: block;
    font-size: 1.2rem;
    color: #b6a6ca;
    margin-bottom: 5px; 
}

/* 3. 賞析內容本體 */
.analysis-body {
    font-size: 1.15rem;
    line-height: 30px;
    text-align: justify;
    white-space: pre-wrap;
    color: #4a4a4a;
    background-color: transparent;
    padding: 0;
    border: none;
    
    /* ★★★ 修改 2：移除容器頂部留白 ★★★ */
    margin-top: 0;
}

/* ★★★ 修改 3 (最關鍵)：強制移除「第一段文字」的預設上邊距 ★★★ */
/* 瀏覽器通常會給 p 標籤預設約 20px 的上邊距，這裡把它改成 5px */
.analysis-body p:first-child {
    margin-top: 0px !important; 
}

/* 其他段落保持間距 */
.analysis-body p {
    margin-bottom: 2em;
}

/* 最後一段移除下邊距 */
.analysis-body p:last-child {
    margin-bottom: 0;
}

/* 手機版微調 */
@media (max-width: 600px) {
    .analysis-body {
       font-size: 1.15rem; /* <--- 修改數值，原為 1rem */
        line-height: 1.8;
    }
}


/* ========================================= */
/* === [修訂 V5] 1. 側邊選單主頁鍵 (無背景 / 預設綠色) === */
/* ========================================= */
#sideMenuHomeBtn {
    /* 1. 完全無背景、無邊框 */
    background-color: transparent !important; 
    border: none !important; 
    box-shadow: none !important; 
    
    margin-top: 10px;
    margin-bottom: 10px;
    transition: transform 0.3s ease; /* 設定動態縮放效果 */
}

/* --- 圖案 (Icon) 預設狀態 --- */
#sideMenuHomeBtn i {
    /* 2. 預設就是莫蘭迪綠 */
    color: #2C92B8 !important; 
    font-size: 26px; /* 稍微加大一點，因為沒有背景襯托 */
    transition: all 0.3s ease;
}

/* --- 懸停狀態 (Hover) --- */
#sideMenuHomeBtn:hover {
    background-color: transparent !important; /* 保持無背景 */
    transform: scale(1.2); /* 3. 滑鼠移上去時，圖案放大 20% */
}

#sideMenuHomeBtn:hover i {
    /* 4. 懸停時增加亮度與光暈，產生「通電」的感覺 */
    filter: brightness(1.2);
    text-shadow: 0 0 12px rgba(143, 163, 152, 0.8);
}

/* 同步文字顏色 (若有顯示) */
#sideMenuHomeBtn span {
    color: #2C92B8 !important;
}


/* ========================================= */
/* === [修訂 V2] 2. 閱讀進度條 (加粗版) === */
/* ========================================= */
#readingProgressBarContainer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    
    /* ↓↓↓ 修改：由 4px 加粗至 10px ↓↓↓ */
    height: 10px; 
    
    background: transparent;
    z-index: 25002;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}

#readingProgressBar {
    height: 100%;
    width: 0%;
    
    /* 無印風米色漸層：由 淺棉麻色(#EBE5D5) 到 牛皮紙色(#D3C4AC) */
    background: linear-gradient(90deg, #EBE5D5, #D3C4AC) !important;
    
    /* 陰影改為暖棕灰色，讓它在白紙上浮起但不過於刺眼 */
    box-shadow: 0 0 10px rgba(211, 196, 172, 0.8); 
    
    border-radius: 0 5px 5px 0;
    transition: width 0.1s ease-out;
}
	
	
/* === [標題自動縮放] 專用樣式 === */
/* === [標題自動縮放] 修正版樣式 === */
.auto-fit-title {
    display: block;
    width: 100%;
    white-space: nowrap;      /* 初始狀態：強制單行 (為了讓 JS 計算寬度) */
    overflow: hidden;         /* 初始狀態：隱藏溢出 (避免計算時出現滾動條) */
    text-overflow: clip;      /* ★★★ 關鍵：不要顯示省略號 (...) ★★★ */
    transition: font-size 0.1s ease;
}

/* 這是 JS 判斷需要換行時會加入的 class */
.auto-fit-wrap {
    white-space: normal !important;    /* 允許換行 */
    overflow: visible !important;      /* 顯示完整內容 */
    line-height: 1.4 !important;       /* 換行後的行距 */
}


/* === [新增] 慢讀功能專用樣式 === */

/* 1. 文萃詳情頁右上角的按鈕群組 (水平排列版) */
.detail-action-group {
    position: fixed;
    top: 20px;
    right: 25px;
    z-index: 25001;
    display: flex;
    flex-direction: row; /* ★★★ 修改處：改為 row 即變成水平排列 ★★★ */
    align-items: center;
    gap: 15px;
}


.detail-float-btn {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    color: #8d6e63; /* 莫蘭迪深褐 */
    border: 1px solid #dcd6c8;
    font-size: 1.1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(5px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.detail-float-btn:hover {
    background-color: #8fa398; /* 莫蘭迪綠 */
    color: white;
    transform: scale(1.1);
    border-color: #8fa398;
}

/* 關閉鍵特別樣式 (豆沙紅) */
.detail-float-btn.close-mode:hover {
    background-color: #d69a92;
    border-color: #d69a92;
    transform: rotate(-90deg);
}

/* 2. 慢讀全螢幕覆蓋層 */
#slowReaderOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: #f4f1ea; /* 慢讀專用暖米色 */
    z-index: 30000; /* 最高層級 */
    display: none; /* 預設隱藏 */
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    touch-action: none; /* 禁止瀏覽器預設觸控 */
    user-select: none;
    -webkit-user-select: none;
}

/* 慢讀進度條 */
#reader-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 6px;
    background-color: #4a7c85; /* 莫蘭迪藍綠 */
    width: 0%;
    transition: width 0.6s ease-out;
    z-index: 30002;
}

/* 慢讀文字容器 */
#reader-display-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 80%;
    max-width: 800px;
    margin-top: 30vh;
    opacity: 1;
    transition: opacity 0.6s ease-in-out;
    pointer-events: none; /* 讓點擊穿透到底層 */
}

#reader-display-wrapper.fade-out {
    opacity: 0;
}

#reader-para-num {
    font-family: 'Courier New', monospace;
    font-size: 1.2rem;
    color: #8a7968;
    margin-bottom: 1.5rem;
    opacity: 0.6;
}

#reader-text {
    font-family: 'Noto Serif TC', serif;
    font-size: 2rem; /* 大字體 */
    line-height: 1.8;
    text-align: left;
    color: #3a3a3a;
    width: 100%;
}

/* 暫停提示 */
#reader-pause-indicator {
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9rem;
    color: #4a7c85;
    border: 1px solid #4a7c85;
    padding: 4px 12px;
    border-radius: 20px;
    opacity: 0;
    transition: opacity 0.3s;
    background-color: #f4f1ea;
    z-index: 30005;
}

/* 3. 設定視窗 (Settings Modal) */
#readerSettingsModal {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 26000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(3px);
}

.settings-card {
    background-color: #fdfcf8;
    padding: 25px;
    border-radius: 16px;
    border: 1px solid #e0ddd7;
    
    /* === 修改開始：手機版左右留白 === */
    width: 85%;          /* 手機上只佔 85% 寬度，左右自動留空 */
    max-width: 320px;    /* 電腦版限制最大寬度，不讓它變得太寬 */
    margin: 0 auto;      /* 確保置中 */
    /* === 修改結束 === */
    
    text-align: center;
    box-shadow: 0 10px 30px rgba(141, 110, 99, 0.15);
}

.timer-adjuster {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
}

.timer-display {
    font-family: 'Noto Serif TC', serif;
    font-size: 2.5rem;
    font-weight: bold;
    color: #5e7067;
    width: 60px;
}

.timer-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid #dcd6c8;
    background: transparent;
    color: #8a7968;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.2s;
}

.timer-btn:hover {
    background-color: #8fa398;
    color: white;
    border-color: #8fa398;
}

/* 手機適配 */
@media (max-width: 600px) {
    #reader-text { font-size: 1.6rem; }
    #reader-display-wrapper { margin-top: 25vh; }
    .detail-action-group {
        top: 15px;
        right: 15px;
        gap: 10px; /* 手機上縮小按鈕間距 */
    }
}


/* 設定按鈕群組的過渡動畫 */
.detail-action-group {
    transition: transform 0.3s ease, opacity 0.3s ease;
    /* 確保初始狀態可見 */
    opacity: 1;
    transform: translateY(0);
}

/* 當加上 hidden class 時的狀態 */
.detail-action-group.hidden {
    opacity: 0; /* 變透明 */
    transform: translateY(-20px); /* 往上滑出 */
    pointer-events: none; /* 隱藏時禁止點擊，防止誤觸 */
}


/* === 書籤功能專用樣式 === */

/* ========================================= */
/* === [新設計] 書籤功能專用樣式 (琥珀糖色) === */
/* ========================================= */

/* 定義新變數：莫蘭迪琥珀糖色 */
:root {
    /* 您可以在這裡修改 #E0B0A8 為其他顏色 */
    /* 推薦色碼：#E0B0A8 (柔粉), #B5C9C3 (淡灰綠), #C9B8B5 (藕粉灰) */
    --bookmark-color: #E0B0A8; 
}

/* --- 1. 主頁列表旁的過濾按鈕 --- */

/* 狀態 A: 未點擊 (預設) */
/* 只有淡淡的灰色邊框，看起來很乾淨 */
.bookmark-list-btn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background-color: #fff;      /* 白底 */
    border: 2px solid #e0e0e0;   /* 極淡灰邊框 */
    color: #ccc;                 /* 極淡灰圖示 */
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: none;            /* 預設無陰影 */
}

/* 狀態 B: 懸停 (滑鼠移上去) */
/* 邊框和圖示變色，提示用戶可以點擊，但背景仍是白的 */
.bookmark-list-btn:hover {
    border-color: var(--bookmark-color);
    color: var(--bookmark-color);
    transform: translateY(-2px);
    background-color: #fff;
}

/* 狀態 C: 點擊後 (激活模式) */
/* 填滿顏色，變成實心，再次點擊移除此 class 就會變回狀態 A */
.bookmark-list-btn.active-mode {
    background-color: var(--bookmark-color) !important;
    border-color: var(--bookmark-color) !important;
    color: white !important;
    box-shadow: 0 4px 12px rgba(224, 176, 168, 0.4); /* 淡淡的同色系光暈 */
    transform: scale(1.05);
}


/* --- 2. 文章詳情頁右上角的懸浮按鈕 --- */

/* 狀態 A: 未收藏 (預設) */
/* 繼承原有的 .detail-float-btn 樣式 (白底、灰框) */
/* 這裡只需微調它的 hover 行為 */

/* 狀態 B: 懸停 (未收藏時) */
/* 只有圖示變色，提示這是書籤功能 */
#detailBookmarkBtn:not(.bookmarked):hover {
    border-color: var(--bookmark-color);
}
#detailBookmarkBtn:not(.bookmarked):hover i {
    color: var(--bookmark-color);
}

/* 狀態 C: 點擊後 (已收藏) */
/* 填滿顏色，再次點擊 JS 會移除 .bookmarked，自動變回狀態 A */
.detail-float-btn.bookmarked {
    background-color: var(--bookmark-color) !important;
    border-color: var(--bookmark-color) !important;
    color: white !important;
    box-shadow: 0 0 15px rgba(224, 176, 168, 0.5); /* 柔和光暈 */
    transform: scale(1.1);
}

/* 已收藏狀態下的懸停 (稍微加深一點點或保持原狀) */
.detail-float-btn.bookmarked:hover {
    opacity: 0.9;
    transform: scale(1.15); /* 讓用戶感覺到可以點擊取消 */
}
	
/* ========================================= */
/* === [修復] 書籤按鈕顏色邏輯 === */
/* ========================================= */

/* 1. 未收藏狀態的 Hover：強制白底 + 琥珀色圖示 (覆蓋原本的綠底) */
#detailBookmarkBtn:not(.bookmarked):hover {
    background-color: #fff !important;       /* 強制保持白底 */
    color: var(--bookmark-color) !important; /* 圖示變琥珀色 */
    border-color: var(--bookmark-color) !important;
    transform: scale(1.1);
}

/* 2. 已收藏狀態的 Hover：保持琥珀色底 (稍微變深或透明度變化) */
#detailBookmarkBtn.bookmarked:hover {
    background-color: var(--bookmark-color) !important; /* 保持琥珀色底 */
    color: white !important;
    border-color: var(--bookmark-color) !important;
    opacity: 0.9; /* 輕微視覺回饋 */
}

/* ========================================= */
/* === [新增] 討論區大按鈕樣式 === */
/* ========================================= */
.big-chat-trigger-btn {
    background-color: #8fa398; /* 莫蘭迪灰綠 */
    color: white;
    border: none;
    width: 70px;  /* 設定寬度 */
    height: 70px; /* 設定高度 (正方形) */
    border-radius: 50%; /* 變成圓形 */
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(143, 163, 152, 0.4);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 32px; /* 圖示大小 */
    margin-bottom: 20px;
}

.big-chat-trigger-btn:hover {
    transform: scale(1.15) rotate(15deg); /* 懸停時放大並旋轉 */
    box-shadow: 0 8px 25px rgba(143, 163, 152, 0.6);
    background-color: #7d9186; /* 稍微變深 */
}

/* --- 議論指引：莫蘭迪藝術化排版 --- */
/* --- 議論指引：精煉版莫蘭迪排版 --- */
.morandi-guide-container {
    padding: 10px 0;
    font-family: 'Noto Serif TC', serif;
}
 
.guide-section-card {
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 8px; /* 圓角稍微縮小，顯得更乾淨 */
    margin-bottom: 20px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
}
 
.guide-card-header {
    background-color: #8fa398; /* 莫蘭迪灰綠 */
    color: white;
    padding: 12px 20px;
    font-size: 1.15rem; /* 標題縮小 */
    font-weight: bold;
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    gap: 8px;
}
 
.guide-card-body {
    padding: 20px 25px; /* 縮減內邊距 */
    color: #4a4a4a;
    
    /* 核心修訂：更紮實的行距與字體 */
    line-height: 1.6 !important;
    font-size: 1.1rem !important;
    letter-spacing: 1px !important;
    text-align: justify;
}
 
/* 針對內容中的段落增加微量間距 */
.guide-card-body br {
    content: "";
    display: block;
    margin: 8px 0;
}
 
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Live2D 畫布 */
#live2d-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483647; 
    pointer-events: none !important;
    touch-action: none; 
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    -webkit-user-select: none;
    display: none; 
}

/* Q 彈動畫 */
@keyframes cat-jelly {
    0% { transform: scale(1, 1); }
    30% { transform: scale(1.1, 0.9); }
    40% { transform: scale(0.9, 1.1); }
    50% { transform: scale(1.05, 0.95); }
    75% { transform: scale(0.98, 1.02); }
    100% { transform: scale(1, 1); }
}

.cat-active-click {
    animation: cat-jelly 0.4s cubic-bezier(0.25, 1, 0.5, 1); 
    filter: brightness(1.1);
}

/* --- 對話氣泡樣式 (常駐型) --- */
.cat-speech-bubble {
    position: fixed;
    background-color: rgba(255, 255, 255, 0.95);
    border: 2px solid #8fa398; /* 莫蘭迪綠 */
    border-radius: 12px;
    padding: 15px;
    color: #5d4037;
    font-family: 'Noto Serif TC', serif;
    font-size: 1rem;
    line-height: 1.6;
    max-width: 240px; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    z-index: 2147483648; 
    pointer-events: auto; /* 允許選取文字 */
    opacity: 0;
    transform: translateY(10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    word-wrap: break-word;
}

.cat-speech-bubble.show {
    opacity: 1;
    transform: translateY(0) scale(1);
}

/* 氣泡小箭頭 */
.cat-speech-bubble::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 8px 8px 0;
    border-style: solid;
    border-color: #8fa398 transparent transparent transparent;
}

/* 載入中的省略號 */
.cat-loading-dots::after {
    content: ' .';
    animation: dots 1.5s steps(5, end) infinite;
}
@keyframes dots {
    0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);}
    40% { color: #5d4037; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);}
    60% { text-shadow: .25em 0 0 #5d4037, .5em 0 0 rgba(0,0,0,0);}
    80%, 100% { text-shadow: .25em 0 0 #5d4037, .5em 0 0 #5d4037;}
}

/* 游標樣式 */
body.cat-hovering { cursor: grab !important; }
body.cat-dragging { cursor: grabbing !important; }

/* 其他樣式 */
.report-option-icon { font-size: 2.5rem; margin-bottom: 10px; }
.cat-sub-menu { display: flex; justify-content: space-around; padding: 10px 5px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; margin: 5px 10px; animation: fadeIn 0.3s ease; }
.cat-option { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s; background: rgba(255, 255, 255, 0.1); }
.cat-option:hover { transform: scale(1.2); background: rgba(255, 255, 255, 0.3); }
.cat-option i { color: #d69a92; font-size: 14px; }

#fullArticleBody b, #fullArticleBody strong {
    font-weight: 900 !important; 
    color: #2c3e50; 
}


/* === 分頁跳轉輸入框樣式 === */
.page-jump-input {
    width: 50px;
    text-align: center;
    border: none;
    border-bottom: 2px solid #8fa398; /* 莫蘭迪綠底線 */
    background: transparent;
    color: #5d4037;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 1rem;
    padding: 0;
    margin: 0;
    outline: none;
}

/* 讓一鍵回首頁按鈕與其他按鈕風格一致，但稍微小一點 */
#firstPageBtn {
    font-size: 0.9rem !important;
    opacity: 0.7;
}
#firstPageBtn:hover {
    opacity: 1;
    background-color: transparent !important; /* 保持無背景，只變色 */
    color: #2A9689 !important;
    transform: scale(1.1);
}


/* === 文萃分頁過渡特效 === */

/* 列表容器的過渡狀態 */
#articleListContainer {
    transition: opacity 0.3s ease, transform 0.3s ease;
    min-height: 300px; /* 保持最小高度，防止換頁時頁面塌陷 */
}

/* 退場狀態：透明且稍微下沉 */
.list-fade-out {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none; /* 防止動畫中誤觸 */
}

/* 進場狀態：不透明且歸位 */
.list-fade-in {
    opacity: 1;
    transform: translateY(0);
}

/* 轉場期間的 Loading 容器 */
.pagination-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 200px;
    color: #8fa398; /* 莫蘭迪綠 */
    font-family: 'Noto Serif TC', serif;
    animation: fadeIn 0.2s ease;
}

/* 轉圈圈特效 */
.pagination-spinner {
    font-size: 2rem;
    margin-bottom: 15px;
    animation: spin 1s linear infinite;
}

@keyframes spin { 100% { transform: rotate(360deg); } }

	
/* ========================================= */
/* === [修改] 已讀文章樣式 (暖灰岩色風格) === */
/* ========================================= */
 
/* 1. 已讀狀態的卡片背景 */
.article-item.read {
    /* 使用全新的莫蘭迪暖灰岩色，代表「已閱/存檔」的感覺 */
    background-color: #F0EBE5 !important;
    
    /* 左側加上一條低調的卡其色邊線，增強識別度 */
    border-left: 5px solid #A89F91 !important;
    
    /* 稍微降低整體不透明度，讓未讀的文章在視覺上更突出 */
    opacity: 0.9;
}
 
/* 2. 已讀狀態下的滑鼠懸停效果 */
.article-item.read:hover {
    background-color: #E6DFD7 !important; /* 懸停時稍微變深 */
    transform: translateX(5px); /* 保持原本的位移效果 */
}
 
/* 3. 純勾號圖示樣式 */
.read-icon-only {
    color: #A89F91; /* 與邊線同色 (莫蘭迪深卡其) */
    font-size: 1rem;
    margin-left: 8px;
    opacity: 0.8;
}


/* ========================================= */
/* === [修訂 V3] 專注監察功能 (Flex流變形版) === */
/* ========================================= */
 
/* 按鈕基礎過渡 (加入 transform 以便平滑縮放) */
#focusMonitorBtn {
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1),
                width 0.3s ease,
                height 0.3s ease,
                background-color 0.3s ease,
                border-radius 0.3s ease;
    
    /* 確保按鈕在 Flex 容器中不會被壓縮 */
    flex-shrink: 0;
}
 
/* 狀態一：綠燈 (監察中 - 莫蘭迪灰綠) */
.focus-status-green {
    background-color: #8fa398 !important;
    color: white !important;
    border-color: #8fa398 !important;
    box-shadow: 0 0 15px rgba(143, 163, 152, 0.6) !important;
}
 
/* 狀態二：橙燈 (閒置警告 - 莫蘭迪陶土色) */
.focus-status-orange {
    background-color: #e6b49d !important;
    color: white !important;
    border-color: #e6b49d !important;
    box-shadow: 0 0 15px rgba(230, 180, 157, 0.6) !important;
    animation: monitor-breath 2s infinite ease-in-out;
}
 
/* 狀態三：紅燈 (入睡/失神警告 - 莫蘭迪豆沙紅) */
.focus-status-red {
    background-color: #d69a92 !important;
    color: white !important;
    border-color: #d69a92 !important;
    box-shadow: 0 0 20px rgba(214, 154, 146, 0.9) !important;
    animation: monitor-pulse 0.5s infinite;
}
 
/* === [核心] 極低調變形模式 (原地變身) === */
#focusMonitorBtn.minimized {
    /* 強制變為小圓點 */
    width: 14px !important;
    height: 14px !important;
    min-height: 0 !important;
    padding: 0 !important;
    
    /* 移除文字與邊框，僅保留色塊 */
    border: 2px solid rgba(255, 255, 255, 0.9) !important;
    border-radius: 50% !important;
    
    /* 禁止點擊 (變為純指示燈) */
    pointer-events: none !important;
    opacity: 1 !important;
    cursor: default !important;
    box-shadow: none !important;
    
    /* 確保在 Flex 容器中顯示 (覆蓋可能繼承的 display:none) */
    display: flex !important;
    
    /* 垂直置中 (防止 Flex 內容拉伸導致變形) */
    margin-top: auto;
    margin-bottom: auto;
}
 
/* 在極低調模式下，隱藏內部的眼睛/鈴鐺圖示 */
#focusMonitorBtn.minimized i {
    display: none !important;
}
 
/* 紅燈在低調模式下依然閃爍 */
#focusMonitorBtn.minimized.focus-status-red {
    box-shadow: 0 0 10px rgba(214, 154, 146, 0.8) !important;
    animation: monitor-pulse 0.5s infinite;
}
 
/* 動畫 Keyframes */
@keyframes monitor-breath {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.9; }
    100% { transform: scale(1); opacity: 1; }
}
 
@keyframes monitor-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}


/* === [修訂 V7] 慢讀專用：右緣全高防睡燈 (寬度 12px 版) === */

/* === [修訂 V8] 慢讀專用：防睡燈 (85% 高度 + 圓角版) === */
 
#slowReaderFocusIndicator {
    position: fixed;
    
    /* --- 修改開始：改為垂直置中，高度 85% --- */
    top: 50% !important;           /* 定位到中間 */
    transform: translateY(-50%);   /* 向上修正 50% 以達成絕對垂直置中 */
    height: 85% !important;        /* 設定高度為 85% */
    bottom: auto !important;       /* 取消原本的拉伸設定 */
    /* --- 修改結束 --- */
 
    right: 0;
    width: 12px;
    
    /* 確保最上層 */
    z-index: 2147483647;
    
    display: none;
    padding: 0;
    margin: 0;
    border: none;
    
    /* --- 修改開始：左側圓角處理 (像一個膠囊貼在右邊) --- */
    border-radius: 12px 0 0 12px !important;
    /* --- 修改結束 --- */
 
    background-color: transparent;
    cursor: pointer;
    
    /* 預設不攔截點擊，但在 prompting 狀態會開啟 */
    pointer-events: none;
    
    transition: background-color 0.4s ease, box-shadow 0.4s ease;
}

/* 狀態一：綠燈 (監察中 - 靜謐灰綠) */
#slowReaderFocusIndicator.status-green {
    background-color: #8FA398 !important; 
    opacity: 0.75; 
    box-shadow: -1px 0 4px rgba(143, 163, 152, 0.4); 
    
    width: 12px;     /* ★ 修改：同步加寬 ★ */
    pointer-events: auto; 
}
#slowReaderFocusIndicator.status-green:hover {
    opacity: 1; 
    background-color: #7D9186 !important; 
}

/* 狀態二：橙燈 (180秒 - 暖陶土色) */
#slowReaderFocusIndicator.status-prompt {
    background-color: #DE9981 !important; 
    pointer-events: auto;
    opacity: 1;
    
    width: 12px;     /* ★ 修改：同步加寬 ★ */
    
    box-shadow: -2px 0 15px rgba(217, 136, 109, 0.8); 
    animation: full-height-pulse 2s infinite ease-in-out;
}
/* 擴大點擊感應區 (保持不變) */
#slowReaderFocusIndicator.status-prompt::after {
    content: ''; position: absolute; top: 0; left: -40px; right: 0; bottom: 0;
}

/* 狀態三：紅燈 (210秒 - 鐵鏽紅) */
#slowReaderFocusIndicator.status-red {
    background-color: #C96055 !important; 
    pointer-events: auto;
    opacity: 1;
    
    width: 12px;     /* ★ 修改：同步加寬 ★ */
    
    box-shadow: -3px 0 25px rgba(201, 96, 85, 0.9);
    animation: full-height-flash 0.5s infinite;
}

/* 動畫定義 */
@keyframes full-height-pulse {
    0% { opacity: 0.8; box-shadow: -1px 0 8px rgba(217, 136, 109, 0.5); }
    50% { opacity: 1; box-shadow: -3px 0 20px rgba(217, 136, 109, 0.9); }
    100% { opacity: 0.8; box-shadow: -1px 0 8px rgba(217, 136, 109, 0.5); }
}

@keyframes full-height-flash {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}
	
	
