/* ========================================= */
/* === ANIMATIONS.CSS - Keyframes & Transitions === */
/* ========================================= */
/*
 * This file contains:
 * - All @keyframes definitions
 * - Transition effects
 * - Animation utility classes
 * - Hover and interaction animations
 * - Loading and progress animations
 * - Page transition effects
 * 
 * Extracted from index2.html lines 441-7625
 */

/* ========================================= */
/* === ANIMATIONS.CSS - Keyframes & Transitions === */
/* ========================================= */

/* === 背景動畫效果 === */
/* 晴天效果：太陽 */
.sun {
    position: absolute;
    top: 10%;
    left: 5%; /* 調整為靠左 */
    width: 100px;
    height: 100px;
    background-color: yellow;
    border-radius: 50%;
    box-shadow: 0 0 20px yellow;
    animation: sunGlow 2s infinite alternate;
    z-index: -1; /* 確保太陽在其他元素下方，避免遮擋按鍵 */}

/* 太陽光芒動畫 */
@keyframes sunGlow {
    0% { box-shadow: 0 0 20px yellow;}

/* 多雲效果：雲朵 */
.cloud {
    position: absolute;
    background-color: white;
    border-radius: 50%;
    opacity: 0.8;
    animation: cloudMove linear infinite;}

@keyframes cloudMove {
    0% { transform: translateX(-100vw);}

/* 下雨效果：雨滴 */
.raindrop {
    position: absolute;
    width: 2px;
    height: 10px;
    background-color: #ADD8E6; /* 淺藍色，更自然 */
    opacity: 0.7; /* 增加透明度 */
    animation: rainFall linear infinite;}

@keyframes rainFall {
    0% { transform: translateY(-10px);}

/* 下雪效果：雪花 */
.snowflake {
    position: absolute;
    background-color: #e0f7fa;
    border-radius: 50%;
    opacity: 0.7;
    animation: snowfall linear infinite;}

@keyframes snowfall {
    0% { top: -10px; transform: translateX(0);}

.title-text {
    display: block;
    font-size: 3rem;
    color: #d1f2eb;
    text-shadow: 3px 3px 0 #7f8c8d;
    letter-spacing: 4px;
    animation: titleFloat 3s ease-in-out infinite;}

/* === 動畫 === */
@keyframes fadeIn {
    from { opacity: 0;}

.tool-btn {
    animation: fadeIn 0.2s ease-in-out forwards;
    opacity: 0;}

.btn-category {
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    background-color: rgba(142, 142, 147, 0.7); /* 半透明灰色 */
    color: white;
    backdrop-filter: blur(5px);
    margin: 0; /* 重置 margin */}

/* 隱藏 (箭頭) 按鈕樣式 */
#music-player .hide-btn { 
    background: none; 
    border: none; 
    color: #aaa; 
    font-size: 18px; 
    cursor: pointer; 
    margin-left: 15px; 
    transition: color 0.3s;
    padding: 5px;}

.main-container {
    max-width: 1200px;
    width: 100%;
    position: relative;
    opacity: 0;
    transition: opacity 0.5s ease-in;}

#video-tour-btn .icon {
    width: 24px;
    height: 24px;
    fill: var(--primary-color);
    transition: fill 0.3s;}

.node {
    display: flex;
    align-items: center;
    text-align: center;
    padding: 8px 12px;
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    box-shadow: 0 3px 12px var(--shadow-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;}

@keyframes dash {
    to { stroke-dashoffset: -20;}

.yuyilu-grades {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
    max-height: 500px;
    overflow: hidden;
    transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
    opacity: 1;}

.preview-close-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255, 255, 255, 0.7);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s, color 0.3s;
    z-index: 2010;}

.preview-goto-btn {
    background: #007bff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='18px' height='18px'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z'/%3E%3C/svg%3E") no-repeat 15px center;
    background-size: 18px 18px;
    color: white;
    padding: 10px 20px 10px 40px;
    border: none;
    border-radius: 20px;
    text-decoration: none;
    font-size: 1rem;
    font-weight: bold;
    transition: background-color 0.3s;
    cursor: pointer;
    flex-shrink: 0; /* 防止按鈕縮小 */}

.btn {
    padding: 8px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    color: white;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    border: 3px solid transparent;
    background-color: #8E8E93; /* 中性灰 */}

.btn-icon-action {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    color: white;
    font-size: 16px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.2s ease-in-out;
    margin: 0;}

/* --- 確認圖示按鍵 --- */
.btn-icon-confirm {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-color: #28a745;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease-in-out;}

/* 單個氣泡 */
.message-bubble {
    padding: 18px 22px; /* 增加氣泡內白，文字不貼邊 */
    border-radius: 18px;
    line-height: 1.8; /* 關鍵：增加行距，文字不再緊湊 */
    font-size: 1.05rem; /* 字體微調大 */
    word-wrap: break-word;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    max-width: 88%; /* 稍微放寬最大寬度 */
    animation: fadeIn 0.3s ease-in-out;
    position: relative;}

.books-modal .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 25px;
    border: 1px solid #888;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    animation: fadeIn 0.4s;}

/* --- 執行動作按鈕 --- */
.btn-action {
    display: inline-block;
    padding: 10px 20px;
    margin: 15px 0 5px 0;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    font-family: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    color: white;
    background-color: rgba(31, 122, 85, 0.8);
    backdrop-filter: blur(5px);
    text-align: center;
    text-decoration: none;}

/* === 懸浮視窗容器設定 (修訂版：限制高度防止爆版) === */
.outline-modal-content {
    background-color: #fdfdfd;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 900px;       /* 稍微加寬，讓電腦版視野更好 */
    max-height: 90vh;       /* 關鍵：限制高度最多佔螢幕 90% */
    position: relative;
    animation: fadeIn 0.3s;
    display: flex;          /* 使用 Flexbox 排版 */
    flex-direction: column; /* 垂直排列子元素 */
    box-sizing: border-box; /* 確保 padding 不會撐大寬度 */}

.step-card {
    background-color: #f7f9fc;
    border-radius: 8px;
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;}

.score-item .progress-bar-fill {
    height: 100%;
    width: 0%;
    background-color: #007bff;
    border-radius: 6px;
    transition: width 0.4s ease-in-out;}

.btn-save-html {
    position: static;
    margin-top: 20px;
    width: 40px;
    height: 40px;
    background-color: rgba(106, 122, 138, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    color: white;
    display: none;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 10;
    opacity: 0.85;
    transition: all 0.2s ease-in-out;
    padding: 0;
    margin-left: auto;
    margin-right: auto;}

.scope-label {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    user-select: none;
    border: 1px solid transparent;
    background-color: #f0f0f0;
    color: #555;}

.anime-card {
    position: relative;
    width: 120px;
    height: 180px;
    border-radius: 15px;
    background-image: var(--bg-img);
    background-size: cover;
    background-position: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
    flex-shrink: 0;
    border: 1px solid rgba(255,255,255,0.2);
    filter: grayscale(30%);}

.card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.2) 60%, rgba(0,0,0,0) 100%);
    transition: all 0.3s ease;}

.card-border-effect {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 15px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    z-index: 5;
    box-sizing: border-box;}

.card-icon-container {
    font-size: 28px;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: auto;
    margin-top: 40px;
    transform: translateY(10px);
    transition: all 0.4s ease;
    opacity: 0.8;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);}

.card-text {
    text-align: center;
    transform: translateY(0);
    transition: transform 0.3s ease;}

.side-menu-overlay {
    position: fixed;
    top: 50%;
    right: -80px;
    transform: translateY(-50%);
    width: 60px;
    height: auto;
    background-color: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(10px);
    z-index: 9999;
    transition: right 0.3s ease;
    box-shadow: -4px 0 15px rgba(0, 0, 0, 0.5);
    border-radius: 12px 0 0 12px;
    padding: 10px 0;}

.side-menu-item {
    width: 100%;
    padding: 12px 0;
    background-color: transparent;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;}

/* ==========================================
   === 歷史紀錄卡片：Note Card 打洞風格 ===
   ========================================== */

.history-card {
    /* 1. 基礎卡片設定 */
    background-color: var(--morandi-bg);
    border: 1px solid var(--morandi-border); /* 統一使用細邊框 */
    border-radius: 8px; 
    padding: 20px;
    position: relative;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.03);
    transition: all 0.3s ease;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;

    /* 2. Note Card 關鍵樣式：打洞與分隔線 */
    padding-left: 55px !important; /* 左側留白給打洞區 */
    
    background-image: 
        /* A. 垂直分隔線 (模擬紅線或灰線，這裡用莫蘭迪灰 #e0ddd7) */
        linear-gradient(to right, transparent 39px, #e0ddd7 40px, transparent 41px),
        /* B. 打洞效果 (模擬孔洞，使用深灰色圓形 #d1cdc5) */
        radial-gradient(circle at 20px 50%, #d1cdc5 6px, transparent 7px);
    
    /* 設定背景圖層大小 */
    background-size: 
        100% 100%, /* 分隔線：撐滿整張卡片 */
        100% 35px; /* 打洞：每 35px 重複一顆 */
    
    /* 設定背景重複方式 */
    background-repeat: 
        no-repeat, /* 分隔線不重複 */
        repeat-y;  /* 打洞在垂直方向重複 */
        
    /* 設定起始位置 */
    background-position: 
        0 0,       /* 分隔線位置 */
        0 12px;    /* 打洞起始位置向下微調，避免切到頂部色條 */}

/* 操作區 (刪除按鈕) */
.history-actions {
    margin-top: 15px;
    display: flex;
    justify-content: flex-end;
    opacity: 0.6;
    transition: opacity 0.3s;}

.btn-delete-history {
    background-color: transparent;
    border: 1px solid #dc3545;
    color: #dc3545;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;}

.history-folder-btn {
    background-color: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #555;
    min-height: 100px; /* 確保按鈕有足夠高度 */}

/* 讓麵包屑導航更明顯 */
.history-breadcrumb {
    transition: all 0.3s ease;}

/* === 新增：標頭的低調清空按鈕 === */
.history-clear-btn {
    background: transparent;
    border: 1px solid transparent; /* 預設無邊框 */
    color: #aaa; /* 淺灰色，非常低調 */
    font-size: 1.2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;}

/* 刪除按鈕美化 */
.btn-delete-history {
    background: transparent;
    border: none;
    color: #bfaea8; /* 淺紅棕色 */
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    padding: 5px;
    border-radius: 50%;}

/* 搜尋到的卡片高亮動畫 */
@keyframes highlight-card {
    0% { transform: scale(1); box-shadow: 0 0 0 rgba(40, 167, 69, 0);}

.history-card.highlighted {
    animation: highlight-card 1.5s ease-in-out;
    background-color: #f0fff4; /* 淡淡的綠色背景 */}

/* === 歷史紀錄：標題原地編輯樣式 === */
.history-title {
    cursor: text; /* 提示用戶這是文字 */
    transition: background-color 0.2s;
    border-radius: 4px;
    padding: 2px 4px;
    margin: -2px -4px; /* 抵消 padding，保持位置不變 */}

/* === 新增：通用過渡動畫 === */
.fade-in-up {
    /* 使用 cubic-bezier 讓動畫更有質感，不是線性的死板移動 */
    animation: fadeUpEnter 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    opacity: 0; /* 預設隱藏，由動畫控制變為可見 */}

@keyframes fadeUpEnter {
    0% {
        opacity: 0;
        transform: translateY(15px) scale(0.98); /* 稍微縮小並向下偏移 */}

/* === 新增：頁面收縮退場動畫 === */
.page-exit-shrink {
    /* 0.4秒完成，使用 ease-in 讓開始慢結束快，感覺像被吸走 */
    animation: shrinkFadeOut 0.4s cubic-bezier(0.32, 0, 0.67, 0) forwards;
    transform-origin: center 20vh; /* 設定縮放中心點在視窗上方偏中，視覺更自然 */
    pointer-events: none; /* 動畫播放時禁止點擊，防止誤觸 */}

@keyframes shrinkFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);}

/* === 新增：主頁選單進場特效 (配合退場) === */
.home-enter-pop {
    animation: popIn 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    opacity: 0;}

@keyframes popIn {
    0% {
        opacity: 0;
        transform: scale(1.05); /* 主頁從稍微放大的狀態回復，產生景深感 */}

/* === 學生雲端中心：全新課業列表樣式 === */

/* =======================================================
   === 雲端中心：Note Card 打洞風格 (莫蘭迪色系 V3) ===
   ======================================================= */

/* 1. 基礎卡片構造 (Note Card) */
.task-card {
    /* 基礎紙張設定 */
    background-color: #fdfcf8;      /* 米白紙張底色 */
    border: 1px solid #e0ddd7;      /* 淺卡其細邊框 */
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    padding: 20px 15px 20px 55px;   /* 左側留白給打洞區 */
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.03); /* 復古硬陰影 */

    /* 關鍵：打洞與分隔線背景 */
    background-image: 
        /* A. 垂直分隔線 */
        linear-gradient(to right, transparent 39px, #e0ddd7 40px, transparent 41px),
        /* B. 打洞效果 (模擬孔洞) */
        radial-gradient(circle at 20px 50%, #d1cdc5 6px, transparent 7px);
    
    background-size: 
        100% 100%, /* 分隔線撐滿 */
        100% 35px; /* 打洞重複間距 */
    
    background-repeat: 
        no-repeat,
        repeat-y;
        
    background-position: 
        0 0,
        0 12px;}

/* === 三種狀態的配色 === */


/* === 老師評語專用樣式 (嵌入在歷史紀錄 UI 中) === */
.teacher-feedback-section {
    background-color: #fffaf5; /* 極淡的米暖色背景 */
    border: 2px solid #e6dace; /* 淺卡其/奶茶色邊框 */
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    position: relative;
    box-shadow: 0 4px 15px rgba(141, 110, 99, 0.08); /* 暖色系微陰影 */
    animation: slideDown 0.5s ease-out;}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-20px);}

.feedback-modal-content {
    background-color: #fff;
    width: 100%;
    max-width: 700px;
    max-height: 90vh;
    border-radius: 12px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    animation: fadeIn 0.3s ease-out;}

.feedback-close-btn {
    background: #e9ecef; /* 明顯的按鈕背景 */
    border: none;
    color: #555;
    font-size: 1.5rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;}

.original-work-summary {
    padding: 12px 15px;
    cursor: pointer;
    font-weight: bold;
    color: #555;
    background-color: #f1f1f1;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.2s;}

@keyframes pulse {
    0% { opacity: 0.6;}

/* 關閉按鈕樣式優化 (與語薈一致) */
#studentCloudModal .close-modal-btn {
    position: fixed !important;
    top: 25px !important;
    right: 25px !important;
    background-color: transparent !important;
    border: none !important;
    color: #333 !important;
    font-size: 2.5rem !important;
    width: auto !important;
    height: auto !important;
    line-height: 1 !important;
    z-index: 10060 !important;
    box-shadow: none !important;
    cursor: pointer;
    transition: color 0.3s;}

/* === 新增：莫蘭迪色系按鈕樣式 === */
.btn-morandi {
    /* 莫蘭迪暖棕色/陶土色，低飽和度，看起來舒服高級 */
    background-color: #a1887f !important; 
    background-image: linear-gradient(135deg, #bcaaa4 0%, #8d6e63 100%) !important;
    color: #fff !important;
    border: none !important;
    padding: 10px 20px !important;
    font-size: 1rem !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 10px rgba(141, 110, 99, 0.3) !important;
    transition: all 0.3s ease !important;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'Noto Serif TC', serif;}

/* === 加載動畫覆蓋層樣式 === */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 252, 245, 0.92); /* 米白色半透明背景 */
    backdrop-filter: blur(5px); /* 毛玻璃效果 */
    z-index: 99999; /* 確保在最上層 */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    flex-direction: column;
    animation: fadeIn 0.3s ease-in-out;}

.loading-text {
    font-family: 'Noto Serif TC', serif;
    /* 核心修改：自動縮放字體大小 */
    font-size: clamp(1.2rem, 5vw, 2.2rem); 
    font-weight: 700;
    color: #2A9689;
    
    /* 核心修改：不分行 */
    white-space: nowrap; 
    
    /* 核心修改：字距也改為動態，避免在小螢幕太撐 */
    letter-spacing: clamp(2px, 1vw, 6px); 
    
    text-shadow: 0 2px 10px rgba(42, 150, 137, 0.2);
    animation: pulseText 2s infinite ease-in-out;}

@keyframes pulseText {
    0% { opacity: 0.6; transform: scale(0.98);}

/* === 生成結果畫布專用樣式 === */
.result-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(245, 245, 243, 0.98); /* 接近語薈的米色底 */
    z-index: 30000; /* 確保在最頂層 */
    display: none; /* 預設隱藏 */
    overflow-y: auto;
    animation: fadeIn 0.4s ease-out;}

.result-canvas-close {
    background-color: #d9534f;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;}

/* === 新增：學生登出按鈕樣式 === */
.logout-icon-btn {
    background-color: #ef9a9a; /* 莫蘭迪淡紅色 */
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 10px; /* 與歡迎文字保持距離 */
    font-size: 14px;
    vertical-align: middle;}

.sansi-notification {
    pointer-events: auto;
    width: 300px;
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 12px;
    padding: 15px 15px 15px 50px; /* 增加左邊距給打洞區 */
    box-shadow: 0 15px 35px rgba(0,0,0,0.12);
    position: relative;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    animation: notifIn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    
    /* 強化原稿紙打洞風格 */
    background-image: radial-gradient(circle at 22px 50%, #d1cdc5 6px, transparent 7px);
    background-size: 100% 35px;
    background-repeat: repeat-y;}

@keyframes notifIn {
    from { opacity: 0; transform: translateX(80px) scale(0.9);}

/* 2. 紅點樣式 (呼吸燈效果) */
.notification-badge {
    display: none; /* 預設隱藏，由 JS 控制顯示 */
    position: absolute;
    top: 5px;          /* 距離頂部 */
    right: 5px;        /* 距離右邊 */
    width: 10px;
    height: 10px;
    background-color: #ff4444; /* 鮮豔紅 */
    border-radius: 50%;
    border: 2px solid #333;    /* 與深色背景區隔的邊框 */
    box-shadow: 0 0 5px rgba(255, 68, 68, 0.8);
    z-index: 100;
    pointer-events: none;      /* 讓紅點不影響點擊 */
    animation: badgePulse 2s infinite;}

/* 紅點呼吸動畫 */
@keyframes badgePulse {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7);}

/* === 學習報告專用樣式 (莫蘭迪簡約風) === */
.report-section {
    margin-bottom: 40px;
    animation: fadeIn 0.5s ease;}

/* ==========================================
   === 學習報告專用樣式 (V2 - 視覺分層版) ===
   ========================================== */

.report-section {
    margin-bottom: 50px; /* 增加間距，讓各範疇區隔更明顯 */
    animation: fadeIn 0.5s ease;}

.report-menu-content {
    background: #fdfcf8;
    width: 100%;
    max-width: 600px; /* 電腦版限制寬度 */
    border-radius: 20px 20px 0 0; /* 上方圓角 */
    padding: 30px 20px 50px 20px;
    box-shadow: 0 -5px 25px rgba(0,0,0,0.15);
    animation: slideUp 0.3s ease-out;
    border-top: 5px solid #8fa398;}

@keyframes slideUp {
    from { transform: translateY(100%);}

.report-option-card {
    background: white;
    border: 2px solid #e0ddd7;
    border-radius: 12px;
    padding: 25px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    color: #666;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;}

/* 2. 綜合評級 (突出的視覺設計) */
.overall-grade-tag {
    background-color: #fff;
    color: #d9534f; /* 醒目的等級紅 */
    padding: 5px 25px;
    border-radius: 50px;
    font-size: 1.4rem;
    font-weight: 900;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transform: scale(1);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 2px solid #d69a92; /* 莫蘭迪紅邊框 */
    display: flex;
    align-items: center;
    gap: 8px;}

/* 2. 結果畫布內的聊天室容器 (保持不變) */
.canvas-chat-container {
    margin-top: 50px;
    padding-top: 25px;
    border-top: 3px dashed #2A9689;
    animation: fadeIn 0.5s ease;
    background-color: #fcfdfd;
    padding-bottom: 20px;}

/* 發送按鈕 */
.canvas-send-btn {
    background-color: #2A9689;
    color: white;
    border: none;
    width: 55px;
    height: 55px;
    border-radius: 50%; /* 圓形 */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.2s;
    flex-shrink: 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);}

.vocab-item {
    background-color: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px 5px;
    text-align: center;
    
    /* 字體設定：確保與主體一致 */
    font-family: 'Noto Serif TC', 'Songti TC', serif !important;
    font-size: 1.1rem !important;
    font-weight: 500;
    color: #555;
    
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    transition: all 0.3s ease;
    cursor: default;
    
    /* 防止長詞彙溢出 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;}

/* ========================================= */
/* === 取消生成 UI (莫蘭迪色系設計) === */
/* ========================================= */
 
/* 1. 純圖示取消鍵 (低調圓形按鈕) */
.cancel-icon-btn {
    margin-top: 30px;
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: transparent;
    border: 1px solid rgba(143, 163, 152, 0.6); /* 莫蘭迪灰綠邊框 */
    color: #8fa398;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(2px);
    pointer-events: auto; /* 確保可以點擊 */}

/* 2. 確認視窗遮罩 (覆蓋在 Loading 之上) */
.morandi-modal-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.92); /* 米白遮罩，高模糊 */
    backdrop-filter: blur(8px);
    z-index: 20; /* 必須高於 loading-content */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;}

/* 3. 視窗卡片本體 */
.morandi-modal-card {
    background: #fffcf6; /* 暖白紙張色 */
    padding: 30px 35px;
    border-radius: 16px;
    border: 1px solid #e0ddd7;
    box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15); /* 暖色柔和陰影 */
    text-align: center;
    max-width: 85%;
    width: 340px;
    transform: translateY(0);
    animation: slideUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); /* 彈性動畫 */}

.morandi-btn {
    border: none;
    padding: 10px 24px;
    border-radius: 8px;
    font-size: 0.95rem;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    transition: transform 0.2s, filter 0.2s;}

/* 動畫定義 */
@keyframes slideUp {
    from { opacity: 0; transform: translateY(20px);}

/* === 全局莫蘭迪 Alert 樣式 (手機版邊距優化版) === */
.sansi-alert-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.6); /* 極淡米色遮罩 */
    backdrop-filter: blur(5px); /* 毛玻璃效果 */
    z-index: 2147483647; /* 最頂層 */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;}

.sansi-alert-box {
    background-color: #fdfcf8;
    border: 1px solid #e0ddd7;
    border-radius: 16px;
    box-shadow: 0 15px 40px rgba(141, 110, 99, 0.15);
    
    /* --- 關鍵修改開始 --- */
    width: auto;           /* 讓寬度自動適應，不強制固定 */
    max-width: 320px;      /* 電腦版最大限制寬度 */
    min-width: 260px;      /* 防止內容太少時縮得太小 */
    margin: 0 35px;        /* ★ 重點：手機版強制左右留白 35px，解決貼邊問題 */
    /* --- 關鍵修改結束 --- */

    padding: 25px;
    text-align: center;
    transform: translateY(20px);
    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    position: relative;
    background-image: linear-gradient(to right, transparent 29px, #f2f0eb 30px, transparent 31px);
    background-size: 100% 100%;}

.sansi-alert-btn {
    background-color: #8fa398;
    color: white;
    border: none;
    padding: 10px 30px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(143, 163, 152, 0.3);
    transition: all 0.2s ease;
    font-family: 'Noto Serif TC', serif;}

/* 2. 莫蘭迪懸浮儲存鍵 (純圖案設計) */
.morandi-save-float-btn {
    position: fixed;
    bottom: 50px;
    right: 50px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    
    /* 莫蘭迪灰綠漸層 */
    background: linear-gradient(135deg, #8fa398 0%, #7d9186 100%);
    color: white;
    
    border: none;
    box-shadow: 0 8px 25px rgba(143, 163, 152, 0.6);
    
    display: none; /* 預設隱藏 */
    align-items: center;
    justify-content: center;
    font-size: 1.6rem;
    cursor: pointer;
    z-index: 99999; /* 確保在最上層 */
    
    animation: floatPopIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transition: transform 0.2s ease, background 0.2s;}

@keyframes floatPopIn {
    from { opacity: 0; transform: scale(0);}

/* === 歷史紀錄操作按鈕區優化 === */
.history-actions {
    margin-top: 15px;
    display: flex;
    justify-content: flex-end;
    gap: 12px; /* 增加按鈕之間的間距 */
    opacity: 0.8; /* 稍微提高預設透明度，方便手機辨識 */
    transition: opacity 0.3s;}

/* 下載按鈕樣式 (莫蘭迪藍/灰色) */
.btn-download-history {
    background: transparent;
    border: 1px solid #94a7b5; /* 霧霾藍邊框 */
    color: #94a7b5;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;}

/* === 備用線路提示視窗 (響應式設計) === */
.backup-alert-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(253, 252, 248, 0.85); /* 米白高模糊遮罩 */
    backdrop-filter: blur(8px);
    z-index: 999999; /* 確保在最上層 */
    display: none; /* 預設隱藏 */
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;}

.backup-alert-icon {
    font-size: 3rem;
    color: #d69a92; /* 莫蘭迪紅，表示警示 */
    margin-bottom: 15px;
    animation: pulse 2s infinite;}

.backup-btn {
    border: none;
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 0.95rem;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Noto Serif TC', serif;
    transition: transform 0.2s;}

/* =======================================================
   === [新增] 閱卷員追問區 (畫布聊天室) 樣式 - 歷史紀錄專用 ===
   ======================================================= */

/* 1. 聊天室外層容器 */
.canvas-chat-container {
    margin-top: 40px;
    padding-top: 25px;
    border-top: 3px dashed #2A9689; /* 標誌性的綠色虛線 */
    background-color: #fcfdfd;
    padding-bottom: 20px;
    font-family: 'Noto Serif TC', serif;
    animation: fadeIn 0.5s ease;}

/* 2. 讓每一個資料區塊變成一張「卡片」 */
.history-parsed-container.argument-guide-layout .history-item-block {
    background-color: #fdfcf8; /* 米白底色 */
    border: 1px solid #e0ddd7; /* 莫蘭迪邊框 */
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    transition: transform 0.2s ease;}

/* 右上角懸浮返回鍵 */
.detail-back-btn {
    position: fixed;
    top: 20px;
    right: 25px;
    z-index: 25001; /* 比內容層更高 */
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.05);
    color: #666;
    border: 1px solid #ddd;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);}

/* === [標題自動縮放] 專用樣式 === */
/* === [標題自動縮放] 修正版樣式 === */
.auto-fit-title {
    display: block;
    width: 100%;
    white-space: nowrap;      /* 初始狀態：強制單行 (為了讓 JS 計算寬度) */
    overflow: hidden;         /* 初始狀態：隱藏溢出 (避免計算時出現滾動條) */
    text-overflow: clip;      /* ★★★ 關鍵：不要顯示省略號 (...) ★★★ */
    transition: font-size 0.1s ease;}

.detail-float-btn {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    color: #8d6e63; /* 莫蘭迪深褐 */
    border: 1px solid #dcd6c8;
    font-size: 1.1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(5px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);}

.timer-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid #dcd6c8;
    background: transparent;
    color: #8a7968;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.2s;}

/* 設定按鈕群組的過渡動畫 */
.detail-action-group {
    transition: transform 0.3s ease, opacity 0.3s ease;
    /* 確保初始狀態可見 */
    opacity: 1;
    transform: translateY(0);}

/* --- 1. 主頁列表旁的過濾按鈕 --- */

/* 狀態 A: 未點擊 (預設) */
/* 只有淡淡的灰色邊框，看起來很乾淨 */
.bookmark-list-btn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background-color: #fff;      /* 白底 */
    border: 2px solid #e0e0e0;   /* 極淡灰邊框 */
    color: #ccc;                 /* 極淡灰圖示 */
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: none;            /* 預設無陰影 */}

/* ========================================= */
/* === [新增] 討論區大按鈕樣式 === */
/* ========================================= */
.big-chat-trigger-btn {
    background-color: #8fa398; /* 莫蘭迪灰綠 */
    color: white;
    border: none;
    width: 70px;  /* 設定寬度 */
    height: 70px; /* 設定高度 (正方形) */
    border-radius: 50%; /* 變成圓形 */
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(143, 163, 152, 0.4);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 32px; /* 圖示大小 */
    margin-bottom: 20px;}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px);}

/* Q 彈動畫 */
@keyframes cat-jelly {
    0% { transform: scale(1, 1);}

.cat-active-click {
    animation: cat-jelly 0.4s cubic-bezier(0.25, 1, 0.5, 1); 
    filter: brightness(1.1);}

/* --- 對話氣泡樣式 (常駐型) --- */
.cat-speech-bubble {
    position: fixed;
    background-color: rgba(255, 255, 255, 0.95);
    border: 2px solid #8fa398; /* 莫蘭迪綠 */
    border-radius: 12px;
    padding: 15px;
    color: #5d4037;
    font-family: 'Noto Serif TC', serif;
    font-size: 1rem;
    line-height: 1.6;
    max-width: 240px; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    z-index: 2147483648; 
    pointer-events: auto; /* 允許選取文字 */
    opacity: 0;
    transform: translateY(10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    word-wrap: break-word;}

@keyframes dots {
    0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);}

.cat-sub-menu { display: flex; justify-content: space-around; padding: 10px 5px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; margin: 5px 10px; animation: fadeIn 0.3s ease;}

.cat-option { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s; background: rgba(255, 255, 255, 0.1);}

/* 轉場期間的 Loading 容器 */
.pagination-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 200px;
    color: #8fa398; /* 莫蘭迪綠 */
    font-family: 'Noto Serif TC', serif;
    animation: fadeIn 0.2s ease;}

/* 轉圈圈特效 */
.pagination-spinner {
    font-size: 2rem;
    margin-bottom: 15px;
    animation: spin 1s linear infinite;}

@keyframes spin { 100% { transform: rotate(360deg); }}

/* 狀態二：橙燈 (閒置警告 - 莫蘭迪陶土色) */
.focus-status-orange {
    background-color: #e6b49d !important;
    color: white !important;
    border-color: #e6b49d !important;
    box-shadow: 0 0 15px rgba(230, 180, 157, 0.6) !important;
    animation: monitor-breath 2s infinite ease-in-out;}

/* 狀態三：紅燈 (入睡/失神警告 - 莫蘭迪豆沙紅) */
.focus-status-red {
    background-color: #d69a92 !important;
    color: white !important;
    border-color: #d69a92 !important;
    box-shadow: 0 0 20px rgba(214, 154, 146, 0.9) !important;
    animation: monitor-pulse 0.5s infinite;}

/* 紅燈在低調模式下依然閃爍 */
#focusMonitorBtn.minimized.focus-status-red {
    box-shadow: 0 0 10px rgba(214, 154, 146, 0.8) !important;
    animation: monitor-pulse 0.5s infinite;}

/* 動畫 Keyframes */
@keyframes monitor-breath {
    0% { transform: scale(1); opacity: 1;}

@keyframes monitor-pulse {
    0% { transform: scale(1);}

/* 狀態二：橙燈 (180秒 - 暖陶土色) */
#slowReaderFocusIndicator.status-prompt {
    background-color: #DE9981 !important; 
    pointer-events: auto;
    opacity: 1;
    
    width: 12px;     /* ★ 修改：同步加寬 ★ */
    
    box-shadow: -2px 0 15px rgba(217, 136, 109, 0.8); 
    animation: full-height-pulse 2s infinite ease-in-out;}

/* 狀態三：紅燈 (210秒 - 鐵鏽紅) */
#slowReaderFocusIndicator.status-red {
    background-color: #C96055 !important; 
    pointer-events: auto;
    opacity: 1;
    
    width: 12px;     /* ★ 修改：同步加寬 ★ */
    
    box-shadow: -3px 0 25px rgba(201, 96, 85, 0.9);
    animation: full-height-flash 0.5s infinite;}

/* 動畫定義 */
@keyframes full-height-pulse {
    0% { opacity: 0.8; box-shadow: -1px 0 8px rgba(217, 136, 109, 0.5);}

@keyframes full-height-flash {
    0% { opacity: 1;}